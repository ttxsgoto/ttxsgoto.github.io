<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ttxsgoto&#39; Blog</title>
  <subtitle>å¥½å¥½å­¦ä¹  åŠªåŠ›å·¥ä½œ äº«å—ç”Ÿæ´»</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://ttxsgoto.github.io/"/>
  <updated>2017-03-30T13:37:17.000Z</updated>
  <id>https://ttxsgoto.github.io/</id>
  
  <author>
    <name>ttxsgoto</name>
    <email>zhongqiang2014@163.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>reæ¨¡å—</title>
    <link href="https://ttxsgoto.github.io/2017/03/30/re/"/>
    <id>https://ttxsgoto.github.io/2017/03/30/re/</id>
    <published>2017-03-30T13:18:15.000Z</published>
    <updated>2017-03-30T13:37:17.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>æ­£åˆ™è¡¨è¾¾å¼ç”¨äºå­—ç¬¦çš„ç­›é€‰å’ŒåŒ¹é…ï¼Œç›¸å…³è¯­æ³•è§„åˆ™è¯·å‚è€ƒå…¶ä»–æ–‡æ¡£ï¼Œè¿™é‡Œä¸»è¦å­¦ä¹ ç›¸å…³å‡½æ•°åŠŸèƒ½ï¼›</p>
<h4 id="åŒ¹é…ä½¿ç”¨å‡½æ•°"><a href="#åŒ¹é…ä½¿ç”¨å‡½æ•°" class="headerlink" title="åŒ¹é…ä½¿ç”¨å‡½æ•°"></a>åŒ¹é…ä½¿ç”¨å‡½æ•°</h4><ul>
<li>re.match(pattern, string[, flags]):ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹åŒ¹é…,åŒ¹é…æˆåŠŸå°±è¿”å›,ä¸å…³å¿ƒåé¢çš„å†…å®¹;</li>
<li>re.search(pattern, string[, flags]):æ‰«ææ•´ä¸ªstringæŸ¥æ‰¾åŒ¹é…,åŒ¹é…æˆåŠŸå°±è¿”å›,ä¸å…³å¿ƒåé¢çš„å†…å®¹;</li>
<li>re.split(pattern, string[, maxsplit]):æŒ‰èƒ½å¤ŸåŒ¹é…çš„å­ä¸²å°†stringåˆ†å‰²åè¿”å›åˆ—è¡¨;</li>
<li>re.findall(pattern, string[, flags]):æœç´¢stringï¼Œä»¥åˆ—è¡¨å½¢å¼è¿”å›å…¨éƒ¨èƒ½åŒ¹é…çš„å­ä¸²;</li>
<li>re.finditer(pattern, string[, flags]):æœç´¢stringï¼Œè¿”å›ä¸€ä¸ªé¡ºåºè®¿é—®æ¯ä¸€ä¸ªåŒ¹é…ç»“æœï¼ˆMatchå¯¹è±¡ï¼‰çš„è¿­ä»£å™¨;</li>
<li>re.sub(pattern, repl, string[, count]):ä½¿ç”¨replæ›¿æ¢stringä¸­æ¯ä¸€ä¸ªåŒ¹é…çš„å­ä¸²åè¿”å›æ›¿æ¢åçš„å­—ç¬¦ä¸²;</li>
<li>re.subn(pattern, repl, string[, count]):è¿”å› (sub(repl, string[, count]), æ›¿æ¢æ¬¡æ•°);</li>
</ul>
<h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"> </div><div class="line"><span class="string">'''</span></div><div class="line">    Describe:</div><div class="line">    re.compile(string[,flag])   #è¿”å›patternå¯¹è±¡</div><div class="line"> </div><div class="line">    pattern = re.compile(r'hello')</div><div class="line">    flagå‚æ•°æ˜¯åŒ¹é…æ¨¡å¼ï¼Œå–å€¼å¯ä»¥ä½¿ç”¨æŒ‰ä½æˆ–è¿ç®—ç¬¦â€™|â€™è¡¨ç¤ºåŒæ—¶ç”Ÿæ•ˆï¼Œæ¯”å¦‚re.I | re.M</div><div class="line">     â€¢ re.I(å…¨æ‹¼ï¼šIGNORECASE): å¿½ç•¥å¤§å°å†™ï¼ˆæ‹¬å·å†…æ˜¯å®Œæ•´å†™æ³•ï¼Œä¸‹åŒï¼‰</div><div class="line">     â€¢ re.M(å…¨æ‹¼ï¼šMULTILINE): å¤šè¡Œæ¨¡å¼ï¼Œæ”¹å˜'^'å’Œ'$'çš„è¡Œä¸ºï¼ˆå‚è§ä¸Šå›¾ï¼‰</div><div class="line">     â€¢ re.S(å…¨æ‹¼ï¼šDOTALL): ç‚¹ä»»æ„åŒ¹é…æ¨¡å¼ï¼Œæ”¹å˜'.'çš„è¡Œä¸º</div><div class="line">     â€¢ re.L(å…¨æ‹¼ï¼šLOCALE): ä½¿é¢„å®šå­—ç¬¦ç±» \w \W \b \B \s \S å–å†³äºå½“å‰åŒºåŸŸè®¾å®š</div><div class="line">     â€¢ re.U(å…¨æ‹¼ï¼šUNICODE): ä½¿é¢„å®šå­—ç¬¦ç±» \w \W \b \B \s \S \d \D å–å†³äºunicodeå®šä¹‰çš„å­—ç¬¦å±æ€§</div><div class="line">     â€¢ re.X(å…¨æ‹¼ï¼šVERBOSE): è¯¦ç»†æ¨¡å¼ã€‚è¿™ä¸ªæ¨¡å¼ä¸‹æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥æ˜¯å¤šè¡Œï¼Œå¿½ç•¥ç©ºç™½å­—ç¬¦ï¼Œå¹¶å¯ä»¥åŠ å…¥æ³¨é‡Šã€‚</div><div class="line"> </div><div class="line">    #ä»¥ä¸‹ä¸ºåŒ¹é…æ‰€ç”¨å‡½æ•°</div><div class="line">    re.match(pattern, string[, flags]):ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹åŒ¹é…,åŒ¹é…æˆåŠŸå°±è¿”å›,ä¸å…³å¿ƒåé¢çš„å†…å®¹;</div><div class="line">    re.search(pattern, string[, flags]):æ‰«ææ•´ä¸ªstringæŸ¥æ‰¾åŒ¹é…,åŒ¹é…æˆåŠŸå°±è¿”å›,ä¸å…³å¿ƒåé¢çš„å†…å®¹;</div><div class="line">    re.split(pattern, string[, maxsplit]):æŒ‰èƒ½å¤ŸåŒ¹é…çš„å­ä¸²å°†stringåˆ†å‰²åè¿”å›åˆ—è¡¨</div><div class="line">    re.findall(pattern, string[, flags]):æœç´¢stringï¼Œä»¥åˆ—è¡¨å½¢å¼è¿”å›å…¨éƒ¨èƒ½åŒ¹é…çš„å­ä¸²</div><div class="line">    re.finditer(pattern, string[, flags]):æœç´¢stringï¼Œè¿”å›ä¸€ä¸ªé¡ºåºè®¿é—®æ¯ä¸€ä¸ªåŒ¹é…ç»“æœï¼ˆMatchå¯¹è±¡ï¼‰çš„è¿­ä»£å™¨</div><div class="line">    re.sub(pattern, repl, string[, count]):ä½¿ç”¨replæ›¿æ¢stringä¸­æ¯ä¸€ä¸ªåŒ¹é…çš„å­ä¸²åè¿”å›æ›¿æ¢åçš„å­—ç¬¦ä¸²</div><div class="line">    re.subn(pattern, repl, string[, count]):è¿”å› (sub(repl, string[, count]), æ›¿æ¢æ¬¡æ•°)</div><div class="line">'''</div><div class="line"> </div><div class="line"><span class="keyword">import</span> re</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">match</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    re.match(pattern, string[, flags])</div><div class="line">    è¿™ä¸ªæ–¹æ³•å°†ä¼šä»stringï¼ˆæˆ‘ä»¬è¦åŒ¹é…çš„å­—ç¬¦ä¸²ï¼‰çš„å¼€å¤´å¼€å§‹ï¼Œ</div><div class="line">    å°è¯•åŒ¹é…patternï¼Œä¸€ç›´å‘ååŒ¹é…ï¼Œå¦‚æœé‡åˆ°æ— æ³•åŒ¹é…çš„å­—ç¬¦ï¼Œ</div><div class="line">    ç«‹å³è¿”å›Noneï¼Œå¦‚æœåŒ¹é…æœªç»“æŸå·²ç»åˆ°è¾¾stringçš„æœ«å°¾ï¼Œä¹Ÿä¼šè¿”å›Noneã€‚</div><div class="line">    ä¸¤ä¸ªç»“æœå‡è¡¨ç¤ºåŒ¹é…å¤±è´¥ï¼Œå¦åˆ™åŒ¹é…patternæˆåŠŸï¼ŒåŒæ—¶åŒ¹é…ç»ˆæ­¢,ä¸å†å¯¹stringå‘ååŒ¹é…ã€‚</div><div class="line">    :return:</div><div class="line">    ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹åŒ¹é…,ä¸€æ—¦åŒ¹é…æˆåŠŸå°±è¿”å›,ä¸å…³å¿ƒåé¢çš„å†…å®¹</div><div class="line">    ============matchå±æ€§å’Œæ–¹æ³•==============</div><div class="line">    # å±æ€§</div><div class="line">    1.string: åŒ¹é…æ—¶ä½¿ç”¨çš„æ–‡æœ¬ã€‚</div><div class="line">    2.re: åŒ¹é…æ—¶ä½¿ç”¨çš„Patternå¯¹è±¡ã€‚</div><div class="line">    3.pos: æ–‡æœ¬ä¸­æ­£åˆ™è¡¨è¾¾å¼å¼€å§‹æœç´¢çš„ç´¢å¼•ã€‚å€¼ä¸Pattern.match()å’ŒPattern.seach()æ–¹æ³•çš„åŒåå‚æ•°ç›¸åŒã€‚</div><div class="line">    4.endpos: æ–‡æœ¬ä¸­æ­£åˆ™è¡¨è¾¾å¼ç»“æŸæœç´¢çš„ç´¢å¼•ã€‚å€¼ä¸Pattern.match()å’ŒPattern.seach()æ–¹æ³•çš„åŒåå‚æ•°ç›¸åŒã€‚</div><div class="line">    5.lastindex: æœ€åä¸€ä¸ªè¢«æ•è·çš„åˆ†ç»„åœ¨æ–‡æœ¬ä¸­çš„ç´¢å¼•ã€‚å¦‚æœæ²¡æœ‰è¢«æ•è·çš„åˆ†ç»„ï¼Œå°†ä¸ºNoneã€‚</div><div class="line">    6.lastgroup: æœ€åä¸€ä¸ªè¢«æ•è·çš„åˆ†ç»„çš„åˆ«åã€‚å¦‚æœè¿™ä¸ªåˆ†ç»„æ²¡æœ‰åˆ«åæˆ–è€…æ²¡æœ‰è¢«æ•è·çš„åˆ†ç»„ï¼Œå°†ä¸ºNoneã€‚</div><div class="line"> </div><div class="line">    # æ–¹æ³•</div><div class="line">    1.group([group1, â€¦]):è·å¾—ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç»„æˆªè·çš„å­—ç¬¦ä¸²ï¼›æŒ‡å®šå¤šä¸ªå‚æ•°æ—¶å°†ä»¥å…ƒç»„å½¢å¼è¿”å›ã€‚group1å¯ä»¥ä½¿ç”¨ç¼–å·ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ«åï¼›ç¼–å·0ä»£è¡¨æ•´ä¸ªåŒ¹é…çš„å­ä¸²ï¼›ä¸å¡«å†™å‚æ•°æ—¶ï¼Œè¿”å›group(0)ï¼›æ²¡æœ‰æˆªè·å­—ç¬¦ä¸²çš„ç»„è¿”å›Noneï¼›æˆªè·äº†å¤šæ¬¡çš„ç»„è¿”å›æœ€åä¸€æ¬¡æˆªè·çš„å­ä¸²ã€‚</div><div class="line">    2.groups([default]):ä»¥å…ƒç»„å½¢å¼è¿”å›å…¨éƒ¨åˆ†ç»„æˆªè·çš„å­—ç¬¦ä¸²ã€‚ç›¸å½“äºè°ƒç”¨group(1,2,â€¦last)ã€‚defaultè¡¨ç¤ºæ²¡æœ‰æˆªè·å­—ç¬¦ä¸²çš„ç»„ä»¥è¿™ä¸ªå€¼æ›¿ä»£ï¼Œé»˜è®¤ä¸ºNoneã€‚</div><div class="line">    3.groupdict([default]):è¿”å›ä»¥æœ‰åˆ«åçš„ç»„çš„åˆ«åä¸ºé”®ã€ä»¥è¯¥ç»„æˆªè·çš„å­ä¸²ä¸ºå€¼çš„å­—å…¸ï¼Œæ²¡æœ‰åˆ«åçš„ç»„ä¸åŒ…å«åœ¨å†…ã€‚defaultå«ä¹‰åŒä¸Šã€‚</div><div class="line">    4.start([group]):è¿”å›æŒ‡å®šçš„ç»„æˆªè·çš„å­ä¸²åœ¨stringä¸­çš„èµ·å§‹ç´¢å¼•ï¼ˆå­ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•ï¼‰ã€‚groupé»˜è®¤å€¼ä¸º0ã€‚</div><div class="line">    5.end([group]):è¿”å›æŒ‡å®šçš„ç»„æˆªè·çš„å­ä¸²åœ¨stringä¸­çš„ç»“æŸç´¢å¼•ï¼ˆå­ä¸²æœ€åä¸€ä¸ªå­—ç¬¦çš„ç´¢å¼•+1ï¼‰ã€‚groupé»˜è®¤å€¼ä¸º0ã€‚</div><div class="line">    6.span([group]):è¿”å›(start(group), end(group))ã€‚</div><div class="line">    7.expand(template):å°†åŒ¹é…åˆ°çš„åˆ†ç»„ä»£å…¥templateä¸­ç„¶åè¿”å›ã€‚templateä¸­å¯ä»¥ä½¿ç”¨\idæˆ–\gã€\gå¼•ç”¨åˆ†ç»„ï¼Œä½†ä¸èƒ½ä½¿ç”¨ç¼–å·0ã€‚\idä¸\gæ˜¯ç­‰ä»·çš„ï¼›ä½†\10å°†è¢«è®¤ä¸ºæ˜¯ç¬¬10ä¸ªåˆ†ç»„ï¼Œå¦‚æœä½ æƒ³è¡¨è¾¾\1ä¹‹åæ˜¯å­—ç¬¦â€™0â€™ï¼Œåªèƒ½ä½¿ç”¨\g0ã€‚</div><div class="line">    """</div><div class="line"> </div><div class="line">    pattern = re.compile(<span class="string">r'hello'</span>)  <span class="comment">#æŠŠæ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘æˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡,å†ä½¿ç”¨</span></div><div class="line">    result1 = re.match(pattern, <span class="string">'hello'</span>)</div><div class="line">    result2 = re.match(pattern, <span class="string">'hello0 xxx'</span>)</div><div class="line">    result3 = re.match(pattern, <span class="string">'heloo xxx'</span>)</div><div class="line">    result4 = re.match(pattern, <span class="string">'hello xxx'</span>)</div><div class="line"> </div><div class="line">    <span class="keyword">print</span> result1,result2,result3,result4   <span class="comment">#reå¯¹è±¡ï¼Œ&lt;_sre.SRE_Match object at 0x1053d55e0&gt; &lt;_sre.SRE_Match object at 0x1053ba098&gt; None &lt;_sre.SRE_Match object at 0x1053ba100&gt;</span></div><div class="line">    <span class="keyword">if</span> result1:					<span class="comment">#hello</span></div><div class="line">        <span class="keyword">print</span> result1.group()</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'result1 faild'</span></div><div class="line"> </div><div class="line">    <span class="keyword">if</span> result2:					<span class="comment">#hello</span></div><div class="line">        <span class="keyword">print</span> result2.group()</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'result2 faild'</span></div><div class="line"> </div><div class="line">    <span class="keyword">if</span> result3:					<span class="comment">#result3 faild</span></div><div class="line">        <span class="keyword">print</span> result3.group()</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'result3 faild'</span></div><div class="line"> </div><div class="line">    <span class="keyword">if</span> result4:					<span class="comment">#hello</span></div><div class="line">        <span class="keyword">print</span> result4.group()</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'result4 faild'</span></div><div class="line"> </div><div class="line">    <span class="keyword">print</span> <span class="string">'======================================='</span></div><div class="line">    m = re.match(<span class="string">r'(\w+) (\w+)(?P&lt;sign&gt;.*)'</span>, <span class="string">'hello world!!!'</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'m.string:'</span>, m.string                             <span class="comment">#m.string: hello world!!!</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.re:'</span>, m.re                                     <span class="comment">#m.re: &lt;_sre.SRE_Pattern object at 0x103d62690&gt;</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.pos'</span>, m.pos                                    <span class="comment">#m.pos 0</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.endpos'</span>, m.endpos                              <span class="comment">#m.endpos 14</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.lastindex:'</span>, m.lastindex                       <span class="comment">#m.lastindex: 3</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.lastgroup:'</span>, m.lastgroup                       <span class="comment">#m.lastgroup: sign</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.group():'</span>, m.group()                           <span class="comment">#m.group(): hello world!!!</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.group(1,2):'</span>, m.group(<span class="number">1</span>,<span class="number">2</span>)                     <span class="comment">#m.group(1,2): ('hello', 'world')</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.groups():'</span>, m.groups()                         <span class="comment">#m.groups(): ('hello', 'world', '!!!')</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.groupdict()'</span>, m.groupdict()                    <span class="comment">#m.groupdict() &#123;'sign': '!!!'&#125;</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.start(2):'</span>, m.start(<span class="number">2</span>)                         <span class="comment">#m.start(2): 6</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.end(2):'</span>, m.end(<span class="number">2</span>)                             <span class="comment">#m.end(2): 11</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'m.span(2):'</span>, m.span(<span class="number">2</span>)                           <span class="comment">#m.span(2): (6, 11)</span></div><div class="line">    <span class="keyword">print</span> <span class="string">r"m.expand(r'\g \g\g'):"</span>, m.expand(<span class="string">r'\2 \1\3'</span>)    <span class="comment">#m.expand(r'\g \g\g'): world hello!!!</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    re.search(pattern, string[, flags])</div><div class="line">    search()ä¼šæ‰«ææ•´ä¸ªstringæŸ¥æ‰¾åŒ¹é…;</div><div class="line">    matchï¼ˆï¼‰åªæœ‰åœ¨0ä½ç½®åŒ¹é…æˆåŠŸçš„è¯æ‰æœ‰è¿”å›ï¼Œ</div><div class="line">    å¦‚æœä¸æ˜¯å¼€å§‹ä½ç½®åŒ¹é…æˆåŠŸçš„è¯ï¼Œmatch()å°±è¿”å›Noneã€‚</div><div class="line">    searchæ–¹æ³•çš„è¿”å›å¯¹è±¡åŒæ ·match()è¿”å›å¯¹è±¡çš„æ–¹æ³•å’Œå±æ€§</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    pattern = re.compile(<span class="string">r'world'</span>)</div><div class="line">    match = re.search(pattern, <span class="string">'hello world!!!! world'</span>)</div><div class="line">    <span class="keyword">if</span> match:</div><div class="line">        <span class="comment"># ä½¿ç”¨Matchè·å¾—åˆ†ç»„ä¿¡æ¯</span></div><div class="line">        <span class="keyword">print</span> match.group()     <span class="comment">#world</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    re.split(pattern, string[, maxsplit])</div><div class="line">    æŒ‰ç…§èƒ½å¤ŸåŒ¹é…çš„å­ä¸²å°†stringåˆ†å‰²åè¿”å›åˆ—è¡¨ã€‚</div><div class="line">    maxsplitç”¨äºæŒ‡å®šæœ€å¤§åˆ†å‰²æ¬¡æ•°ï¼Œä¸æŒ‡å®šå°†å…¨éƒ¨åˆ†å‰²</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    pattern = re.compile(<span class="string">r'\d+'</span>)</div><div class="line">    <span class="keyword">print</span> re.split(pattern, <span class="string">'xxxx1wsd2dsafds4dafd8'</span>,maxsplit=<span class="number">10</span>)    <span class="comment">#['xxxx', 'wsd', 'dsafds', 'dafd', '']</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">findall</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    re.findall(pattern, string[, flags])</div><div class="line">    æœç´¢stringï¼Œä»¥åˆ—è¡¨å½¢å¼è¿”å›å…¨éƒ¨èƒ½åŒ¹é…çš„å­ä¸²</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    pattern = re.compile(<span class="string">r'\d+'</span>)</div><div class="line">    <span class="keyword">print</span> re.findall(pattern, <span class="string">'xxxx1wsd2dsafds4dafd8'</span>,)     <span class="comment">#['1', '2', '4', '8']</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">finditer</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    re.finditer(pattern, string[, flags])</div><div class="line">    æœç´¢stringï¼Œè¿”å›ä¸€ä¸ªé¡ºåºè®¿é—®æ¯ä¸€ä¸ªåŒ¹é…ç»“æœï¼ˆMatchå¯¹è±¡ï¼‰çš„è¿­ä»£å™¨</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    pattern = re.compile(<span class="string">r'\d+'</span>)</div><div class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> re.finditer(pattern, <span class="string">'one1two2three3four4'</span>):</div><div class="line">        <span class="keyword">print</span> m.group(),    <span class="comment">#1 2 3 4</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    re.sub(pattern, repl, string[, count])</div><div class="line">    ä½¿ç”¨replæ›¿æ¢stringä¸­æ¯ä¸€ä¸ªåŒ¹é…çš„å­ä¸²åè¿”å›æ›¿æ¢åçš„å­—ç¬¦ä¸²</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    pattern = re.compile(<span class="string">r'(\w+)-(\w+)'</span>)</div><div class="line">    s = <span class="string">'I-can, hello world!'</span></div><div class="line">    <span class="keyword">print</span> re.sub(pattern,<span class="string">r'\2 \1'</span>, s)   <span class="comment">#can I, hello world!</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">subn</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    re.subn(pattern, repl, string[, count])</div><div class="line">    è¿”å› (sub(repl, string[, count]), æ›¿æ¢æ¬¡æ•°)</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    pattern = re.compile(<span class="string">r'(\w+)-(\w+)'</span>)</div><div class="line">    s = <span class="string">'I-can, hello-world!'</span></div><div class="line">    <span class="keyword">print</span> re.subn(pattern, <span class="string">r'\2 \1'</span>, s)     <span class="comment">#('can I, world hello!', 2)</span></div><div class="line"> </div><div class="line"> </div><div class="line">match()</div><div class="line">search()</div><div class="line">split()</div><div class="line">findall()</div><div class="line">finditer()</div><div class="line">sub()</div><div class="line">subn()</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;è¯´æ˜&quot;&gt;&lt;a href=&quot;#è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;è¯´æ˜&quot;&gt;&lt;/a&gt;è¯´æ˜&lt;/h4&gt;&lt;p&gt;æ­£åˆ™è¡¨è¾¾å¼ç”¨äºå­—ç¬¦çš„ç­›é€‰å’ŒåŒ¹é…ï¼Œç›¸å…³è¯­æ³•è§„åˆ™è¯·å‚è€ƒå…¶ä»–æ–‡æ¡£ï¼Œè¿™é‡Œä¸»è¦å­¦ä¹ ç›¸å…³å‡½æ•°åŠŸèƒ½ï¼›&lt;/p&gt;
&lt;h4 id=&quot;åŒ¹é…ä½¿ç”¨å‡½æ•°&quot;&gt;&lt;a hre
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="re" scheme="https://ttxsgoto.github.io/tags/re/"/>
    
  </entry>
  
  <entry>
    <title>Tmuxæ—¥å¸¸</title>
    <link href="https://ttxsgoto.github.io/2017/03/29/tmux/"/>
    <id>https://ttxsgoto.github.io/2017/03/29/tmux/</id>
    <published>2017-03-29T13:06:09.000Z</published>
    <updated>2017-03-30T13:19:46.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Macä¸­</div><div class="line">ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</div><div class="line">brew install tmux</div><div class="line"># Ubuntuä¸­</div><div class="line">apt-get install tmux</div></pre></td></tr></table></figure>
<p>Sessionå¯ä»¥åŒ…å«å¤šä¸ªWindow, æ¯ä¸ªWindowåˆå¯ä»¥åŒ…å«å¤šä¸ªPane</p>
<h4 id="Sessionæ“ä½œ"><a href="#Sessionæ“ä½œ" class="headerlink" title="Sessionæ“ä½œ"></a>Sessionæ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">tmux new -s xxx #æ–°å»ºsessionä¼šè¯</div><div class="line">C-b : new -s abc # åœ¨å½“å‰sessionä¸­æ–°å»ºä¸€ä¸ªsessionï¼Œå¹¶ä¿è¯ä¹‹å‰sessionä¾ç„¶å­˜åœ¨</div><div class="line">tmux a -t xxx #è¿›å…¥xxxä¼šè¯</div><div class="line">C-b ? #åˆ—å‡ºæ‰€æœ‰å¿«æ·é”®ï¼ŒæŒ‰qè¿”å›</div><div class="line">C-b d #å½“å‰ä¼šè¯ï¼Œè¿”å›shellï¼›tmux attach é‡æ–°è¿›å…¥ä¹‹å‰çš„ä¼šè¯</div><div class="line">C-b s #é€‰æ‹©å¹¶åˆ‡æ¢ä¼šè¯ï¼Œåœ¨å¼€å¯å¤šä¸ªä¼šè¯æ—¶ä½¿ç”¨</div></pre></td></tr></table></figure>
<h4 id="Windowæ“ä½œ"><a href="#Windowæ“ä½œ" class="headerlink" title="Windowæ“ä½œ"></a>Windowæ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">C-b c åˆ›å»ºä¸€ä¸ªæ–°çª—å£</div><div class="line">C-b &amp; å…³é—­å½“å‰çª—å£</div><div class="line">C-b w åˆ—å‡ºæ‰€æœ‰çš„çª—å£é€‰æ‹©</div><div class="line">C-b çª—å£å·(ä¾‹å¦‚çª—å£å·ä¸º1çš„, åˆ™C-b 1)</div><div class="line">C-b , é‡å‘½åå½“å‰çª—å£ï¼Œä¾¿äºè¯†åˆ«å„ä¸ªçª—å£</div></pre></td></tr></table></figure>
<h4 id="Paneæ“ä½œ"><a href="#Paneæ“ä½œ" class="headerlink" title="Paneæ“ä½œ"></a>Paneæ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">C-b % æ¨ªå‘åˆ†Terminal</div><div class="line">C-b &quot; çºµå‘åˆ†Terminal</div><div class="line">C-b æ–¹å‘é”® åœ¨è‡ªç”±é€‰æ‹©å„é¢æ¿</div><div class="line">C-b x å…³é—­å½“å‰pane</div><div class="line">C-b q æ˜¾ç¤ºé¢æ¿ç¼–å·</div></pre></td></tr></table></figure>
<h4 id="é…ç½®æ–‡ä»¶-tmux-conf"><a href="#é…ç½®æ–‡ä»¶-tmux-conf" class="headerlink" title="é…ç½®æ–‡ä»¶(~/.tmux.conf)"></a>é…ç½®æ–‡ä»¶(~/.tmux.conf)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">#è®¾ç½®å‰ç¼€ä¸ºCtrl + a</div><div class="line">set -g prefix C-a</div><div class="line"> </div><div class="line">#è§£é™¤Ctrl+b ä¸å‰ç¼€çš„å¯¹åº”å…³ç³»</div><div class="line">unbind C-b</div><div class="line"> </div><div class="line">#å°†r è®¾ç½®ä¸ºåŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤º&quot;reloaded!&quot;ä¿¡æ¯</div><div class="line">bind r source-file ~/.tmux.conf \; display &quot;~/.tmux Reloaded!&quot;</div><div class="line"> </div><div class="line">#window æ°´å¹³åˆ†å‰²å’Œçºµå‘åˆ†å‰²</div><div class="line">bind | split-window -h -c</div><div class="line">bind - split-window -v -c</div><div class="line"> </div><div class="line">#æ–¹å‘ç§»åŠ¨è®¾ç½®</div><div class="line">#up</div><div class="line">bind -n C-k select-pane -U</div><div class="line">#down</div><div class="line">bind -n C-j select-pane -D</div><div class="line">#left</div><div class="line">bind -n C-h select-pane -L</div><div class="line">#right</div><div class="line">bind -n C-l select-pane -R</div><div class="line"> </div><div class="line">#è®¾ç½®é¼ æ ‡æ“ä½œ</div><div class="line">#set -g mouse on</div><div class="line"> </div><div class="line"># è®¾ç½®ç»ˆç«¯ç±»å‹ä¸º256è‰²</div><div class="line">#set -g default-terminal &quot;screen-256color&quot;</div><div class="line"> </div><div class="line"># è®¾ç½®çª—å£åˆ†å‰²çš„è¾¹æ¡†é¢œè‰²</div><div class="line">set -g pane-border-fg green</div><div class="line">set -g pane-border-bg black</div><div class="line"> </div><div class="line"># è®¾ç½®å½“å‰çª—å£åˆ†å‰²çš„è¾¹æ¡†é¢œè‰²</div><div class="line">#set -g pane-active-border-fg white</div><div class="line">#set -g pane-active-border-bg yellow</div><div class="line"> </div><div class="line">set -g status-bg colour236</div><div class="line">set -g status-fg colour68</div><div class="line"> </div><div class="line">#copy-mode å°†å¿«æ·é”®è®¾ç½®ä¸ºvi æ¨¡å¼</div><div class="line">setw -g mode-keys vi</div><div class="line"> </div><div class="line"># è®¾ç½®çŠ¶æ€æ å·¦éƒ¨å®½åº¦  é»˜è®¤ä¸º10</div><div class="line">set -g status-left-length 35</div><div class="line"># è®¾ç½®çŠ¶æ€æ å·¦éƒ¨æ˜¾ç¤ºå†…å®¹ã€‚</div><div class="line">set -g status-left &quot;#[fg=colour252,bold,bg=colour243] ğŸŒº  S: #S #[fg=colour250,bg=colour239] ğŸµ  W: #I #[fg=yellow,bg=colour237] â˜˜ #[fg=colour250,bg=colour237] P: #P#[default]&quot;</div><div class="line"># è®¾ç½®çŠ¶æ€æ å³éƒ¨å®½åº¦</div><div class="line">set -g status-right-length 48</div><div class="line"># è®¾ç½®çŠ¶æ€æ å³éƒ¨å†…å®¹ï¼Œè¿™é‡Œè®¾ç½®ä¸ºæ—¶é—´ä¿¡æ¯</div><div class="line">set -g status-right &quot;#[fg=colour251,bold,bg=colour237] ğŸ—“  %Y-%b-%d #[fg=colour251,bold,bg=colour239] â±  %R #[fg=colour251,bold,bg=colour243] ğŸ³  #(ifconfig | grep &apos;inet.*netmask.*broadcast&apos; | awk &apos;&#123;print $2&#125;&apos;)&quot;</div><div class="line"># çª—å£ä¿¡æ¯å±…ä¸­æ˜¾ç¤º</div><div class="line">set -g status-justify centre</div><div class="line"># è®¾ç½®çŠ¶æ€æ æ›´æ–°æ—¶é—´ æ¯60ç§’æ›´æ–°ä¸€æ¬¡ï¼Œé»˜è®¤æ˜¯15ç§’æ›´æ–°</div><div class="line">set -g status-interval 60</div></pre></td></tr></table></figure>
<h4 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h4><p><a href="https://github.com/liuchengxu/dotfiles/blob/master/tmux.conf" target="_blank" rel="external">https://github.com/liuchengxu/dotfiles/blob/master/tmux.conf</a><br><a href="https://github.com/wklken/k-tmux/blob/master/tmux.conf" target="_blank" rel="external">https://github.com/wklken/k-tmux/blob/master/tmux.conf</a><br><a href="https://my.oschina.net/am313/blog/865915" target="_blank" rel="external">https://my.oschina.net/am313/blog/865915</a><br><a href="https://gist.github.com/ryerh/14b7c24dfd623ef8edc7" target="_blank" rel="external">https://gist.github.com/ryerh/14b7c24dfd623ef8edc7</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;å®‰è£…&quot;&gt;&lt;a href=&quot;#å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…&quot;&gt;&lt;/a&gt;å®‰è£…&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div c
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://ttxsgoto.github.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="tmux" scheme="https://ttxsgoto.github.io/tags/tmux/"/>
    
  </entry>
  
  <entry>
    <title>djangoæµ‹è¯•</title>
    <link href="https://ttxsgoto.github.io/2017/03/28/django-test/"/>
    <id>https://ttxsgoto.github.io/2017/03/28/django-test/</id>
    <published>2017-03-28T12:55:48.000Z</published>
    <updated>2017-03-28T13:15:18.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>Pythonå•å…ƒæµ‹è¯•ç±»æ‰©å±•äº†unittestæµ‹è¯•ç”¨ä¾‹,Djangoæä¾›äº†è¿™ä¸ªåŸºç±»çš„ä¸€äº›æ‰©å±•ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://ttxsgoto.github.io/img/django/django_test01.png" alt=""></p>
<p><strong>SimpleTestCase</strong>:æ‰©å±•äº†unittest.TestCaseçš„ä¸€äº›åŸºæœ¬åŠŸèƒ½</p>
<ul>
<li>ä¿å­˜å’Œæ¢å¤pythonè­¦å‘Šæœºåˆ¶çŠ¶æ€</li>
<li>ä½¿ç”¨client Client</li>
<li>è‡ªå®šä¹‰æµ‹è¯•æ—¶é—´URL maps</li>
<li>ä½¿ç”¨modified settingsè¿è¡Œæµ‹è¯•çš„èƒ½åŠ›</li>
</ul>
<p><strong>TransactionTestCase</strong>:äº‹åŠ¡æµ‹è¯•ç±»ï¼Œç»§æ‰¿SimpleTestCase</p>
<p><strong>TestCase</strong>:ç”¨æ¥æµ‹è¯•ç½‘ç«™æ­£å¸¸è½¬æ¢unittest.TestCaseåˆ°Django TestCase</p>
<ul>
<li>è‡ªåŠ¨åŠ è½½fixtures</li>
<li>å°†æµ‹è¯•åŒ…å«åœ¨ä¸¤ä¸ªåµŒå¥—çš„atomicå—ä¸­ï¼šä¸€ä¸ªç”¨äºæ•´ä¸ªç±»ï¼Œä¸€ä¸ªç”¨äºæ¯ä¸ªæµ‹è¯•</li>
<li>åˆ›å»ºä¸€ä¸ªTestClientå®ä¾‹</li>
<li>Djangoç‰¹å®šçš„æ–­è¨€ç”¨äºæµ‹è¯•é‡å®šå‘å’Œå½¢å¼é”™è¯¯</li>
</ul>
<p><strong>LiveServerTestCase</strong>:åŸºæœ¬ä¸Šä¸TransactionTestCaseç›¸åŒï¼Œå…·æœ‰ä¸€ä¸ªé¢å¤–çš„åŠŸèƒ½ï¼šå®ƒåœ¨è®¾ç½®çš„åå°å¯åŠ¨ä¸€ä¸ªæ´»åŠ¨çš„DjangoæœåŠ¡å™¨ï¼Œå¹¶åœ¨å¸è½½æ—¶å°†å…¶å…³é—­</p>
<h4 id="ç‰¹æ®Šæ–¹æ³•"><a href="#ç‰¹æ®Šæ–¹æ³•" class="headerlink" title="ç‰¹æ®Šæ–¹æ³•"></a>ç‰¹æ®Šæ–¹æ³•</h4><ul>
<li>setUp():æ¯ä¸ªæµ‹è¯•å‡½æ•°è¿è¡Œå‰æ‰§è¡Œ</li>
<li>tearDown():æ¯ä¸ªæµ‹è¯•å‡½æ•°è¿è¡Œå®Œæˆåæ‰§è¡Œ</li>
<li>setUpClass(cls):å¿…é¡»ä½¿ç”¨@classmethodè£…é¥°å™¨ï¼Œæ‰€æœ‰testå‡½æ•°è¿è¡Œå‰æ‰§è¡Œä¸€æ¬¡</li>
<li>tearDownClass(cls):å¿…é¡»ä½¿ç”¨@classmethodè£…é¥°å™¨ï¼Œæ‰€æœ‰testå‡½æ•°è¿è¡Œå®Œæˆåæ‰§è¡Œä¸€æ¬¡</li>
</ul>
<p><strong>é»˜è®¤æµ‹è¯•å®¢æˆ·ç«¯</strong><br>django.test.*TestCaseå®ä¾‹ä¸­çš„æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½å¯ä»¥è®¿é—®Djangoæµ‹è¯•å®¢æˆ·ç«¯çš„å®ä¾‹ã€‚æ­¤å®¢æˆ·ç«¯å¯ä»¥ä½œä¸ºself.clientè®¿é—®ã€‚æ¯ä¸ªæµ‹è¯•éƒ½é‡æ–°åˆ›å»ºæ­¤å®¢æˆ·ç«¯ï¼Œå› æ­¤æ‚¨ä¸å¿…æ‹…å¿ƒä»ä¸€ä¸ªæµ‹è¯•åˆ°å¦ä¸€ä¸ªæµ‹è¯•çš„çŠ¶æ€ï¼ˆä¾‹å¦‚Cookieï¼‰<br>å®ä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> unittest</div><div class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> Client</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleTest</span><span class="params">(unittest.TestCase)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_details</span><span class="params">(self)</span>:</span></div><div class="line">        client = Client()</div><div class="line">        response = client.get(<span class="string">'/customer/details/'</span>)</div><div class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_index</span><span class="params">(self)</span>:</span></div><div class="line">        client = Client()</div><div class="line">        response = client.get(<span class="string">'/customer/index/'</span>)</div><div class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</div><div class="line"> </div><div class="line"><span class="comment">################ç­‰åŒäºå¦‚ä¸‹################</span></div><div class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleTest</span><span class="params">(TestCase)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_details</span><span class="params">(self)</span>:</span></div><div class="line">        response = self.client.get(<span class="string">'/customer/details/'</span>)</div><div class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_index</span><span class="params">(self)</span>:</span></div><div class="line">        response = self.client.get(<span class="string">'/customer/index/'</span>)</div><div class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</div></pre></td></tr></table></figure></p>
<h4 id="æµ‹è¯•å®¢æˆ·ç«¯"><a href="#æµ‹è¯•å®¢æˆ·ç«¯" class="headerlink" title="æµ‹è¯•å®¢æˆ·ç«¯"></a>æµ‹è¯•å®¢æˆ·ç«¯</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from django.test import Client</div><div class="line">&gt;&gt;&gt; c = Client()</div><div class="line">&gt;&gt;&gt; response = c.post(&apos;/login/&apos;, &#123;&apos;username&apos;: &apos;john&apos;, &apos;password&apos;: &apos;smith&apos;&#125;)</div><div class="line">&gt;&gt;&gt; response.status_code</div><div class="line">200</div><div class="line">&gt;&gt;&gt; response = c.get(&apos;/customer/details/&apos;)</div><div class="line">&gt;&gt;&gt; response.content    # è¿”å›æ•°æ®ä¸»ä½“</div></pre></td></tr></table></figure>
<h4 id="æµ‹è¯•å“åº”å±æ€§"><a href="#æµ‹è¯•å“åº”å±æ€§" class="headerlink" title="æµ‹è¯•å“åº”å±æ€§"></a>æµ‹è¯•å“åº”å±æ€§</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- client:ç”¨äºç”Ÿæˆå¯¼è‡´å“åº”çš„è¯·æ±‚çš„æµ‹è¯•å®¢æˆ·ç«¯</div><div class="line">- content:å“åº”çš„ä¸»ä½“</div><div class="line">- context:ç”¨äºå‘ˆç°äº§ç”Ÿå“åº”å†…å®¹çš„æ¨¡æ¿çš„æ¨¡æ¿Contextå®ä¾‹</div><div class="line">- request:å“åº”çš„è¯·æ±‚æ•°æ®</div><div class="line">- wsgi_request:ç”±ç”Ÿæˆå“åº”çš„æµ‹è¯•å¤„ç†ç¨‹åºç”Ÿæˆçš„WSGIRequestå®ä¾‹</div><div class="line">- status_code:å“åº”httpçŠ¶æ€ç </div><div class="line">- templates:ç”¨äºæ¸²æŸ“æœ€ç»ˆå†…å®¹çš„Templateå®ä¾‹åˆ—è¡¨ï¼ŒæŒ‰æ¸²æŸ“é¡ºåºæ’åˆ—</div><div class="line">- resolver_match:å“åº”çš„å®ä¾‹ResolverMatch</div></pre></td></tr></table></figure>
<h4 id="å¸¸ç”¨æ–­è¨€ï¼ˆruntests-case-pyï¼‰"><a href="#å¸¸ç”¨æ–­è¨€ï¼ˆruntests-case-pyï¼‰" class="headerlink" title="å¸¸ç”¨æ–­è¨€ï¼ˆruntests/case.pyï¼‰"></a>å¸¸ç”¨æ–­è¨€ï¼ˆruntests/case.pyï¼‰</h4><ul>
<li>self.assertEqual(first, second)</li>
<li>self.assertNotEqual(first, second)</li>
<li>self.assertFalse(expr)</li>
<li>self.assertTrue(expr)</li>
<li>self.assertEqual(first, second)</li>
<li>self.assertNotEqual(first, second)</li>
<li>self.assertSequenceEqual(seq1, seq2)</li>
<li>self.assertListEqual(list1, list2):</li>
<li>self.assertTupleEqual(tuple1, tuple2):</li>
<li>self.assertDictEqual(dic1, dic2):</li>
<li>self.assertSetEqual(set1, set2):</li>
<li>self.assertIn(mem, container):</li>
<li>self.assertIs(expr1, expr2)</li>
<li>self.assertIsNotNone(obj):</li>
<li>self.assertIsNone(obj)</li>
<li>self.assertIsInstance(obj, cls)</li>
</ul>
<h4 id="è·³è¿‡æµ‹è¯•"><a href="#è·³è¿‡æµ‹è¯•" class="headerlink" title="è·³è¿‡æµ‹è¯•"></a>è·³è¿‡æµ‹è¯•</h4><p>unitteståº“æä¾›@skipIfå’Œ@skipUnlessè£…é¥°å™¨ï¼Œå¦‚æœæå‰çŸ¥é“è¿™äº›æµ‹è¯•åœ¨æŸäº›æ¡ä»¶ä¸‹ä¼šå¤±è´¥ï¼Œå¯ä»¥è·³è¿‡æµ‹è¯•</p>
<h4 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">python manage.py test runtests.test_user</div><div class="line">python manage.py test xxx.test		#æ‰§è¡Œxxxé¡¹ç›®ä¸‹çš„testxé‡Œçš„æµ‹è¯•</div><div class="line">python manage.py test animals.tests.AnimalTestCase	#å•ç‹¬æ‰§è¡ŒæŸä¸ªtest case</div></pre></td></tr></table></figure>
<h4 id="æµ‹è¯•æ•°æ®åº“"><a href="#æµ‹è¯•æ•°æ®åº“" class="headerlink" title="æµ‹è¯•æ•°æ®åº“"></a>æµ‹è¯•æ•°æ®åº“</h4><p>æµ‹è¯•éœ€è¦æ•°æ®åº“ï¼Œdjangoä¼šä¸ºæµ‹è¯•å•ç‹¬ç”Ÿæˆæ•°æ®åº“ã€‚ä¸ç®¡ä½ çš„æµ‹è¯•æ˜¯å¦é€šè¿‡,å½“ä½ æ‰€æœ‰çš„æµ‹è¯•éƒ½æ‰§è¡Œè¿‡å,è¿™ä¸ªæµ‹è¯•æ•°æ®åº“å°±ä¼šè¢«é”€æ¯</p>
<p>é»˜è®¤æƒ…å†µä¸‹,æµ‹è¯•æ•°æ®åº“çš„åå­—æ˜¯test_DATABASE_NAME,DATABASE_NAMEæ˜¯ä½ åœ¨settings.pyé‡Œé…ç½®çš„æ•°æ®åº“å.å¦‚æœ ä½ éœ€è¦ç»™æµ‹è¯•æ•°æ®åº“ä¸€ä¸ªå…¶ä»–çš„åå­—,åœ¨settings.pyä¸­æŒ‡å®šTEST_DATABASE_NAMEçš„å€¼ã€‚ä½¿ç”¨sqlite3æ—¶ï¼Œæ•°æ®åº“æ˜¯åœ¨å†…å­˜ä¸­åˆ›å»ºçš„</p>
<h4 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h4><p><a href="https://docs.djangoproject.com/en/1.10/topics/testing/tools/" target="_blank" rel="external">https://docs.djangoproject.com/en/1.10/topics/testing/tools/</a><br><a href="http://python.usyiyi.cn/django/topics/testing/tools.html" target="_blank" rel="external">http://python.usyiyi.cn/django/topics/testing/tools.html</a><br><a href="http://www.cnblogs.com/linxiyue/p/3886035.html" target="_blank" rel="external">http://www.cnblogs.com/linxiyue/p/3886035.html</a><br><a href="http://www.weiguda.com/blog/31/" target="_blank" rel="external">http://www.weiguda.com/blog/31/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;è¯´æ˜&quot;&gt;&lt;a href=&quot;#è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;è¯´æ˜&quot;&gt;&lt;/a&gt;è¯´æ˜&lt;/h4&gt;&lt;p&gt;Pythonå•å…ƒæµ‹è¯•ç±»æ‰©å±•äº†unittestæµ‹è¯•ç”¨ä¾‹,Djangoæä¾›äº†è¿™ä¸ªåŸºç±»çš„ä¸€äº›æ‰©å±•ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;ht
    
    </summary>
    
      <category term="Django" scheme="https://ttxsgoto.github.io/categories/Django/"/>
    
    
      <category term="TestCase" scheme="https://ttxsgoto.github.io/tags/TestCase/"/>
    
      <category term="unittest" scheme="https://ttxsgoto.github.io/tags/unittest/"/>
    
  </entry>
  
  <entry>
    <title>APIæ¥å£è®¤è¯</title>
    <link href="https://ttxsgoto.github.io/2017/03/27/API-auth/"/>
    <id>https://ttxsgoto.github.io/2017/03/27/API-auth/</id>
    <published>2017-03-27T14:09:52.000Z</published>
    <updated>2017-03-27T14:28:31.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« <a href="https://ttxsgoto.github.io/2017/03/26/API/">ã€Šç®€å•APIçš„å®ç°ã€‹</a>ï¼Œè¿™ç¯‡æ–‡ç« è¯´æ˜äº†é€šè¿‡apiæ–¹å¼æŠŠæ•°æ®ä¼ é€’ç»™æœåŠ¡ç«¯å¤„ç†ï¼Œä½†è¿™è¿‡ç¨‹ä¸­æ²¡æœ‰è®¤è¯åŠŸèƒ½ï¼Œæ— è®ºè°å‘ä»»ä½•å†…å®¹ï¼Œéƒ½ä¸€å¹¶æ¥æ”¶ï¼Œè¿™æ ·æ˜æ˜¾å­˜åœ¨ä¸å®‰å…¨æ€§ï¼Œè¿™ç¯‡æ–‡ç« åœ¨åŸæ¥çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†æ¥å£è®¤è¯åŠŸèƒ½ã€‚</p>
<h4 id="æ¥å£è®¤è¯æ–¹å¼"><a href="#æ¥å£è®¤è¯æ–¹å¼" class="headerlink" title="æ¥å£è®¤è¯æ–¹å¼"></a>æ¥å£è®¤è¯æ–¹å¼</h4><p>æ–¹å¼ä¸€ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">å®¢æˆ·ç«¯ï¼š</div><div class="line">    - é€šè¿‡å®šä¹‰å¯†é’¥</div><div class="line">    - å°†å¯†é’¥åŠ å¯†å‘é€ç»™æœåŠ¡ç«¯</div><div class="line">æœåŠ¡ç«¯ï¼š</div><div class="line">    - æœåŠ¡ç«¯å®šä¹‰ç›¸åŒçš„å¯†é’¥</div><div class="line">    - é€šè¿‡ç›¸åŒçš„åŠ å¯†ç®—æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼</div><div class="line">    - æŠŠæœåŠ¡ç«¯åŠ å¯†åçš„å€¼å’Œå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„åŠ å¯†çš„å¯†é’¥è¿›è¡Œå¯¹æ¯”</div><div class="line">ç¼ºç‚¹ï¼š</div><div class="line">    - å¯†é’¥å›ºå®šä¸å˜ï¼ŒåŠ å¯†åçš„å€¼å›ºå®šä¸å˜ï¼Œæ˜“æš´éœ²ï¼Œå®‰å…¨æ€§ä½</div></pre></td></tr></table></figure></p>
<p>æ–¹å¼äºŒï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">å®¢æˆ·ç«¯ï¼š</div><div class="line">    - é€šè¿‡å®šä¹‰å¯†é’¥</div><div class="line">    - å°†ç§˜é’¥å’Œå½“å‰æ—¶é—´æˆ³ä¸€èµ·åŠ å¯†ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼</div><div class="line">    - å°†åŠ å¯†åå¯†é’¥å’Œæ—¶é—´æˆ³ä¸€èµ·å‘é€ç»™æœåŠ¡ç«¯</div><div class="line">æœåŠ¡ç«¯ï¼š</div><div class="line">    - æœåŠ¡ç«¯å®šä¹‰ç›¸åŒçš„å¯†é’¥</div><div class="line">    - å°†å½“å‰æœåŠ¡å™¨ç«¯æ—¶é—´å’Œå‘é€è¿‡æ¥çš„å®¢æˆ·ç«¯æ—¶é—´è¿›è¡Œå¯¹æ¯”ï¼Œè®¾ç½®å¯æ¥å—çš„æ—¶é—´èŒƒå›´å¦‚ï¼š120sï¼›å¦‚æœæœåŠ¡å™¨å½“å‰æ—¶é—´-å‘é€è¿‡æ¥çš„å®¢æˆ·ç«¯&gt;120s ï¼Œå³è¿”å›false</div><div class="line">    - å°†æœåŠ¡ç«¯çš„å¯†é’¥å’Œå®¢æˆ·ç«¯æ—¶é—´è¿›è¡Œç›¸åŒçš„åŠ å¯†ç®—æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼</div><div class="line">    - æŠŠæœåŠ¡ç«¯åŠ å¯†åçš„å€¼å’Œå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„åŠ å¯†çš„å¯†é’¥è¿›è¡Œå¯¹æ¯”ï¼Œæ˜¯å¦ä¸€è‡´</div><div class="line">ä¼˜ç‚¹ï¼š</div><div class="line">    - åŠ å¯†åçš„å¯†é’¥æ¯æ¬¡ä¸åŒï¼Œä¸æ˜“ç ´è§£</div><div class="line">    - è®¾ç½®æœ‰æ•ˆæ—¶é•¿ï¼Œå¢åŠ å®‰å…¨æ€§</div><div class="line">ç¼ºç‚¹ï¼š</div><div class="line">    - å®¢æˆ·ç«¯æ—¶é—´å’ŒæœåŠ¡ç«¯æ—¶é—´ä¸èƒ½ç›¸å·®å¤ªå¤§ï¼Œå¦‚å¤ªå¤§é€ æˆè®¤è¯å¤±è´¥ï¼Œä¸æ˜“æ’æŸ¥é—®é¢˜ï¼Œæœ€å¥½ä½¿ç”¨åŒä¸€æ—¶é’ŸæœåŠ¡å™¨è¿›è¡ŒåŒæ­¥</div></pre></td></tr></table></figure></p>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><ul>
<li>å®¢æˆ·ç«¯</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding:utf8</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> platform</div><div class="line"><span class="keyword">import</span> psutil</div><div class="line"><span class="keyword">import</span> urllib,urllib2</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> hashlib</div><div class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> cpu_count</div><div class="line">  </div><div class="line">sys_info=&#123;&#125;</div><div class="line">sys_info[<span class="string">'system'</span>] = [] </div><div class="line">sys_info[<span class="string">'cpu'</span>] = []</div><div class="line">sys_info[<span class="string">'mem'</span>] = [] </div><div class="line">sys_info[<span class="string">'disk'</span>] = []</div><div class="line">sys_info[<span class="string">'wip'</span>] = []</div><div class="line">sys_info[<span class="string">'apikey'</span>] = []</div><div class="line">  </div><div class="line"><span class="comment">#ç³»ç»Ÿä¿¡æ¯</span></div><div class="line">system=sys_info[<span class="string">'system'</span>].append(platform.uname()[<span class="number">0</span>])</div><div class="line">  </div><div class="line"><span class="comment">#cpuä¸ªæ•°</span></div><div class="line">cpu_count=sys_info[<span class="string">'cpu'</span>].append(cpu_count())</div><div class="line">  </div><div class="line"><span class="comment">#å†…å­˜</span></div><div class="line">mem = psutil.virtual_memory()</div><div class="line">mem_info = sys_info[<span class="string">'mem'</span>].append(mem.total * <span class="number">1</span> / (<span class="number">1024</span>**<span class="number">3</span>))</div><div class="line">  </div><div class="line"><span class="comment">#ç£ç›˜ç©ºé—´</span></div><div class="line">sdiskusage = psutil.disk_usage(<span class="string">'/'</span>)</div><div class="line">disk_info =sys_info[<span class="string">'disk'</span>].append(sdiskusage.total * <span class="number">1</span> / (<span class="number">1024</span>**<span class="number">3</span>))</div><div class="line">  </div><div class="line"><span class="comment">#å¤–ç½‘ip</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">pub_ip</span><span class="params">()</span>:</span></div><div class="line">    url = <span class="string">"http://ip.cip.cc"</span></div><div class="line">    wip = urllib2.urlopen(url).readline().rstrip()</div><div class="line">    <span class="keyword">return</span>  wip</div><div class="line">sys_info[<span class="string">'wip'</span>].append(pub_ip())</div><div class="line"> </div><div class="line"><span class="comment">#è®¤è¯å¯†é’¥</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Api_key</span><span class="params">()</span>:</span></div><div class="line">    client_key = <span class="string">"ddfd-grgf-dsgf-dgfd"</span>    <span class="comment">#å®¢æˆ·ç«¯å®šä¹‰çš„key</span></div><div class="line">    hash_obj = hashlib.md5()     <span class="comment">#ä½¿ç”¨md5åŠ å¯†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨sha256</span></div><div class="line">    time_span = time.time()</div><div class="line">    hash_obj.update(<span class="string">"%s|%f"</span> %(client_key,time_span))    <span class="comment">#æ›´æ–°æ¶ˆæ¯ï¼Œè¿™ä¸ªupdateæ•´ä¸ªæ–‡ä»¶</span></div><div class="line">    encryption = hash_obj.hexdigest()    <span class="comment">#è®¡ç®—æ¶ˆæ¯æ‘˜è¦</span></div><div class="line">    result = <span class="string">"%s|%f"</span> %(encryption,time_span)</div><div class="line">    <span class="keyword">return</span> result</div><div class="line">sys_info[<span class="string">'apikey'</span>].append(Api_key())</div><div class="line">  </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="keyword">print</span> json.dumps(sys_info,indent=<span class="number">4</span>,ensure_ascii=<span class="keyword">False</span>)</div><div class="line">    data = urllib.urlencode(query=sys_info)</div><div class="line">    <span class="keyword">print</span> data</div><div class="line">    respose = urllib.urlopen(url=<span class="string">"http://127.0.0.1:8090/serveradd/"</span>, data=data)</div></pre></td></tr></table></figure>
<ul>
<li>æœåŠ¡ç«¯</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="comment">############### urls.py ################</span></div><div class="line">url(<span class="string">r'^serveradd/$'</span>,<span class="string">'app.views.serveradd'</span>),</div><div class="line"> </div><div class="line"><span class="comment">############### views.py ################</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">api_valid</span><span class="params">(data)</span>:</span></div><div class="line">    <span class="keyword">import</span> time,hashlib</div><div class="line">    server_key = <span class="string">"ddfd-grgf-dsgf-dgfd"</span>    <span class="comment">#æœåŠ¡ç«¯å®šä¹‰çš„keyï¼Œä¹Ÿå¯å®šä¹‰åœ¨å…¶ä»–ä½ç½®</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        encryption , time_span = data.split(<span class="string">"|"</span>)</div><div class="line">        <span class="keyword">print</span> <span class="string">"-------&gt;"</span> ,encryption</div><div class="line">        <span class="keyword">print</span> <span class="string">"-------&gt;"</span> ,time_span</div><div class="line">        time_span = float(time_span)</div><div class="line">        <span class="comment">#time.sleep(6)    #æ¨¡æ‹Ÿè®¤è¯è¶…æ—¶æ—¶é—´</span></div><div class="line">        now_time = time.time()</div><div class="line">        <span class="keyword">if</span> (now_time - time_span) &gt; <span class="number">5</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">"è¶…æ—¶ï¼Œè®¤è¯å¤±è´¥"</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">        hash_obj = hashlib.md5()    <span class="comment">#ä½¿ç”¨md5åŠ å¯†</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"hash_obj------------"</span>,hash_obj</div><div class="line">         </div><div class="line">        hash_obj.update(<span class="string">"%s|%f"</span> %(server_key,time_span))     <span class="comment">#æ›´æ–°æ¶ˆæ¯ï¼Œè¿™ä¸ªupdateæ•´ä¸ªæ–‡ä»¶</span></div><div class="line">        <span class="keyword">print</span> hash_obj.hexdigest()    <span class="comment">#è®¡ç®—æ¶ˆæ¯æ‘˜è¦</span></div><div class="line">        <span class="keyword">if</span> hash_obj.hexdigest() == encryption:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">"å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯†é’¥ä¸ä¸€è‡´ï¼Œè®¤è¯å¤±è´¥."</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">    <span class="keyword">except</span> Exception,e:</div><div class="line">        <span class="keyword">pass</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line">     </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">api_auth</span><span class="params">(func)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(req)</span>:</span></div><div class="line">        request_dict = req.POST</div><div class="line">        api_key = request_dict.get(<span class="string">'apikey'</span>)</div><div class="line">        api_key = api_key[<span class="number">2</span>:<span class="number">-2</span>]</div><div class="line">        <span class="keyword">print</span> api_key</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> api_key:</div><div class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"Unauthorized."</span>)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> api_valid(api_key):</div><div class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">"Unauthorized."</span>)</div><div class="line">        <span class="keyword">return</span> func(req)</div><div class="line">    <span class="keyword">return</span> wrapper</div><div class="line"> </div><div class="line"><span class="meta">@api_auth</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">serveradd</span><span class="params">(req)</span>:</span></div><div class="line">    <span class="keyword">if</span> req.method == <span class="string">'GET'</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"GET method"</span></div><div class="line">    <span class="keyword">elif</span> req.method == <span class="string">'POST'</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"POST method"</span></div><div class="line">        request_dict = req.POST</div><div class="line">        system = request_dict.get(<span class="string">'system'</span>)</div><div class="line">        wip = request_dict.get(<span class="string">'wip'</span>)</div><div class="line">        data = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> request_dict.items()&#125;</div><div class="line">        host = Host.objects.filter(wip=wip).first()</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> host:</div><div class="line">            host = Host(**data)</div><div class="line">        host.save(force_insert=<span class="keyword">True</span>)</div><div class="line">    	data = &#123;</div><div class="line">            <span class="string">'msg'</span>: <span class="string">'ok'</span>,</div><div class="line">            <span class="string">'status'</span>: <span class="string">'ok'</span></div><div class="line">            &#125;</div><div class="line">    <span class="keyword">return</span> HttpResponse(data)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">#### ç»“æœè¯´æ˜</div><div class="line">1.è®¤è¯æˆåŠŸï¼Œå†…å®¹å¦‚ä¸‹ï¼š</div><div class="line">POST method-------</div><div class="line">&lt;QueryDict: &#123;u&apos;apikey&apos;: [u&quot;[&apos;a73421ee7c21d9d590b956f07ed16ca2|1477795149.448697&apos;]&quot;], u&apos;mem&apos;: [u&apos;[4L]&apos;], u&apos;system&apos;: [u&quot;[&apos;Darwin&apos;]&quot;], u&apos;wip&apos;: [u&quot;[&apos;14.196.121.237&apos;]&quot;], u&apos;disk&apos;: [u&apos;[232]&apos;], u&apos;cpu&apos;: [u&apos;[4]&apos;]&#125;&gt;</div><div class="line">----[&apos;Darwin&apos;]----[&apos;14.196.121.237&apos;]</div><div class="line"> </div><div class="line">2.å½“keyä¸åŒæ—¶ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ä¿¡æ¯ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</div><div class="line">1ab7370c45587a9d4d0d1d8f28bd09d7|1477795289.186698</div><div class="line">-------&gt; 1ab7370c45587a9d4d0d1d8f28bd09d7</div><div class="line">-------&gt; 1477795289.186698</div><div class="line">e9d558f11074410464d1769fb2930e81</div><div class="line">å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯†é’¥ä¸ä¸€è‡´ï¼Œè®¤è¯å¤±è´¥ã€‚</div><div class="line"> </div><div class="line">3.å½“è®¤è¯æ—¶é—´è¶…æ—¶æ—¶(è¿™é‡Œè®¾ç½®è¶…æ—¶æ—¶é—´ä¸º5sï¼Œæ¨¡æ‹Ÿå‘é€è¿‡æ¥çš„æ—¶é—´ä¸º6så)ï¼ŒæœåŠ¡ç«¯æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ä¿¡æ¯ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</div><div class="line">9dc916fbb04c1310cece3aaa5b2d1b7e|1477795521.379039</div><div class="line">-------&gt; 9dc916fbb04c1310cece3aaa5b2d1b7e</div><div class="line">-------&gt; 1477795521.379039</div><div class="line">è¶…æ—¶ï¼Œè®¤è¯å¤±è´¥</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h4&gt;&lt;p&gt;ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« &lt;a href=&quot;https://ttxsgoto.github.io/2017/03/26/API/&quot;&gt;ã€Šç®€å•APIçš„å®ç°
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="api" scheme="https://ttxsgoto.github.io/tags/api/"/>
    
  </entry>
  
  <entry>
    <title>æœ€ç®€å•APIå®ç°</title>
    <link href="https://ttxsgoto.github.io/2017/03/26/API/"/>
    <id>https://ttxsgoto.github.io/2017/03/26/API/</id>
    <published>2017-03-26T13:51:41.000Z</published>
    <updated>2017-03-27T14:08:05.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ä»¥å‰çš„ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œåœ¨åšç³»ç»Ÿèµ„æºä¸ŠæŠ¥æ—¶ï¼Œå› ä¸çŸ¥é“æ€ä¹ˆå°†æ•°æ®ä¸ŠæŠ¥ç»™æœåŠ¡ç«¯å†å±•ç¤ºï¼Œåæ¥ç”¨äº†ä¸€ç§æœ€ç›´æ¥å’Œä¸å®‰å…¨çš„æ–¹å¼ï¼Œç›´æ¥å†™å…¥æ•°æ®åº“ï¼Œè¿™æ ·åšå¾ˆä¸æ–¹ä¾¿ï¼Œä¸»è¦å› ä¸ºéœ€è¦æˆæƒå’Œåšç›¸å…³çš„é˜²ç«å¢™ç­–ç•¥ï¼ˆå¦‚æœæœ‰å‡ ç™¾ä¸Šåƒå°clientï¼Œå°±ç®—ç”¨ç½‘æ®µçš„å½¢å¼ï¼Œä¹Ÿéœ€è¦é‡å¤æ“ä½œï¼‰ï¼Œè€Œä¸”å¦‚æœæ•°æ®åº“çš„ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦æŠŠæ‰€æœ‰å®¢æˆ·ç«¯çš„æ•°æ®åº“ä¿¡æ¯è¿›è¡Œä¿®æ”¹ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼›æœ€è¿‘å­¦ä¹ äº†ä¸€ç§é€šè¿‡urlæ–¹å¼å°†æ•°æ®ä¼ é€’ç»™æœåŠ¡ç«¯ï¼Œå®ç°ç®€å•çš„apiåŠŸèƒ½ï¼Œç®€å•ä¾‹å­å¦‚ä¸‹ï¼š</p>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><ul>
<li>å®¢æˆ·ç«¯</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding:utf8</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> platform</div><div class="line"><span class="keyword">import</span> psutil</div><div class="line"><span class="keyword">import</span> urllib,urllib2</div><div class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> cpu_count</div><div class="line"> </div><div class="line">sys_info=&#123;&#125;</div><div class="line">sys_info[<span class="string">'system'</span>] = []</div><div class="line">sys_info[<span class="string">'cpu'</span>] = []</div><div class="line">sys_info[<span class="string">'mem'</span>] = []</div><div class="line">sys_info[<span class="string">'disk'</span>] = []</div><div class="line">sys_info[<span class="string">'wip'</span>] = []</div><div class="line"> </div><div class="line"><span class="comment">#ç³»ç»Ÿä¿¡æ¯</span></div><div class="line">system=sys_info[<span class="string">'system'</span>].append(platform.uname()[<span class="number">0</span>])</div><div class="line"> </div><div class="line"><span class="comment">#cpuä¸ªæ•°</span></div><div class="line">cpu_count=sys_info[<span class="string">'cpu'</span>].append(cpu_count())</div><div class="line"> </div><div class="line"><span class="comment">#å†…å­˜</span></div><div class="line">mem = psutil.virtual_memory()</div><div class="line">mem_info = sys_info[<span class="string">'mem'</span>].append(mem.total * <span class="number">1</span> / (<span class="number">1024</span>**<span class="number">3</span>))</div><div class="line"> </div><div class="line"><span class="comment">#ç£ç›˜ç©ºé—´</span></div><div class="line">sdiskusage = psutil.disk_usage(<span class="string">'/'</span>)</div><div class="line">disk_info =sys_info[<span class="string">'disk'</span>].append(sdiskusage.total * <span class="number">1</span> / (<span class="number">1024</span>**<span class="number">3</span>))</div><div class="line"></div><div class="line"><span class="comment">#å¤–ç½‘ip</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">pub_ip</span><span class="params">()</span>:</span></div><div class="line">    url = <span class="string">"http://ip.cip.cc"</span></div><div class="line">    wip = urllib2.urlopen(url).readline().rstrip()</div><div class="line">    <span class="keyword">return</span>  wip</div><div class="line">sys_info[<span class="string">'wip'</span>].append(pub_ip())</div><div class="line"> </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="keyword">print</span> json.dumps(sys_info,indent=<span class="number">4</span>,ensure_ascii=<span class="keyword">False</span>)</div><div class="line">    data = urllib.urlencode(query=sys_info)</div><div class="line">    respose = urllib.urlopen(url=<span class="string">"http://127.0.0.1:8090/serveradd/"</span>, data=data)</div></pre></td></tr></table></figure>
<ul>
<li>æœåŠ¡ç«¯</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">############### urls.py ################</span></div><div class="line">url(<span class="string">r'^serveradd/$'</span>,<span class="string">'app.views.serveradd'</span>),</div><div class="line"> </div><div class="line"><span class="comment">############### views.py ################</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">serveradd</span><span class="params">(req)</span>:</span></div><div class="line">    <span class="keyword">if</span> req.method == <span class="string">'GET'</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"GET method"</span></div><div class="line">    <span class="keyword">elif</span> req.method == <span class="string">'POST'</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"POST method"</span></div><div class="line">        request_dict = req.POST</div><div class="line">        system = request_dict.get(<span class="string">'system'</span>)</div><div class="line">        wip = request_dict.get(<span class="string">'wip'</span>)</div><div class="line">        data = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> request_dict.items()&#125;</div><div class="line">        host = Host.objects.filter(wip=wip).first()</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> host:</div><div class="line">            host = Host(**data)</div><div class="line">        host.save(force_insert=<span class="keyword">True</span>)</div><div class="line">    	data = &#123;</div><div class="line">            <span class="string">'msg'</span>: <span class="string">'ok'</span>,</div><div class="line">            <span class="string">'status'</span>: <span class="string">'ok'</span></div><div class="line">            &#125;</div><div class="line">    <span class="keyword">return</span> HttpResponse(data)</div><div class="line"> </div><div class="line"><span class="comment">############### ç»“æœ ################</span></div><div class="line">POST method</div><div class="line">&lt;QueryDict: &#123;<span class="string">u'mem'</span>: [<span class="string">u'[4L]'</span>], <span class="string">u'cpu'</span>: [<span class="string">u'[4]'</span>], <span class="string">u'disk'</span>: [<span class="string">u'[232]'</span>], <span class="string">u'system'</span>: [<span class="string">u"['Darwin']"</span>], <span class="string">u'wip'</span>: [<span class="string">u"['12.196.9.193']"</span>]&#125;&gt;</div><div class="line">----[<span class="string">'Darwin'</span>]----[<span class="string">'12.196.9.193'</span>]</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h4&gt;&lt;p&gt;ä»¥å‰çš„ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œåœ¨åšç³»ç»Ÿèµ„æºä¸ŠæŠ¥æ—¶ï¼Œå› ä¸çŸ¥é“æ€ä¹ˆå°†æ•°æ®ä¸ŠæŠ¥ç»™æœåŠ¡ç«¯å†å±•ç¤ºï¼Œåæ¥ç”¨äº†ä¸€ç§æœ€ç›´æ¥å’Œä¸å®‰å…¨çš„æ–¹å¼ï¼Œç›´æ¥å†™å…¥æ•°æ®åº“ï¼Œè¿™æ ·åšå¾ˆä¸æ–¹ä¾¿
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="api" scheme="https://ttxsgoto.github.io/tags/api/"/>
    
  </entry>
  
  <entry>
    <title>mysqldbæ¨¡å—</title>
    <link href="https://ttxsgoto.github.io/2017/03/25/mysqldb/"/>
    <id>https://ttxsgoto.github.io/2017/03/25/mysqldb/</id>
    <published>2017-03-25T13:43:12.000Z</published>
    <updated>2017-03-27T14:08:23.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>pythonä¸­æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼Œé¦–å…ˆå®‰è£…MySQL-pythonæ¨¡å—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install -y MySQL-python æˆ–è€…</div><div class="line">pip install MySQL-python</div></pre></td></tr></table></figure></p>
<h4 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h4><p>åˆ›å»ºæ•°æ®åº“è¿æ¥ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">conn = MySQLdb.connect(</div><div class="line">    host=<span class="string">'127.0.0.1'</span>,</div><div class="line">    user=<span class="string">'test'</span>,</div><div class="line">    passwd=<span class="string">'test'</span>,</div><div class="line">    db=<span class="string">'test01'</span>,</div><div class="line">    port=<span class="number">3306</span>,</div><div class="line">    charset=utf8)</div><div class="line">cur = conn.cursor()        <span class="comment">#é€šè¿‡è·å–åˆ°çš„æ•°æ®åº“è¿æ¥connä¸‹çš„cursor()æ–¹æ³•æ¥åˆ›å»ºæ¸¸æ ‡ï¼Œä»¥å…ƒç¥–å½¢å¼è¾“å‡º</span></div><div class="line">conn.cursor(MySQLdb.cursors.DictCursor)   <span class="comment">#å­—å…¸å½¢å¼è¾“å‡º</span></div><div class="line">conn.selecct_db(dbname)  <span class="comment">#é€‰æ‹©æ•°æ®åº“</span></div><div class="line">cur.execute(sqlè¯­å¥)    <span class="comment">#ç”¨æ¥æ‰§è¡Œç›¸åº”çš„sqlè¯­å¥</span></div><div class="line">cur.fetchall()  <span class="comment">#è·å–æŸ¥è¯¢ç»“æœ</span></div><div class="line">cur.scroll(ä½ç½®ï¼Œæ¨¡å¼) <span class="comment">#è°ƒæ•´æŒ‡é’ˆ</span></div><div class="line">cur.rollback()  <span class="comment">#å‘ç”Ÿé”™è¯¯æ—¶å›æ»š</span></div><div class="line">cur.close()  	<span class="comment">#å…³é—­æ¸¸æ ‡</span></div><div class="line">conn.commit()   <span class="comment">#æ–¹æ³•åœ¨æäº¤äº‹åŠ¡ï¼Œåœ¨å‘æ•°æ®åº“æ’å…¥ä¸€ä¸ªæ•°æ®æ—¶å¿…é¡»ç”¨æ­¤æ–¹æ³•ï¼Œå¦åˆ™æ•°æ®ä¸ä¼šè¢«çœŸæ­£æ’å…¥</span></div><div class="line">conn.close()  <span class="comment">#å…³é—­æ•°æ®åº“è¿æ¥</span></div></pre></td></tr></table></figure></p>
<h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding:utf8</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> MySQLdb</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysql</span><span class="params">(object)</span>:</span></div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host, port, user, passwd, db)</span>:</span></div><div class="line">        self.host = host</div><div class="line">        self.port = port</div><div class="line">        self.user = user</div><div class="line">        self.passwd = passwd</div><div class="line">        self.db = db</div><div class="line"> </div><div class="line">        self.conn = MySQLdb.Connect(</div><div class="line">            host = self.host,</div><div class="line">            user = self.user,</div><div class="line">            passwd = self.passwd,</div><div class="line">            db = self.db,</div><div class="line">            port = self.port,</div><div class="line">            charset = <span class="string">'utf8'</span></div><div class="line">        )</div><div class="line">        self.cur = self.conn.cursor()</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">()</span>:</span></div><div class="line">    	sql = <span class="string">"select * from test;"</span>    <span class="comment">#æ‰§è¡Œçš„sqlè¯­å¥</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            self.cur.execute(sql)</div><div class="line">            result = self.cur.fetchall()</div><div class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> list(result):</div><div class="line">                <span class="keyword">print</span> line[<span class="number">0</span>],line[<span class="number">1</span>]</div><div class="line">        <span class="keyword">except</span> Exception,e:</div><div class="line">            <span class="keyword">print</span> <span class="string">"\033[31m %s \033[0m"</span> %e</div><div class="line"></div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self)</span>:</span></div><div class="line">            sql = <span class="string">"""INSERT into group(id,is_admin,name,created_time)\</span></div><div class="line">                    VALUESï¼ˆ1,FALSE,'ttxsgoto','å¤©å¤©å‘ä¸Šgoto'),\</div><div class="line">                    (2,FALSE,'ttxsgoto02','å¤©å¤©å‘ä¸Šgoto02');"""</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                self.cur.execute(sql)</div><div class="line">                self.conn.commit()	<span class="comment"># æäº¤åˆ°æ•°æ®åº“æ‰§è¡Œ</span></div><div class="line">            <span class="keyword">except</span> Exception, e:</div><div class="line">                <span class="keyword">print</span> <span class="string">"\033[31m %s \033[0m"</span> % e</div><div class="line">            self.cur.close()</div><div class="line">            self.conn.close()</div><div class="line"> </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    db = Mysql(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">'root'</span>, db=<span class="string">'test'</span>)</div><div class="line">    db.select()</div><div class="line">    db.insert()</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;è¯´æ˜&quot;&gt;&lt;a href=&quot;#è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;è¯´æ˜&quot;&gt;&lt;/a&gt;è¯´æ˜&lt;/h4&gt;&lt;p&gt;pythonä¸­æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼Œé¦–å…ˆå®‰è£…MySQL-pythonæ¨¡å—&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="mysqldb" scheme="https://ttxsgoto.github.io/tags/mysqldb/"/>
    
  </entry>
  
  <entry>
    <title>fabricæ¨¡å—</title>
    <link href="https://ttxsgoto.github.io/2017/03/19/fabric/"/>
    <id>https://ttxsgoto.github.io/2017/03/19/fabric/</id>
    <published>2017-03-19T12:47:15.000Z</published>
    <updated>2017-03-19T12:51:03.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>åŸºäºparamikoçš„å°è£…ï¼Œè¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œæ–¹ä¾¿ç®€å•ï¼Œå®ç”¨æ€§å¼ºã€‚</p>
<h4 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-l  æ˜¾ç¤ºå¯ç”¨çš„task</div><div class="line">-f  æŒ‡å®šå…¥å£æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºfabfile.py</div><div class="line">-H  æŒ‡å®šç›®æ ‡ä¸»æœºï¼Œä¸»æœºä¹‹é—´ç”¨ï¼Œå·åˆ†éš”</div><div class="line">-P  å·²å¹¶è¡Œæ‰§è¡Œï¼Œé»˜è®¤ä¸ºä¸²è¡Œ</div><div class="line">-R  æŒ‡å®šroleè§’è‰²</div><div class="line">-t  è¿æ¥è¶…æ—¶æ—¶é—´(s)</div><div class="line">-T  æ‰§è¡Œå‘½ä»¤è¶…æ—¶æ—¶é—´(s)</div></pre></td></tr></table></figure>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">from fabric.api import env</div><div class="line">########## å±æ€§ ##########</div><div class="line">env.hosts    -ä¸»æœºip</div><div class="line">env.port    -ä¸»æœºç«¯å£ï¼Œé»˜è®¤ä¸º22</div><div class="line">env.passworkd   -sshå¯†ç </div><div class="line">env.roledefs    -è§’è‰²åˆ†ç»„ï¼Œenv.roledefs=&#123;&apos;web1&apos;:[&apos;192.168.0.192&apos;]&#125;ï¼Œè°ƒç”¨@roles(&apos;web1&apos;)</div><div class="line">env.passwords   -å­—å…¸ï¼Œä¸ºæ¯å°æœºå™¨è®¾ç½®å¯†ç ï¼Œkeyæ˜¯ipï¼Œvalueæ˜¯å¯†ç ï¼Œå¦‚&#123;&apos;root@192.168.0.200:22&apos;:&apos;root&apos;&#125;ï¼Œè°ƒç”¨ï¼š@hosts(&apos;root@192.168.0.200:22&apos;)</div><div class="line">env.exclude_hosts   -æŒ‡å®šæ’é™¤ä¸»æœºåˆ—è¡¨ï¼Œåœ¨fabæ‰§è¡Œæ—¶ï¼Œå¿½ç•¥åˆ—è¡¨ä¸­çš„æœºå™¨ï¼›env.exclude_hosts= [&apos;10.1.1.2&apos;]</div><div class="line"> </div><div class="line">########## API ##########</div><div class="line">local(&apos;pwd&apos;)    -æ‰§è¡Œæœ¬åœ°å‘½ä»¤</div><div class="line">lcd(&apos;/tmp&apos;)     -åˆ‡æ¢æœ¬åœ°ç›®å½•</div><div class="line">cd(&apos;/tmp&apos;)      -åˆ‡æ¢è¿œç¨‹ç›®å½•</div><div class="line">run(&apos;uname -s&apos;) -æ‰§è¡Œè¿œç¨‹å‘½ä»¤</div><div class="line">sudo(&apos;service sshd restart&apos;)   -æ‰§è¡Œè¿œç¨‹sudoï¼Œ</div><div class="line">put(&apos;/local/test&apos;,&apos;/remote/test&apos;)   -ä¸Šä¼ </div><div class="line">get(&apos;/remote/test/&apos;,&apos;/local/test&apos;)  -ä¸‹è½½</div><div class="line">prompt  -è·å¾—ç”¨æˆ·è¾“å…¥ä¿¡æ¯,å¦‚:prompt(&apos;please Input password:&apos;);</div><div class="line">confirm -è·å¾—æç¤ºä¿¡æ¯ç¡®è®¤,å¦‚:confirm(&quot;Continue[Y/N]ï¼Ÿ&quot;);</div><div class="line">@task(alias=&apos;&apos;)   -å‡½æ•°ä¿®é¥°ç¬¦,æ ‡è¯†çš„å‡½æ•°ä¸ºfabå¯è°ƒç”¨çš„,éæ ‡è®°å¯¹fabä¸å¯è§,aliasè®¾ç½®åˆ«å</div><div class="line">@parallel(pool_size=5)   -å¹¶è¡Œæ‰§è¡Œä»»åŠ¡å½±å“çš„æœ€å°å•ä½æ˜¯ä»»åŠ¡ï¼Œæ‰€ä»¥åŠŸèƒ½å¯ç”¨æˆ–ç¦ç”¨ä»¥ä»»åŠ¡ä¸ºå•ä½,pool_sizeæŒ‡å®šå¹¶å‘ä¸ªæ•°</div><div class="line">@serial     -é¡ºåºæ‰§è¡Œï¼Œéå¹¶å‘æ‰§è¡Œ</div><div class="line">@runs_once  -åªæœ‰ç¬¬ä¸€å°æ‰§è¡Œæ­¤å‡½æ•°</div><div class="line">with cd(&apos;/root&apos;):   pass    -withè®©åé¢çš„æ‰§è¡Œç»§æ‰¿å½“å‰æ‰€åœ¨çŠ¶æ€</div><div class="line"> </div><div class="line">__all__ = [&apos;run1&apos;,&apos;hello&apos;]  -å®šä¹‰å…¨å±€çš„å¯ç”¨tasksåˆ—è¡¨</div><div class="line"></div><div class="line">from fabric.colors import * #ç”¨äºæ‰“å°æ˜¾ç¤ºé¢œè‰²   -print(yellow(&quot;This text is yellow!&quot;,bold=True))    boldï¼šç”¨äºè®¾ç½®ç²—ä½“</div></pre></td></tr></table></figure>
<h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"> </div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> with_statement</div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> unicode_literals</div><div class="line"> </div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> fabric.api <span class="keyword">import</span> local, cd, run, settings,env,task</div><div class="line"><span class="keyword">from</span> fabric.context_managers <span class="keyword">import</span> prefix</div><div class="line"><span class="keyword">from</span> fabric.contrib.console <span class="keyword">import</span> confirm</div><div class="line"><span class="keyword">from</span> fabric.decorators <span class="keyword">import</span> roles, parallel, serial, runs_once</div><div class="line"><span class="keyword">from</span> fabric.colors <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> fabric.operations <span class="keyword">import</span> prompt</div><div class="line"> </div><div class="line">env.hosts=[<span class="string">'192.168.0.192'</span>,<span class="string">'192.168.0.200'</span>]</div><div class="line">env.password=<span class="string">'root'</span></div><div class="line">env.user=<span class="string">'root'</span></div><div class="line"><span class="comment">#env.roledefs=&#123;'web1':['192.168.0.192'],'web2':['192.168.0.200']&#125;</span></div><div class="line"> </div><div class="line">__all__ = [<span class="string">'local_deploy'</span>,<span class="string">'run1'</span>,<span class="string">'hello'</span>,<span class="string">'test_confirm'</span>,<span class="string">'test_prompt'</span>]     <span class="comment">#å®šä¹‰å…¨å±€å¯ç”¨çš„tasksåˆ—è¡¨</span></div><div class="line"> </div><div class="line"><span class="meta">@task</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line">    ä¼ é€’å‚æ•°: fab hello:name=ttxsgoto</div><div class="line">    '''</div><div class="line">    <span class="keyword">print</span> <span class="string">"hello,&#123;&#125;"</span>.format(name)</div><div class="line"> </div><div class="line"><span class="meta">@task</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">local_deploy</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line">    æ‰§è¡Œæœ¬åœ°å‘½ä»¤</div><div class="line">    :return:</div><div class="line">    '''</div><div class="line">    <span class="keyword">with</span> settings(warn_only=<span class="keyword">True</span>):</div><div class="line">        <span class="keyword">return</span> local(<span class="string">'ls /Users/study/studypy/train/fabric_demo/fabfile.py'</span>)</div><div class="line">    <span class="comment"># local('cat fabfile.py')</span></div><div class="line"> </div><div class="line"><span class="meta">@task   #æ ‡è¯†ä¸ºfabå¯è°ƒç”¨</span></div><div class="line"><span class="meta">@roles('web2')  #è°ƒç”¨roles</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">with_deploy</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line">    æ‰§è¡Œwithå‡½æ•°</div><div class="line">    :return:</div><div class="line">    lcd æœ¬åœ°æ‰§è¡Œ,cd è¿œç¨‹æ‰§è¡Œ</div><div class="line">    '''</div><div class="line">    dir = <span class="string">'/etc/network/'</span></div><div class="line">    <span class="keyword">with</span> cd(dir):</div><div class="line">        run(<span class="string">'ls .'</span>)</div><div class="line"> </div><div class="line"><span class="meta">@task</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dir</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    remote list</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    dir = <span class="string">'/etc/'</span></div><div class="line">    <span class="keyword">with</span> cd(dir):</div><div class="line">        run(<span class="string">'ls -l rc.local'</span>)</div><div class="line"> </div><div class="line"><span class="meta">@task(default=True)</span></div><div class="line"><span class="meta">@parallel(pool_size=3)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">run1</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    å¯åŠ¨</div><div class="line">    :return:</div><div class="line">    """</div><div class="line">    <span class="keyword">print</span> time.ctime()</div><div class="line">    hello(<span class="string">'ttxsgoto'</span>)</div><div class="line">    local_deploy()</div><div class="line">    dir()</div><div class="line">    time.sleep(<span class="number">2</span>)</div><div class="line">    <span class="keyword">print</span> time.ctime()</div><div class="line">    print(yellow(<span class="string">"This text is green!"</span>,bold=<span class="keyword">True</span>)) <span class="comment">#ç”¨äºæ‰“å°æ˜¾ç¤ºé¢œè‰², boldï¼šç”¨äºè®¾ç½®ç²—ä½“</span></div><div class="line"> </div><div class="line"><span class="meta">@task()</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">runserver</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">with</span> prefix(<span class="string">'workon ownserver'</span>):</div><div class="line">        run(<span class="string">'cd /date/ownserver &amp;&amp; python manage.py runserver 0.0.0.0:8000'</span>)</div><div class="line"> </div><div class="line"><span class="meta">@task()</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_confirm</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line">    æµ‹è¯•äº¤äº’ç¡®è®¤</div><div class="line">    :return:</div><div class="line">    '''</div><div class="line">    INFO = confirm(<span class="string">'Are you sure?[yes/no]?'</span>)</div><div class="line">    <span class="keyword">if</span> INFO:</div><div class="line">        <span class="keyword">print</span> <span class="string">'yes'</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'no'</span></div><div class="line"> </div><div class="line"><span class="meta">@task()</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_prompt</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line">    æµ‹è¯•è¾“å…¥ä¿¡æ¯</div><div class="line">    :return:</div><div class="line">    '''</div><div class="line">    Text = prompt(<span class="string">'Input word:'</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'-----'</span>,Text</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;è¯´æ˜&quot;&gt;&lt;a href=&quot;#è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;è¯´æ˜&quot;&gt;&lt;/a&gt;è¯´æ˜&lt;/h4&gt;&lt;p&gt;åŸºäºparamikoçš„å°è£…ï¼Œè¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œæ–¹ä¾¿ç®€å•ï¼Œå®ç”¨æ€§å¼ºã€‚&lt;/p&gt;
&lt;h4 id=&quot;å‚æ•°&quot;&gt;&lt;a href=&quot;#å‚æ•°&quot; class=&quot;h
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="fabric" scheme="https://ttxsgoto.github.io/tags/fabric/"/>
    
  </entry>
  
  <entry>
    <title>ansible</title>
    <link href="https://ttxsgoto.github.io/2017/03/18/ansible/"/>
    <id>https://ttxsgoto.github.io/2017/03/18/ansible/</id>
    <published>2017-03-18T13:19:30.000Z</published>
    <updated>2017-03-19T13:53:17.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Ansibleæ¶æ„å›¾"><a href="#Ansibleæ¶æ„å›¾" class="headerlink" title="Ansibleæ¶æ„å›¾"></a>Ansibleæ¶æ„å›¾</h3><p><img src="https://ttxsgoto.github.io/img/ansible/ansible01.png" alt=""></p>
<h3 id="Ansibleç‰¹æ€§"><a href="#Ansibleç‰¹æ€§" class="headerlink" title="Ansibleç‰¹æ€§"></a>Ansibleç‰¹æ€§</h3><pre><code>- åŸºäºpythonå®ç°ï¼Œç”±Paramikeï¼ŒPyYAMLå’ŒJinjia2ä¸‰ä¸ªå…³é”®æ¨¡å—
- éƒ¨ç½²ç®€å•ï¼Œagentless
- ä½¿ç”¨sshåè®®
- ä¸»ä»é›†ä¸­åŒ–æ¨¡å¼
- æ”¯æŒè‡ªå®šä¹‰æ¨¡å—
- æ”¯æŒplaybook
- å¹‚ç­‰æ€§ï¼šä¸€ç§æ“ä½œå¯é‡å¤å¤šæ¬¡ç»“æœç›¸åŒ
</code></pre><h3 id="Ansibleæ ¸å¿ƒç»„ä»¶"><a href="#Ansibleæ ¸å¿ƒç»„ä»¶" class="headerlink" title="Ansibleæ ¸å¿ƒç»„ä»¶"></a>Ansibleæ ¸å¿ƒç»„ä»¶</h3><pre><code>- ansible coreï¼šAnsibleçš„æ ¸å¿ƒç¨‹åº
- host iventoryï¼šè®°å½•äº†æ¯ä¸€ä¸ªç”±Ansibleç®¡ç†çš„ä¸»æœºä¿¡æ¯ï¼Œä¿¡æ¯åŒ…æ‹¬sshç«¯å£ï¼Œrootå¸å·å¯†ç ï¼Œipåœ°å€ç­‰
- core modulesï¼šAnsibleç®¡ç†ä¸»æœºä¹‹å‰ï¼Œå…ˆè°ƒç”¨core Modulesä¸­çš„æ¨¡å—ï¼Œç„¶åæŒ‡æ˜ç®¡ç†Host Lnventoryä¸­çš„ä¸»æœºï¼Œå°±å¯ä»¥å®Œæˆç®¡ç†ä¸»æœº
- custom modulesï¼šè‡ªå®šä¹‰æ¨¡å—
- playbook(yaml,jinjia2)ï¼šYAMLæ ¼å¼æ–‡ä»¶ï¼Œå¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­
- connect pluginï¼šè¿æ¥æ’ä»¶ï¼ŒAnsibleå’ŒHosté€šä¿¡ä½¿ç”¨
</code></pre><h3 id="Invetoryæ–‡ä»¶è¯´æ˜"><a href="#Invetoryæ–‡ä»¶è¯´æ˜" class="headerlink" title="Invetoryæ–‡ä»¶è¯´æ˜"></a>Invetoryæ–‡ä»¶è¯´æ˜</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[web01]</div><div class="line">192.168.0.1 ansible_ssh_user=root ansible_ssh_pass=xxx</div><div class="line">[web02]</div><div class="line">192.168.0.[2:5]    #ä»2åˆ°5çš„ä¸»æœº</div><div class="line">[web03]    #å¯¹åº”å˜é‡</div><div class="line">192.168.0.8 port=80 hostname=&quot;test01&quot;</div><div class="line">192.168.0.9 port=8080 hostname=&quot;test02&quot;</div><div class="line">[web03:vars]    #å¯¹web03ç»„å®šä¹‰å˜é‡</div><div class="line">server1=ttxsgoto1.com</div><div class="line">server2=ttxsgoto2.com</div><div class="line">[webservers:children]    #ç»„åµŒå¥—ï¼Œwebserversç»„åŒ…æ‹¬web01å’Œweb02ä¸‹çš„ä¸»æœº</div><div class="line">web01</div><div class="line">web02</div><div class="line">[webservers:vars]    #ç»„å®šä¹‰å˜é‡</div><div class="line">server1=tttxsgoto.com</div></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ¨¡å—å¸®åŠ©ä¿¡æ¯</p>
<pre><code>- ansible-doc -l
- ansible-doc -s  module_name
</code></pre><p>ansibleå‘½ä»¤åº”ç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ansible &lt;host-pattern&gt; [-f forks] [-m module_name] [-a args]</div><div class="line">-f forks:å¯åŠ¨å¹¶å‘çº¿ç¨‹æ•°</div><div class="line">-m module_name:ä½¿ç”¨çš„æ¨¡å—å</div><div class="line">-a args:æ¨¡å—ç‰¹æœ‰çš„å‚æ•°</div></pre></td></tr></table></figure></p>
<h3 id="å¸¸è§æ¨¡å—"><a href="#å¸¸è§æ¨¡å—" class="headerlink" title="å¸¸è§æ¨¡å—"></a>å¸¸è§æ¨¡å—</h3><ul>
<li>command</li>
<li>cron</li>
<li>user</li>
<li>group</li>
<li>copy</li>
<li>file</li>
<li>ping</li>
<li>setup</li>
<li>service</li>
<li>shell</li>
<li>script</li>
<li>yum/apt</li>
</ul>
<p>cron:è®¡åˆ’ä»»åŠ¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">present: å®‰è£…ä»»åŠ¡</div><div class="line">absent:ç§»é™¤ä»»åŠ¡</div><div class="line">ansible local -m cron -a &apos;minute=*/5 job=&quot;/bin/echo abc &gt; /root/abc.log&quot; name=&quot;test cron job&quot;  state=&quot;absent&quot; &apos;</div></pre></td></tr></table></figure></p>
<p>user:ç”¨æˆ·ç®¡ç†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- name:æŒ‡æ˜æ·»åŠ çš„ç”¨æˆ·å</div><div class="line">- ansible local -m user -a &apos;name=&quot;user1&quot;&apos;</div></pre></td></tr></table></figure></p>
<p>group:ç”¨æˆ·ç»„ç®¡ç†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ansible local -m group -a &apos;name=user1 gid=306 system=yes&apos;    #æ·»åŠ ç”¨æˆ·ç»„</div><div class="line">ansible local -m group -a &apos;name=user1 gid=306 system=yes state=absent&apos;    #åˆ é™¤ç”¨æˆ·ç»„</div></pre></td></tr></table></figure></p>
<p>copy:æ–‡ä»¶å¤åˆ¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">src=:å®šä¹‰æœ¬åœ°æºè·¯å¾„</div><div class="line">content=:å–ä»£src=ï¼Œå®šä¹‰å†…å®¹ç›´æ¥å†™å…¥åˆ°è¿œç¨‹æ–‡ä»¶ä¸­</div><div class="line">dest=:å®šä¹‰è¿œç¨‹è·¯å¾„ï¼Œç»å¯¹è·¯å¾„</div><div class="line">ansible local -m copy -a &apos;src=/etc/fstab dest=/tmp/fstab.bak owner=root  mode=777&apos;</div><div class="line">ansible local -m copy -a &apos;content=&quot;hello wrold\nabc\n&quot; dest=/tmp/fstab.bak owner=root</div></pre></td></tr></table></figure></p>
<p>file:æ–‡ä»¶ç®¡ç†å±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">path=: æŒ‡æ˜æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨nameã€destæ¥æ›¿æ¢</div><div class="line">ansible local -m file -a &apos; owner=bigdata group=bigdata  mode=644 path=/tmp/fstab.bak&apos;    #ä¿®æ”¹æƒé™å’Œç»„ä¿¡æ¯</div><div class="line">ansible local -m file -a &apos;path=/tmp/fstab.bak.link src=/tmp/fstab.bak state=link&apos;  #è½¯é“¾æ¥</div></pre></td></tr></table></figure></p>
<p>ping:æµ‹è¯•ä¸»æœºè”é€šæ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible local -m ping</div></pre></td></tr></table></figure></p>
<p>setup:æ”¶é›†è¿œç¨‹ä¸»æœºçš„facts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#æ¯ä¸ªè¢«ç®¡ç†èŠ‚ç‚¹ä¼šå°†è‡ªå·±ç›¸å…³çš„ä¿¡æ¯å‘ç”Ÿç»™è¿œç¨‹çš„ansibleä¸»æœºï¼Œç”¨äºæ¨¡æ¿è°ƒç”¨å˜é‡</div><div class="line">ansible local -m setup</div></pre></td></tr></table></figure></p>
<p>service:å¸¸ç”¨æœåŠ¡çš„è¿è¡ŒçŠ¶æ€<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">enabled=: å¼€æœºè‡ªå¯åŠ¨ï¼Œä¸ºtrueå’Œfalse</div><div class="line">name=: æœåŠ¡åç§°</div><div class="line">state=: å¯åŠ¨çŠ¶æ€ï¼Œstarted,stopped,restarted;</div><div class="line">ansible local -m service -a &quot;enabled=true name=nginx state=started&quot;</div></pre></td></tr></table></figure></p>
<p>shell:è¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä¼ é€’å‚æ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#ç”¨åˆ°ç®¡é“ç­‰åŠŸèƒ½çš„å¤æ‚å‘½ä»¤æ—¶ä½¿ç”¨shellå‘½ä»¤</div><div class="line">ansible local -m shell -a &quot;echo xxx | passwd --stdin user1&quot;</div></pre></td></tr></table></figure></p>
<p>script:å°†æœ¬åœ°è„šæœ¬åœ¨è¿œç¨‹ä¸Šæ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#æ³¨æ„ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„æŒ‡å®šè„šæœ¬</div><div class="line">ansible local -m script -a &quot;./test.sh&quot;</div></pre></td></tr></table></figure></p>
<p>yum/apt: å®‰è£…ç¨‹åºåŒ…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">name=:    éœ€è¦å®‰è£…çš„ç¨‹åºåŒ…ï¼Œå¯ä»¥åŠ ç‰ˆæœ¬å·</div><div class="line">state=:    presentï¼Œlastestå®‰è£…ï¼Œabsentè¡¨ç¤ºå¸è½½</div><div class="line">ansible local -m yum -a &quot;name=zsh&quot;    #å®‰è£…</div><div class="line">ansible local -m apt -a &quot;name=zsh state=absent&quot;    #å¸è½½</div></pre></td></tr></table></figure></p>
<h3 id="playbook"><a href="#playbook" class="headerlink" title="playbook"></a>playbook</h3><p>é€šè¿‡yamlå°†å¤šä¸ªæ¨¡å—ç»„è£…èµ·æ¥è¿è¡Œå¤šä¸ªä»»åŠ¡<br>ç»„æˆç»“æ„ï¼š<br>Playbooksï¼š<br>    Tasksï¼šä»»åŠ¡åˆ—è¡¨<br>    Variablesï¼šå˜é‡<br>    Templatesï¼šæ¨¡æ¿<br>    Handlersï¼šå¤„ç†å™¨ï¼Œç”±æŸäº‹ä»¶è§¦å‘æ‰§è¡Œçš„æ“ä½œ<br>    Rolesï¼šè§’è‰²</p>
<p>è¿è¡Œè¯´æ˜ï¼š<br>0)yamlè¯­æ³•æ£€æµ‹<br>ansible-playbook â€“syntax-check /path/to/playbook.yaml<br>1)yamlæµ‹è¯•è¿è¡Œ<br>ansible-playbook -C /path/to/playbook.yaml<br>2)è¿è¡Œ<br>ansiable-playbook /path/to/playbook.yml<br>-t TAGS  #ç»™æŒ‡å®šçš„ä»»åŠ¡å®šä¹‰ä¸€ä¸ªè°ƒç”¨æ ‡è¯†<br>â€“tags=TAGS #ç»™æŒ‡å®šçš„ä»»åŠ¡å®šä¹‰ä¸€ä¸ªè°ƒç”¨æ ‡è¯†<br>â€“skip-tags=SKIP_TAGS #è·³è¿‡æŒ‡å®šçš„æ ‡ç­¾<br>â€“start-at-task=START_AT #ä»å“ªä¸ªä»»åŠ¡åæ‰§è¡Œ<br>â€“list-tags    #æŸ¥çœ‹æ ‡ç­¾<br>åŸºæœ¬ç»“æ„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">ä¾‹å­1ï¼š</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: root</div><div class="line">  tasks:</div><div class="line">  - name: create nginx group</div><div class="line">      group: name=nginx system=yes gid=208</div><div class="line">  - name: create nginx user</div><div class="line">      user: name=nginx uid=208 system=yes</div><div class="line">- hosts: dbservers</div><div class="line">  remote_user: root</div><div class="line">  tasks:</div><div class="line">  - name: copy file to dbsrvs</div><div class="line">      copy: src=/etc/inittab dest=/tmp/inittab.bak</div><div class="line"> </div><div class="line">ä¾‹å­2(handler,vars)ï¼š</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: root</div><div class="line">  vars:</div><div class="line">  - package: httpd</div><div class="line">  - service: httpd</div><div class="line">  tasks:</div><div class="line">  - name: install httpd package</div><div class="line">    yum: name=&#123;&#123; package &#125;&#125; state=lastest</div><div class="line">  - name: install configuration file for httpd</div><div class="line">      copy: src=/root/conf/httpd.conf dest=/etc/httpd/conf/httpd.conf</div><div class="line">      notify:</div><div class="line">      - restart httpd</div><div class="line">  - name: start httpd service</div><div class="line">      service: enabled=true name=httpd state=started</div><div class="line">  handlers:</div><div class="line">  - name: restart httpd</div><div class="line">    service: name=httpd state=restarted</div><div class="line">  - name: copy file</div><div class="line">    copy: content=&quot;&#123;&#123; ansible_all_ipv4_addresses &#125;&#125;&quot; dest=/tmp/test.txt</div><div class="line"> </div><div class="line">ä¾‹å­3(æ¡ä»¶æµ‹è¯•)ï¼š</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: root</div><div class="line">  vars:</div><div class="line">  - username: user1</div><div class="line">  tasks:</div><div class="line">  - name: create &#123;&#123; username &#125;&#125;</div><div class="line">      user: name=&#123;&#123; userneam &#125;&#125;</div><div class="line">      when: ansible_fqdn == &apos;ttxsgoto&apos;</div><div class="line"> </div><div class="line">ä¾‹å­4(è¿­ä»£-for)ï¼š</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: root</div><div class="line">  - name: add username</div><div class="line">    user: name=&#123;&#123; item.name &#125;&#125; state=present groups=&#123;&#123; item.groups &#125;&#125;</div><div class="line">    with_items:</div><div class="line">      - &#123;name:&apos;testuser1&apos;,groups=&apos;user1&apos;&#125;</div><div class="line">      - &#123;name:&apos;testuser2&apos;,groups=&apos;user2&apos;&#125;</div><div class="line">- hosts: webservers</div><div class="line">  remote_user: root</div><div class="line">  - name: add username</div><div class="line">    user: name=&#123;&#123; item &#125;&#125; state=present groups=group1</div><div class="line">    with_items:</div><div class="line">      - testuser1</div><div class="line">      - testuser2</div><div class="line"> </div><div class="line">ä¾‹å­5(templates/tags  ansible-playbook test.yml --tags=&apos;conf_chage&apos;):</div><div class="line"> #tags: åœ¨playbookå¯ä»¥ä¸ºæŸä¸ªä»»åŠ¡å®šä¹‰ä¸€ä¸ªæ ‡ç­¾ï¼Œåœ¨æ‰§è¡Œplaybookæ—¶ï¼Œé€šè¿‡tagså¯å®ç°ä»…è¿è¡ŒæŒ‡å®štasksä»»åŠ¡</div><div class="line"> - hosts: webservers</div><div class="line">  remote_user: root</div><div class="line">  vars:</div><div class="line">  - package: httpd</div><div class="line">  - service: httpd</div><div class="line">  tasks:</div><div class="line">  - name: install httpd package</div><div class="line">    yum: name=&#123;&#123; package &#125;&#125; state=lastest</div><div class="line">  - name: install configuration file for httpd</div><div class="line">      template: src=/root/conf/httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf</div><div class="line">     tags:</div><div class="line">     - conf_chage</div><div class="line">     notify:</div><div class="line">      - restart httpd</div><div class="line">  - name: start httpd service</div><div class="line">      service: enabled=true name=httpd state=started</div><div class="line">  handlers:</div><div class="line">  - name: restart httpd</div><div class="line">    service: name=httpd state=restarted</div></pre></td></tr></table></figure></p>
<p>rolesï¼šç”¨äºå±‚æ¬¡åŒ–ã€ç»“æ„åŒ–çš„ç»„ç»‡playbookï¼›roleèƒ½å¤Ÿæ ¹æ®å±‚æ¬¡ç»“æ„è‡ªåŠ¨è£…è½½å˜é‡æ–‡ä»¶ã€taskä»¥åŠhandlersç­‰ï¼Œè¦ä½¿ç”¨rolesåªéœ€è¦åœ¨playbookä¸­ä½¿ç”¨includeæŒ‡ä»¤ï¼›rolesé€šè¿‡åˆ†åˆ«å°†å˜é‡ã€æ–‡ä»¶ã€ä»»åŠ¡ã€æ¨¡å—åŠå¤„ç†å™¨æ”¾ç½®åœ¨å•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶å¯ä»¥ä¾¿æ·åœ°é€šè¿‡includeå®ƒä»¬çš„ä¸€ç§æœºåˆ¶ï¼Œè§’è‰²ä¸€èˆ¬ç”¨äºåŸºäºä¸»æœºæ„å»ºæœåŠ¡çš„åœºæ™¯ä¸­ï¼›æ— å®ä¾‹ï¼Œç”¨åˆ°æ—¶åœ¨è®°å½•</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Ansibleæ¶æ„å›¾&quot;&gt;&lt;a href=&quot;#Ansibleæ¶æ„å›¾&quot; class=&quot;headerlink&quot; title=&quot;Ansibleæ¶æ„å›¾&quot;&gt;&lt;/a&gt;Ansibleæ¶æ„å›¾&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://ttxsgoto.github.io/i
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://ttxsgoto.github.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="ansible" scheme="https://ttxsgoto.github.io/tags/ansible/"/>
    
  </entry>
  
  <entry>
    <title>Celeryå¼‚æ­¥</title>
    <link href="https://ttxsgoto.github.io/2017/03/12/celery/"/>
    <id>https://ttxsgoto.github.io/2017/03/12/celery/</id>
    <published>2017-03-12T05:18:43.000Z</published>
    <updated>2017-03-14T14:24:45.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>Celeryæ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—/åŸºäºåˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’çš„ä½œä¸šé˜Ÿåˆ—ã€‚å®ƒä¾§é‡äºå®æ—¶æ“ä½œï¼ŒåŒæ—¶å¯¹è°ƒåº¦çš„æ”¯æŒä¹Ÿå¾ˆå¥½</p>
<h3 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h3><ul>
<li>å¯ä»¥åœ¨ Request-Response å¾ªç¯ä¹‹å¤–æ‰§è¡Œçš„æ“ä½œï¼šå‘é€é‚®ä»¶ã€æ¨é€æ¶ˆæ¯</li>
<li>è€—æ—¶çš„æ“ä½œï¼šè°ƒç”¨ç¬¬ä¸‰æ–¹ APIï¼ˆå‰ç«¯é€šè¿‡ AJAX å±•ç¤ºè¿›åº¦å’Œç»“æœï¼‰</li>
<li>å‘¨æœŸæ€§ä»»åŠ¡ï¼šå–ä»£ crontab</li>
</ul>
<h3 id="æ¶æ„è®¾è®¡"><a href="#æ¶æ„è®¾è®¡" class="headerlink" title="æ¶æ„è®¾è®¡"></a>æ¶æ„è®¾è®¡</h3><p><img src="https://ttxsgoto.github.io/img/celery/celery01.png" alt=""><br>Celeryçš„æ¶æ„ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<pre><code>æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆmessage brokerï¼‰ï¼šCeleryæœ¬èº«ä¸æä¾›æ¶ˆæ¯æœåŠ¡æ˜¯ä»»åŠ¡è°ƒåº¦é˜Ÿåˆ—ï¼Œé€šå¸¸ä»¥æœåŠ¡å½¢å¼å‡ºç°ï¼Œå¯ä»¥æ–¹ä¾¿çš„å’Œç¬¬ä¸‰æ–¹æä¾›çš„æ¶ˆæ¯ä¸­é—´ä»¶é›†æˆï¼›åŒ…æ‹¬ï¼ŒRabbitMQ, Redis, MongoDBï¼›
ä»»åŠ¡æ‰§è¡Œå•å…ƒï¼ˆworkerï¼‰ï¼šæ˜¯Celeryæä¾›çš„ä»»åŠ¡æ‰§è¡Œçš„å•å…ƒï¼Œworkerå¹¶å‘çš„è¿è¡Œåœ¨åˆ†å¸ƒå¼çš„ç³»ç»ŸèŠ‚ç‚¹ä¸­ï¼›
ä»»åŠ¡æ‰§è¡Œç»“æœå­˜å‚¨ï¼ˆtask result storeï¼‰ï¼šç”¨æ¥å­˜å‚¨Workeræ‰§è¡Œçš„ä»»åŠ¡çš„ç»“æœï¼ŒCeleryæ”¯æŒä»¥ä¸åŒæ–¹å¼å­˜å‚¨ä»»åŠ¡çš„ç»“æœï¼ŒåŒ…æ‹¬AMQP, Redisï¼Œmemcached, MongoDBï¼ŒSQLAlchemy, Django ORMï¼ŒApache Cassandra, IronCache
</code></pre><h3 id="é…ç½®å¯åŠ¨"><a href="#é…ç½®å¯åŠ¨" class="headerlink" title="é…ç½®å¯åŠ¨"></a>é…ç½®å¯åŠ¨</h3><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># å‚æ•°é…ç½®</div><div class="line">    BROKER_URL = &apos;redis://127.0.0.1:6379&apos;               # æŒ‡å®š Broker</div><div class="line">    CELERY_RESULT_BACKEND = &apos;redis://127.0.0.1:6379/0&apos;  # æŒ‡å®š Backend</div><div class="line">    CELERY_TIMEZONE = &apos;Asia/Shanghai&apos;                   # æŒ‡å®šæ—¶åŒºï¼Œé»˜è®¤æ˜¯ UTC</div><div class="line"></div><div class="line">    CELERY_IMPORTS = (                                  # æŒ‡å®šå¯¼å…¥çš„ä»»åŠ¡æ¨¡å—</div><div class="line">    &apos;celery_app.task1&apos;,</div><div class="line">    &apos;celery_app.task2&apos;</div><div class="line">)</div><div class="line">    app.config_from_object(&apos;celeryconfig&apos;)  #å°†é…ç½®å¯¼å…¥åˆ°celeryå¯¹è±¡ä¸­</div></pre></td></tr></table></figure>
<h4 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h4><p>celery worker -A tasks â€“loglevel=info â€“concurrency=5<br>å‚æ•°â€-Aâ€æŒ‡å®šäº†Celeryå®ä¾‹çš„ä½ç½®ï¼Œæœ¬ä¾‹æ˜¯åœ¨â€tasks.pyâ€ä¸­ï¼Œceleryå‘½ä»¤ä¼šè‡ªåŠ¨åœ¨è¯¥æ–‡ä»¶ä¸­å¯»æ‰¾Celeryå¯¹è±¡å®ä¾‹ã€‚å»ºè®®æŒ‡å®šCeleryå¯¹è±¡åç§°ï¼Œå¦‚â€-A tasks.appâ€ã€‚<br>å‚æ•°â€loglevelâ€æŒ‡å®šäº†æ—¥å¿—ç­‰çº§ï¼Œä¹Ÿå¯ä»¥ä¸åŠ ï¼Œé»˜è®¤ä¸ºwarningã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ -l infoæ¥è¡¨ç¤º<br>å‚æ•°â€concurrencyâ€æŒ‡å®šæœ€å¤§å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸ºCPUæ ¸æ•°<br>delay():æ–¹æ³•å°†ä»»åŠ¡å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”±ä¹‹å‰å¯åŠ¨workeræ‰§è¡Œï¼Œè¿™æ—¶Pythonæ§åˆ¶å°ä¸Šåªä¼šè¿”å›â€AsyncResultâ€ä¿¡æ¯ã€‚å¦‚æœä½ çœ‹ä¸‹ä¹‹å‰èŒç¨‹çš„å¯åŠ¨çª—å£ï¼Œä½ ä¼šçœ‹åˆ°å¤šäº†æ¡æ—¥å¿—â€Received task: celery_app.task1.add[bec9a333-3af7-43ab-b93d-4a2ae6779058]  ETA:[2017-03-12 12:57:08.630629+08:00]â€<br>â€œdelay()â€æ–¹æ³•ï¼Œå®ƒå…¶å®æ˜¯å¯¹â€apply_async()â€æ–¹æ³•çš„å°è£…ï¼Œä½¿å¾—ä½ åªè¦ä¼ å…¥ä»»åŠ¡æ‰€éœ€çš„å‚æ•°å³å¯ã€‚å¯¹äºç‰¹æ®Šçš„ä»»åŠ¡è°ƒåº¦éœ€æ±‚ï¼Œä½ éœ€è¦ä½¿ç”¨â€apply_async()â€ï¼Œå…¶å¸¸ç”¨çš„å‚æ•°æœ‰ï¼š</p>
<pre><code>countdown: æŒ‡å®šå¤šå°‘ç§’åä»»åŠ¡æ‰è¢«æ‰§è¡Œ
eta: æŒ‡å®šä»»åŠ¡è¢«è°ƒåº¦çš„æ—¶é—´ï¼Œå‚æ•°ç±»å‹æ˜¯datetime
expires: ä»»åŠ¡è¿‡æœŸæ—¶é—´ï¼Œå‚æ•°ç±»å‹å¯ä»¥æ˜¯intï¼ˆç§’ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯datetime
retry: ä»»åŠ¡å‘é€å¤±è´¥çš„é‡è¯•æ¬¡æ•°
priority: ä»»åŠ¡ä¼˜å…ˆçº§ï¼ŒèŒƒå›´æ˜¯0-9
serializer: å‚æ•°å’Œè¿”å›å€¼çš„åºåˆ—åŒ–æ–¹å¼
</code></pre><p>result = add.delay(2,5)<br>result.ready()  #True,ç”¨äºæ£€æŸ¥ä»»åŠ¡æ‰§è¡Œæ˜¯å¦æˆåŠŸ<br>result.get(timeout=1)   #7,getæ–¹æ³•ç”¨äºè·å–ä»»åŠ¡ç»“æœ</p>
<p>delay() æ–¹æ³•æ˜¯ apply_async() æ–¹æ³•çš„ç®€å†™<br>apply_async(args=(), kwargs={}, route_name=None, **options)<br>è¿™ä¸ªè°ƒç”¨ä¼šæŠŠ add æ“ä½œæ”¾å…¥åˆ°é˜Ÿåˆ—é‡Œï¼Œç„¶åç«‹å³è¿”å›ä¸€ä¸ª AsyncResult å¯¹è±¡<br>å½“å‡½æ•°è¢«@app.taskè£…é¥°åï¼Œå°±æˆä¸ºå¯è¢« Celery è°ƒåº¦çš„ä»»åŠ¡</p>
<h3 id="åº”ç”¨å®ä¾‹"><a href="#åº”ç”¨å®ä¾‹" class="headerlink" title="åº”ç”¨å®ä¾‹"></a>åº”ç”¨å®ä¾‹</h3><h4 id="å¼‚æ­¥æ‰§è¡Œä»»åŠ¡"><a href="#å¼‚æ­¥æ‰§è¡Œä»»åŠ¡" class="headerlink" title="å¼‚æ­¥æ‰§è¡Œä»»åŠ¡"></a>å¼‚æ­¥æ‰§è¡Œä»»åŠ¡</h4><p>ç›®å½•ç»“æ„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- celery_app</div><div class="line">    - __init__.py</div><div class="line">    - celeryconfig.py</div><div class="line">    - init.py</div><div class="line">    - task1.py</div><div class="line">    - task2.py</div><div class="line">    - client.py</div></pre></td></tr></table></figure></p>
<p>celeryconfig.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"> </div><div class="line">BROKER_URL = <span class="string">'redis://127.0.0.1:6379'</span>               <span class="comment"># æŒ‡å®š Broker</span></div><div class="line">CELERY_RESULT_BACKEND = <span class="string">'redis://127.0.0.1:6379/0'</span>  <span class="comment"># æŒ‡å®š Backend</span></div><div class="line">CELERY_TIMEZONE = <span class="string">'Asia/Shanghai'</span>                   <span class="comment"># æŒ‡å®šæ—¶åŒºï¼Œé»˜è®¤æ˜¯ UTC</span></div><div class="line"> </div><div class="line">CELERY_IMPORTS = (                                  <span class="comment"># æŒ‡å®šå¯¼å…¥çš„ä»»åŠ¡æ¨¡å—</span></div><div class="line">    <span class="string">'celery_app.task1'</span>,</div><div class="line">    <span class="string">'celery_app.task2'</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>init.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"><span class="string">'''</span></div><div class="line">Describe:å¼‚æ­¥æ‰§è¡Œ</div><div class="line">å¯åŠ¨workerè¿›ç¨‹;æ¯æ¬¡ä¿®æ”¹taskä»£ç å,éœ€è¦restart  celery è¿›ç¨‹;</div><div class="line">cd /train/celery_demo &amp;&amp; celery worker -A celery_app.init --loglevel=INFO</div><div class="line"></div><div class="line">'''python</div><div class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</div><div class="line"> </div><div class="line">ttxsgoto = Celery(<span class="string">"ttxsgoto"</span>)   <span class="comment">#åˆ›å»ºä¸€ä¸ªceleryä»»åŠ¡</span></div><div class="line"> </div><div class="line">ttxsgoto.config_from_object(<span class="string">'celery_app.celeryconfig'</span>)  <span class="comment">#å°†é…ç½®å¯¼å…¥åˆ°celeryå¯¹è±¡ä¸­</span></div></pre></td></tr></table></figure></p>
<p>task1.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> .init <span class="keyword">import</span> ttxsgoto</div><div class="line"> </div><div class="line"><span class="meta">@ttxsgoto.task</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></div><div class="line">    time.sleep(<span class="number">5</span>)</div><div class="line">    <span class="keyword">return</span> x + y</div></pre></td></tr></table></figure></p>
<p>task2.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> .init <span class="keyword">import</span> ttxsgoto</div><div class="line"> </div><div class="line"><span class="meta">@ttxsgoto.task</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(x, y)</span>:</span></div><div class="line">    time.sleep(<span class="number">10</span>)</div><div class="line">    <span class="keyword">return</span> x * y</div></pre></td></tr></table></figure></p>
<p>client.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> task1</div><div class="line"><span class="keyword">import</span> task2</div><div class="line"> </div><div class="line"><span class="keyword">print</span> <span class="string">"å¼‚æ­¥æ‰§è¡Œå¼€å§‹:"</span>,time.ctime()</div><div class="line">task1.add.apply_async(args=(<span class="number">2</span>,<span class="number">8</span>), countdown=<span class="number">5</span>) <span class="comment"># 5 ç§’åæ‰§è¡Œä»»åŠ¡</span></div><div class="line">task2.multiply.delay(<span class="number">3</span>,<span class="number">7</span>)</div><div class="line"> </div><div class="line"><span class="keyword">print</span> <span class="string">"end!!!!!"</span></div><div class="line"><span class="keyword">print</span> time.ctime()</div></pre></td></tr></table></figure></p>
<p>å¯åŠ¨celeryå¹¶æœåŠ¡ï¼Œå¹¶æ‰§è¡Œclient.pyè„šæœ¬<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">celery worker -A celery_app.init  -l info</div><div class="line">python client.py</div></pre></td></tr></table></figure></p>
<h4 id="å‘¨æœŸæ‰§è¡Œä»»åŠ¡"><a href="#å‘¨æœŸæ‰§è¡Œä»»åŠ¡" class="headerlink" title="å‘¨æœŸæ‰§è¡Œä»»åŠ¡"></a>å‘¨æœŸæ‰§è¡Œä»»åŠ¡</h4><p>ç›®å½•ç»“æ„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- celery_app_cron</div><div class="line">    - __init__.py</div><div class="line">    - celeryconfig.py</div><div class="line">    - init.py</div><div class="line">    - task1.py</div><div class="line">    - task2.py</div></pre></td></tr></table></figure></p>
<p>celeryconfig.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"> </div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</div><div class="line"><span class="keyword">from</span> celery.schedules <span class="keyword">import</span> crontab</div><div class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</div><div class="line"> </div><div class="line">BROKER_URL = <span class="string">'redis://127.0.0.1:6379'</span>               <span class="comment"># æŒ‡å®š Broker</span></div><div class="line">CELERY_RESULT_BACKEND = <span class="string">'redis://127.0.0.1:6379/0'</span>  <span class="comment"># æŒ‡å®š Backend</span></div><div class="line">CELERY_TIMEZONE = <span class="string">'Asia/Shanghai'</span>                   <span class="comment"># æŒ‡å®šæ—¶åŒºï¼Œé»˜è®¤æ˜¯ UTC</span></div><div class="line"> </div><div class="line">CELERY_IMPORTS = (                                  <span class="comment"># æŒ‡å®šå¯¼å…¥çš„ä»»åŠ¡æ¨¡å—</span></div><div class="line">    <span class="string">'celery_app_cron.task1'</span>,</div><div class="line">    <span class="string">'celery_app_cron.task2'</span></div><div class="line">)</div><div class="line"> </div><div class="line"><span class="comment">#ttxsgoto = Celery("cron",broker= BROKER_URL, backend= CELERY_RESULT_BACKEND)</span></div><div class="line"> </div><div class="line"><span class="comment">#å®šæ—¶ä»»åŠ¡è®¾ç½®</span></div><div class="line">CELERYBEAT_SCHEDULE = &#123;</div><div class="line">    <span class="string">'add-every-30s'</span>:&#123;</div><div class="line">        <span class="string">'task'</span>:<span class="string">'celery_app_cron.task1.add'</span>,         <span class="comment">#ä»»åŠ¡æ‰§è¡Œçš„å‡½æ•°</span></div><div class="line">        <span class="string">'schedule'</span>:timedelta(seconds=<span class="number">30</span>),           <span class="comment"># æ¯30sæ‰§è¡Œä¸€æ¬¡</span></div><div class="line">        <span class="string">'args'</span>:(<span class="number">3</span>,<span class="number">12</span>)                                <span class="comment"># ä»»åŠ¡å‡½æ•°å‚æ•°</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="string">'multiply-erverday-7-10'</span>:&#123;</div><div class="line">        <span class="string">'task'</span>:<span class="string">'celery_app_cron.task2.multiply'</span>,</div><div class="line">        <span class="comment">#'schedule':crontab(hour=7,minute=10),      #cronè®¡åˆ’ä»»åŠ¡,æ¯å¤©7:10è¿›è¡Œ</span></div><div class="line">        <span class="string">'args'</span>:(<span class="number">3</span>,<span class="number">15</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>init.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"><span class="string">'''</span></div><div class="line">Describe:å®šæ—¶ä»»åŠ¡</div><div class="line">å¯åŠ¨workerè¿›ç¨‹;æ¯æ¬¡ä¿®æ”¹taskä»£ç å,éœ€è¦restart  celery è¿›ç¨‹;</div><div class="line">cd /train/celery_demo &amp;&amp; celery -A celery_app_cron.init worker --loglevel=INFO</div><div class="line">cd /train/celery_demo &amp;&amp; celery -A celery_app_cron.init beat</div><div class="line">æ”¾åœ¨ä¸€èµ·æ‰§è¡Œ:</div><div class="line">cd /train/celery_demo &amp;&amp; celery -B -A celery_app_cron.init worker --loglevel=INFO</div><div class="line">'''</div><div class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</div><div class="line"> </div><div class="line">ttxsgoto = Celery(<span class="string">"cron"</span>)</div><div class="line">ttxsgoto.config_from_object(<span class="string">'celery_app_cron.celeryconfig'</span>)</div></pre></td></tr></table></figure></p>
<p>task1.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> .init <span class="keyword">import</span> ttxsgoto</div><div class="line"> </div><div class="line"><span class="meta">@ttxsgoto.task</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></div><div class="line">    time.sleep(<span class="number">5</span>)</div><div class="line">    <span class="keyword">return</span> x + y</div></pre></td></tr></table></figure></p>
<p>task2.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf_8</span></div><div class="line"> </div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">from</span> init <span class="keyword">import</span> ttxsgoto</div><div class="line"> </div><div class="line"><span class="meta">@ttxsgoto.task</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(x, y)</span>:</span></div><div class="line">    time.sleep(<span class="number">10</span>)</div><div class="line">    <span class="keyword">return</span> x * y</div></pre></td></tr></table></figure></p>
<p>å¯åŠ¨celeryæœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œç»“æœï¼Œ30sè¿è¡Œä¸€æ¬¡task1.add<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">celery worker -B -A celery_app_cron.init -l info</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;è¯´æ˜&quot;&gt;&lt;a href=&quot;#è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;è¯´æ˜&quot;&gt;&lt;/a&gt;è¯´æ˜&lt;/h3&gt;&lt;p&gt;Celeryæ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—/åŸºäºåˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’çš„ä½œä¸šé˜Ÿåˆ—ã€‚å®ƒä¾§é‡äºå®æ—¶æ“ä½œï¼ŒåŒæ—¶å¯¹è°ƒåº¦çš„æ”¯æŒä¹Ÿå¾ˆå¥½&lt;/p&gt;
&lt;h3 id=&quot;é€‚ç”¨åœºæ™¯&quot;&gt;
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="celery" scheme="https://ttxsgoto.github.io/tags/celery/"/>
    
  </entry>
  
  <entry>
    <title>djangoåˆ†é¡µ</title>
    <link href="https://ttxsgoto.github.io/2017/03/08/django-page/"/>
    <id>https://ttxsgoto.github.io/2017/03/08/django-page/</id>
    <published>2017-03-08T13:57:42.000Z</published>
    <updated>2017-03-09T01:31:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨Django é¡¹ç›®ä¸­ä½¿ç”¨è‡ªå¸¦çš„åˆ†é¡µæ¨¡å—ï¼Œè®°å½•å¦‚ä¸‹</p>
<p><strong>ç›¸å…³è¯´æ˜</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator</div><div class="line"> </div><div class="line">objects = [<span class="string">'abc'</span>,<span class="string">'bcd'</span>,<span class="string">'cde'</span>,<span class="string">'def'</span>,<span class="string">'efg'</span>,<span class="string">'fgh'</span>]</div><div class="line">p = Paginator(objects, <span class="number">2</span>)<span class="comment">#è¡¨ç¤ºä¼ å…¥æ•°æ®é›†åˆï¼Œ2 è¡¨ç¤ºæ¯é¡µå­˜æ”¾çš„æ•°æ®ä¸ªæ•°</span></div><div class="line">p.cout <span class="comment">#6 è¡¨ç¤ºæ•°æ®æ€»é‡</span></div><div class="line">p.num_pages<span class="comment">#3 è¡¨ç¤ºæ€»é¡µæ•°</span></div><div class="line">p.per_page<span class="comment">#2 è¡¨ç¤ºæ¯é¡µçš„æ•°é‡</span></div><div class="line">p.object_list<span class="comment"># ['abc','bcd','cde','def','efg','fgh']  æ‰€æœ‰æ•°æ®åˆ—è¡¨</span></div><div class="line">p.page_range  <span class="comment">#[1, 2, 3]   è¡¨ç¤ºé¡µæ•°</span></div><div class="line">p1 = p.page(<span class="number">1</span>)<span class="comment">#è·å–ç¬¬ä¸€é¡µçš„å¯¹è±¡</span></div><div class="line">p1.object_list<span class="comment">#['abc', 'bcd'] è¯¥é¡µä¸Šçš„æ•°æ®</span></div><div class="line">p1.has_next()<span class="comment">#True,åˆ¤æ–­è¯¥é¡µæ˜¯å¦æœ‰ä¸‹ä¸€é¡µ</span></div><div class="line">p1.has_previous()<span class="comment">#False,åˆ¤æ–­è¯¥é¡µæ˜¯å¦æœ‰ä¸Šä¸€é¡µ</span></div><div class="line">p1.has_other_pages() <span class="comment">#åˆ¤æ–­è¯¥é¡µæ˜¯å¦æœ‰ä¸Šæˆ–è€…ä¸‹é¡µ</span></div><div class="line">p1.start_index()<span class="comment"># 1 p1å¼€å§‹çš„ç´¢å¼•å€¼</span></div><div class="line">p1.end_index()<span class="comment">#2 p1ç»“æŸçš„ç´¢å¼•å€¼</span></div><div class="line">p1.next_page_number(ï¼‰<span class="comment"># #è¿”å›ä¸‹ä¸€é¡µçš„é¡µç ï¼Œå¦‚æœä¸‹ä¸€é¡µä¸å­˜åœ¨ï¼ŒæŠ›å‡ºInvalidPageå¼‚å¸¸</span></div><div class="line">p1.previous_page_number()<span class="comment">#è¿”å›å‰ä¸€é¡µçš„é¡µç ï¼Œå¦‚æœä¸Šä¸€é¡µä¸å­˜åœ¨ï¼ŒæŠ›å‡ºInvalidPagå¼‚å¸¸</span></div><div class="line">p1.paginator<span class="comment">#&lt;django.core.paginator.Paginator object at 0x7f39989b2bd0&gt; ç›¸å…³paginatorçš„å¯¹è±¡</span></div></pre></td></tr></table></figure></p>
<p><strong>Djangoä¸­ä½¿ç”¨åˆ†é¡µ</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render_to_response</div><div class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator, EmptyPage, InvalidPage, PageNotAnInteger</div><div class="line"><span class="keyword">from</span> models <span class="keyword">import</span> *</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">device_status</span><span class="params">(request)</span>:</span></div><div class="line">    All_page_info = Device_status.objects.all()</div><div class="line">    DataCount,page,All_page_info = All_in_one(request,All_page_info)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> my_render(<span class="string">"serverinfo/device_status.html"</span>,locals(),request)</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_render</span><span class="params">(template,data,request)</span>:</span></div><div class="line">    <span class="keyword">return</span> render_to_response(template, data, context_instance=RequestContext(request))</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getpage_id</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    ä¼ é€’å‰ç«¯pageè¿‡æ¥çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ä¸º1</div><div class="line">    """</div><div class="line">    page = request.GET.get(<span class="string">"page"</span>,<span class="string">""</span>)</div><div class="line">    <span class="keyword">if</span> page:</div><div class="line">        page = request.GET.get(<span class="string">"page"</span>,<span class="string">""</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        page = <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> page</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getpages</span><span class="params">(Data,page)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    å¤„ç†åˆ†é¡µå‡½æ•°</div><div class="line">    """</div><div class="line">    paginator = Paginator(list(Data),<span class="number">2</span>)</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        Data = paginator.page(page)</div><div class="line">    <span class="keyword">except</span> PageNotAnInteger:</div><div class="line">        Data = paginator.page(<span class="number">1</span>)</div><div class="line">    <span class="keyword">except</span> EmptyPage:</div><div class="line">        Data = paginator.page(paginator.num_pages)</div><div class="line">    <span class="keyword">return</span> Data,page</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">All_in_one</span><span class="params">(request,All_page_info)</span>:</span></div><div class="line">    DataCount = len(All_page_info)</div><div class="line">    page = getpage_id(request)</div><div class="line">    All_page_info,page=getpages(All_page_info,page)</div><div class="line">    <span class="keyword">return</span> DataCount,page,All_page_info</div></pre></td></tr></table></figure></p>
<p><strong>templatesä¸­</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">å¤‡æ³¨ï¼špaginator.html  //å°†ä»¥ä¸‹æ¨¡æ¿å¯¼å…¥éœ€è¦æ·»åŠ åˆ†é¡µåŠŸèƒ½çš„é¡µé¢å³å¯ï¼ˆ&#123;% include &apos;paginator.html&apos; %&#125;ï¼‰</div><div class="line">=========================</div><div class="line">&lt;span class=&quot;step-links&quot;&gt;</div><div class="line">   &#123;% if All_page_info.has_previous %&#125; &lt;!-- æ˜¯å¦æœ‰å‰ä¸€é¡µ --&gt;</div><div class="line">       &lt;a  href=&quot;?page=&#123;&#123; All_page_info.previous_page_number &#125;&#125;&quot;&gt;ä¸Šä¸€é¡µ&lt;/a&gt; &lt;!-- å‰ä¸€é¡µçš„é¡µç  --&gt;</div><div class="line">         &lt;/script&gt;</div><div class="line">   &#123;% endif %&#125;</div><div class="line">   &lt;span class=&quot;current&quot;&gt;</div><div class="line">       ç¬¬ &#123;&#123; All_page_info.number &#125;&#125;é¡µ  æ€» &#123;&#123; All_page_info.paginator.num_pages &#125;&#125; é¡µ  &lt;!-- æ€»é¡µæ•° --&gt;</div><div class="line">   &lt;/span&gt;</div><div class="line">   &#123;% if All_page_info.has_next %&#125;</div><div class="line">       &lt;a  href=&quot;?page=&#123;&#123; All_page_info.next_page_number &#125;&#125;&quot;&gt;ä¸‹ä¸€é¡µ&lt;/a&gt; &lt;!-- åä¸€é¡µçš„é¡µç  --&gt;</div><div class="line">   &#123;% endif %&#125;</div><div class="line">&lt;/span&gt;</div><div class="line">&lt;span&gt;</div><div class="line">     &amp;nbsp;&amp;nbsp;å…±&#123;&#123;DataCount&#125;&#125;æ¡è®°å½•</div><div class="line">&lt;/span&gt;</div></pre></td></tr></table></figure>
<p><strong>æ•ˆæœå±•ç¤º</strong><br><img src="https://ttxsgoto.github.io/img/django/page.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨Django é¡¹ç›®ä¸­ä½¿ç”¨è‡ªå¸¦çš„åˆ†é¡µæ¨¡å—ï¼Œè®°å½•å¦‚ä¸‹&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç›¸å…³è¯´æ˜&lt;/strong&gt;&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=
    
    </summary>
    
      <category term="Django" scheme="https://ttxsgoto.github.io/categories/Django/"/>
    
    
      <category term="åˆ†é¡µ" scheme="https://ttxsgoto.github.io/tags/%E5%88%86%E9%A1%B5/"/>
    
  </entry>
  
  <entry>
    <title>ConfigParseræ¨¡å—</title>
    <link href="https://ttxsgoto.github.io/2017/03/07/ConfigParser/"/>
    <id>https://ttxsgoto.github.io/2017/03/07/ConfigParser/</id>
    <published>2017-03-07T13:57:05.000Z</published>
    <updated>2017-03-09T01:31:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>ConfigParseræ¨¡å—è®°å½•å¸¸ç”¨æ–¹æ³•<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf-8</span></div><div class="line"><span class="keyword">import</span> ConfigParser</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    åŸºæœ¬çš„è¯»å–é…ç½®æ–‡ä»¶</div><div class="line">    -read(filename) ç›´æ¥è¯»å–iniæ–‡ä»¶å†…å®¹</div><div class="line">    -sections() å¾—åˆ°æ‰€æœ‰çš„sectionï¼Œå¹¶ä»¥åˆ—è¡¨çš„å½¢å¼è¿”å›</div><div class="line">    -options(section) å¾—åˆ°è¯¥sectionçš„æ‰€æœ‰option</div><div class="line">    -items(section) å¾—åˆ°è¯¥sectionçš„æ‰€æœ‰é”®å€¼å¯¹</div><div class="line">    -get(section,option) å¾—åˆ°sectionä¸­optionçš„å€¼ï¼Œè¿”å›ä¸ºstringç±»å‹</div><div class="line">    -getint(section,option) å¾—åˆ°sectionä¸­optionçš„å€¼ï¼Œè¿”å›ä¸ºintç±»å‹ï¼Œè¿˜æœ‰ç›¸åº”çš„getboolean()å’Œgetfloat() å‡½æ•°</div><div class="line">    åŸºæœ¬çš„å†™å…¥é…ç½®æ–‡ä»¶</div><div class="line">    -add_section(section) æ·»åŠ ä¸€ä¸ªæ–°çš„section</div><div class="line">    -set( section, option, value) å¯¹sectionä¸­çš„optionè¿›è¡Œè®¾ç½®ï¼Œéœ€è¦è°ƒç”¨writeå°†å†…å®¹å†™å…¥é…ç½®æ–‡ä»¶</div><div class="line">    """</div><div class="line">    cf = ConfigParser.ConfigParser()</div><div class="line">    cf.read(<span class="string">'db.txt'</span>)</div><div class="line">    sec = cf.sections()                         <span class="comment">#è·å–æ‰€æœ‰sectionsçš„å€¼</span></div><div class="line">    <span class="keyword">print</span> sec</div><div class="line">    opt = cf.options(<span class="string">'db1'</span>)                     <span class="comment">#è·å–æŒ‡å®šsectionsçš„options</span></div><div class="line">    <span class="keyword">print</span> opt</div><div class="line">    val = cf.items(<span class="string">'db1'</span>)                       <span class="comment">#è·å–æŒ‡å®šsectionçš„é…ç½®ä¿¡æ¯ï¼Œä¸ºlist</span></div><div class="line">    <span class="keyword">print</span> val,type(val)</div><div class="line">    val_str = cf.get(<span class="string">'db1'</span>, <span class="string">'db_host'</span>)          <span class="comment">#è·å–sectionsä¸­optionçš„å€¼</span></div><div class="line">    <span class="keyword">print</span> val_str</div><div class="line">    cf.set(<span class="string">'db1'</span>,<span class="string">'db_host'</span>,<span class="string">'192.168.1.55'</span>)      <span class="comment">#è®¾ç½®æŸä¸ªoptionçš„å€¼</span></div><div class="line">    cf.write(open(<span class="string">'db.txt'</span>,<span class="string">'w'</span>))</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        cf.add_section(<span class="string">'ttxsgoto'</span>)              <span class="comment">#æ·»åŠ ä¸€ä¸ªsection</span></div><div class="line">        cf.set(<span class="string">'ttxsgoto'</span>, <span class="string">'hostname'</span>, <span class="string">'ttxsgoto'</span>)</div><div class="line">        cf.write(open(<span class="string">'db.txt'</span>,<span class="string">'w'</span>))</div><div class="line">    <span class="keyword">except</span> Exception:</div><div class="line">        <span class="keyword">pass</span></div><div class="line">    cf.remove_option(<span class="string">'ttxsgoto'</span>, <span class="string">'hostname'</span>)    <span class="comment">#åˆ é™¤option</span></div><div class="line">    cf.remove_section(<span class="string">'ttxsgoto'</span>)               <span class="comment">#åˆ é™¤section</span></div><div class="line">    cf.write(open(<span class="string">'db.txt'</span>,<span class="string">'w'</span>))</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">()</span>:</span></div><div class="line">    config = ConfigParser.RawConfigParser()</div><div class="line">    config.add_section(<span class="string">'Section1'</span>)</div><div class="line">    config.set(<span class="string">'Section1'</span>,<span class="string">'an_int'</span>,<span class="string">'15'</span>)</div><div class="line">    config.set(<span class="string">'Section1'</span>,<span class="string">'a_bool'</span>,<span class="string">'true'</span>)</div><div class="line">    config.set(<span class="string">'Section1'</span>,<span class="string">'a_float'</span>,<span class="string">'3.1415'</span>)</div><div class="line">    config.set(<span class="string">'Section1'</span>, <span class="string">'baz'</span>, <span class="string">'fun'</span>)</div><div class="line">    config.set(<span class="string">'Section1'</span>, <span class="string">'bar'</span>, <span class="string">'Python'</span>)</div><div class="line">    config.set(<span class="string">'Section1'</span>,<span class="string">'foo'</span>,<span class="string">'%(bar)s is %(baz)s !'</span>)</div><div class="line">    <span class="keyword">with</span> open(<span class="string">'example.cfg'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> configfile:</div><div class="line">        config.write(configfile)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">()</span>:</span></div><div class="line">    config = ConfigParser.RawConfigParser()</div><div class="line">    config.read(<span class="string">'example.cfg'</span>)</div><div class="line">    a_float = config.getfloat(<span class="string">'Section1'</span>, <span class="string">'a_float'</span>)</div><div class="line">    an_int = config.getint(<span class="string">'Section1'</span>, <span class="string">'an_int'</span>)</div><div class="line">    <span class="keyword">print</span> a_float + an_int</div><div class="line">    <span class="keyword">if</span> config.getboolean(<span class="string">'Section1'</span>, <span class="string">'a_bool'</span>):</div><div class="line">        <span class="keyword">print</span> config.get(<span class="string">'Section1'</span>,<span class="string">'foo'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">read1</span><span class="params">()</span>:</span></div><div class="line">    config = ConfigParser.ConfigParser()</div><div class="line">    config.read(<span class="string">'example.cfg'</span>)</div><div class="line">    <span class="keyword">print</span> config.get(<span class="string">'Section1'</span>, <span class="string">'foo'</span>, <span class="number">0</span>)  <span class="comment">#0 é»˜è®¤ï¼Œæ˜¾ç¤ºå®šä¹‰çš„å­—ç¬¦ä¸²</span></div><div class="line">    <span class="keyword">print</span> config.get(<span class="string">'Section1'</span>,<span class="string">'foo'</span>,<span class="number">1</span>)    <span class="comment">#è®¾ç½®ä¸º1ï¼Œæ˜¾ç¤ºåŸå­—ç¬¦ä¸²</span></div><div class="line">    <span class="keyword">print</span> config.get(<span class="string">'Section1'</span>,<span class="string">'foo'</span>,<span class="number">0</span>,&#123;<span class="string">'bar'</span>:<span class="string">'Document'</span>,<span class="string">'baz'</span>:<span class="string">'evil'</span>&#125;) <span class="comment">#è®¾ç½®sectionçš„å¯¹åº”çš„options</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">read2</span><span class="params">()</span>:</span></div><div class="line">    config = ConfigParser.SafeConfigParser(&#123;<span class="string">'bar'</span>:<span class="string">'Life'</span>,<span class="string">'baz'</span>:<span class="string">'hard'</span>&#125;)</div><div class="line">    config.read(<span class="string">'example.cfg'</span>)</div><div class="line">    <span class="keyword">print</span> config.get(<span class="string">'Section1'</span>,<span class="string">'foo'</span>)  <span class="comment">#"Python is fun!"</span></div><div class="line">    config.remove_option(<span class="string">'Section1'</span>, <span class="string">'bar'</span>)</div><div class="line">    config.remove_option(<span class="string">'Section1'</span>,<span class="string">'baz'</span>)</div><div class="line">    <span class="keyword">print</span> config.get(<span class="string">'Section1'</span>,<span class="string">'foo'</span>)  <span class="comment">#"Life is hard!"</span></div><div class="line">    </div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ConfigParseræ¨¡å—è®°å½•å¸¸ç”¨æ–¹æ³•&lt;br&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="ConfigParser" scheme="https://ttxsgoto.github.io/tags/ConfigParser/"/>
    
  </entry>
  
  <entry>
    <title>loggingæ¨¡å—</title>
    <link href="https://ttxsgoto.github.io/2017/03/06/logging/"/>
    <id>https://ttxsgoto.github.io/2017/03/06/logging/</id>
    <published>2017-03-06T13:42:55.000Z</published>
    <updated>2017-03-07T13:57:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>loggingä¸ºpythonæ¨¡å—æä¾›çŠ¶æ€ã€é”™è¯¯ã€ä¿¡æ¯è¾“å‡ºçš„æ ‡å‡†æ¥å£ã€‚<br>æ—¥å¿—çº§åˆ«å¤§å°å…³ç³»ä¸ºï¼šCRITICAL &gt; ERROR &gt; WARNING &gt; INFO &gt; DEBUG &gt; NOTSET</p>
<p>logging.basicConfigå‡½æ•°å„å‚æ•°è¯´æ˜ï¼š<br>filename: æŒ‡å®šæ—¥å¿—æ–‡ä»¶å<br>filemode: å’Œfileå‡½æ•°æ„ä¹‰ç›¸åŒï¼ŒæŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„æ‰“å¼€æ¨¡å¼ï¼Œâ€™wâ€™æˆ–â€™aâ€™<br>format: æŒ‡å®šè¾“å‡ºçš„æ ¼å¼å’Œå†…å®¹ï¼š</p>
<pre><code>%(levelno)s: æ‰“å°æ—¥å¿—çº§åˆ«çš„æ•°å€¼
%(levelname)s: æ‰“å°æ—¥å¿—çº§åˆ«åç§°
%(pathname)s: æ‰“å°å½“å‰æ‰§è¡Œç¨‹åºçš„è·¯å¾„ï¼Œå…¶å®å°±æ˜¯sys.argv[0]
%(filename)s: æ‰“å°å½“å‰æ‰§è¡Œç¨‹åºå
%(funcName)s: æ‰“å°æ—¥å¿—çš„å½“å‰å‡½æ•°
%(lineno)d: æ‰“å°æ—¥å¿—çš„å½“å‰è¡Œå·
%(asctime)s: æ‰“å°æ—¥å¿—çš„æ—¶é—´
%(thread)d: æ‰“å°çº¿ç¨‹ID
%(threadName)s: æ‰“å°çº¿ç¨‹åç§°
%(process)d: æ‰“å°è¿›ç¨‹ID
%(message)s: æ‰“å°æ—¥å¿—ä¿¡æ¯
</code></pre><p>datefmt: æŒ‡å®šæ—¶é—´æ ¼å¼ï¼ŒåŒtime.strftime()<br>level: è®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œé»˜è®¤ä¸ºlogging.WARNING</p>
<p>stream: æŒ‡å®šå°†æ—¥å¿—çš„è¾“å‡ºæµï¼Œå¯ä»¥æŒ‡å®šè¾“å‡ºåˆ°sys.stderr,sys.stdoutæˆ–è€…æ–‡ä»¶ï¼Œé»˜è®¤è¾“å‡ºåˆ°sys.stderrï¼Œå½“streamå’ŒfilenameåŒæ—¶æŒ‡å®šæ—¶ï¼Œstreamè¢«å¿½ç•¥</p>
<p>è®°å½•æ—¥å¿—ä¿¡æ¯<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf-8</span></div><div class="line"><span class="keyword">import</span> logging</div><div class="line"></div><div class="line">logname = <span class="string">'log.log'</span></div><div class="line">logging.basicConfig(</div><div class="line">    level = logging.INFO,    <span class="comment">#å®šä¹‰è®°å½•å¤§äºæˆ–ç­‰äºæ—¥å¿—çº§åˆ«</span></div><div class="line">    format=<span class="string">'[%(levelname)s] [%(asctime)s] --- %(message)s'</span>,</div><div class="line">    datefmt=<span class="string">'%Y-%m-%d %H:%M:%S'</span>,</div><div class="line">    filename=logname,</div><div class="line">    filemode=<span class="string">'a'</span>,)</div><div class="line">logging.warning(<span class="string">"log"</span>)</div></pre></td></tr></table></figure></p>
<p>å°†æ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶ï¼ŒåŒæ—¶æ‰“å°åŒ¹é…çš„çº§åˆ«åˆ°å±å¹•ä¸Š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding: utf-8</span></div><div class="line"><span class="keyword">import</span> logging</div><div class="line">logname = <span class="string">'log.log'</span></div><div class="line">logging.basicConfig(</div><div class="line">    level = logging.INFO,    <span class="comment">#å®šä¹‰è®°å½•å¤§äºæˆ–ç­‰äºæ—¥å¿—çº§åˆ«</span></div><div class="line">    format=<span class="string">'[%(levelname)s] [%(asctime)s] --- %(message)s'</span>,</div><div class="line">    datefmt=<span class="string">'%Y-%m-%d %H:%M:%S'</span>,</div><div class="line">    filename=logname,</div><div class="line">    filemode=<span class="string">'a'</span>,)</div><div class="line">console = logging.StreamHandler()</div><div class="line">console.setLevel(logging.INFO)    <span class="comment">#å®šä¹‰éœ€è¦æ˜¾ç¤ºå¤§äºæˆ–ç­‰äºæ—¥å¿—çº§åˆ«</span></div><div class="line">formatter = logging.Formatter(<span class="string">'[%(levelname)s] [%(asctime)s]-- %(message)s'</span>)</div><div class="line">console.setFormatter(formatter)</div><div class="line">logging.getLogger(<span class="string">''</span>).addHandler(console)</div><div class="line">logging.warning(<span class="string">'log info'</span>)</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;loggingä¸ºpythonæ¨¡å—æä¾›çŠ¶æ€ã€é”™è¯¯ã€ä¿¡æ¯è¾“å‡ºçš„æ ‡å‡†æ¥å£ã€‚&lt;br&gt;æ—¥å¿—çº§åˆ«å¤§å°å…³ç³»ä¸ºï¼šCRITICAL &amp;gt; ERROR &amp;gt; WARNING &amp;gt; INFO &amp;gt; DEBUG &amp;gt; NOTSET&lt;/p&gt;
&lt;p&gt;logging.basicCon
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="logging" scheme="https://ttxsgoto.github.io/tags/logging/"/>
    
  </entry>
  
  <entry>
    <title>redisæ—¥å¸¸ç¬”è®°</title>
    <link href="https://ttxsgoto.github.io/2017/02/18/redis/"/>
    <id>https://ttxsgoto.github.io/2017/02/18/redis/</id>
    <published>2017-02-18T14:16:52.000Z</published>
    <updated>2017-03-17T01:25:55.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="redisè®¾ç½®å¯†ç "><a href="#redisè®¾ç½®å¯†ç " class="headerlink" title="redisè®¾ç½®å¯†ç "></a>redisè®¾ç½®å¯†ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">æ–¹æ³•ä¸€ï¼ˆå‘½ä»¤è¡Œï¼‰ï¼š</div><div class="line">CONFIG SET requirepass  password	#è®¾ç½®å¯†ç ä¸ºpassword</div><div class="line">auth password	#ç™»å½•</div><div class="line">ping	#éªŒè¯</div><div class="line">CONFIG SET requirepass  &apos;&apos;	#å–æ¶ˆå¯†ç ï¼Œè®¾ç½®ä¸ºç©º</div><div class="line">redis-cli -h 127.0.0.1 -p 6379 -a &quot;ttxsgoto&quot; 	#éªŒè¯è¿æ¥</div><div class="line"> </div><div class="line">æ–¹æ³•äºŒï¼ˆé…ç½®æ–‡ä»¶ï¼‰ï¼š</div><div class="line">/etc/redis.confä¸­</div><div class="line">#requirepass foobared  </div><div class="line">å»æ‰è¡Œå‰çš„æ³¨é‡Šï¼Œå¹¶ä¿®æ”¹å¯†ç ä¸ºæ‰€éœ€çš„å¯†ç ,ä¿å­˜æ–‡ä»¶</div><div class="line">é‡å¯redis serverå®Œæˆ</div><div class="line"> </div><div class="line">#å¯¼å‡º</div><div class="line">redis-cli -h 127.0.0.1 -p 6379 -a &quot;ttxsgoto&quot; keys xxx* &gt; xxx.txt</div></pre></td></tr></table></figure>
<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">keys *  #æŸ¥çœ‹æ‰€æœ‰çš„keys</div><div class="line">get key #æŸ¥çœ‹key</div><div class="line">set key vlaue   #è®¾ç½®key</div><div class="line">del key #åˆ é™¤key</div><div class="line"> </div><div class="line">#å…¶ä»–   http://redisdoc.com/</div><div class="line">dbsize  #å½“å‰æ•°æ®åº“keyæ•°é‡</div><div class="line">select 1    #åˆ‡æ¢åˆ°1å·æ•°æ®åº“</div><div class="line">config get *    #è¿”å›é…ç½®å‚æ•°çš„å˜é‡å’Œå€¼</div><div class="line">info [Memory]    #è¿”å›redisæœåŠ¡å™¨çš„å„ç§ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®ï¼Œå¦‚ç‰ˆæœ¬ï¼Œå†…å­˜ä½¿ç”¨æƒ…å†µ  http://redisdoc.com/server/info.html</div><div class="line">monitor    #å®æ—¶æ‰“å°å‡º Redis æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œè°ƒè¯•ç”¨</div><div class="line">bgsave  #forkå‡ºä¸€ä¸ªæ–°å­è¿›ç¨‹ï¼Œè´Ÿè´£å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­</div><div class="line">slowlog get num    #æŸ¥çœ‹slowlog http://redisdoc.com/server/slowlog.html</div><div class="line">slowlog len/reset     #slowlogæ•°é‡/æ¸…ç©º</div><div class="line">save    #å¤‡ä»½</div><div class="line">move key db-index   # è¿”å›1æˆåŠŸï¼Œ0 å¦‚æœkeyä¸å­˜åœ¨ï¼Œæˆ–è€…å·²ç»åœ¨æŒ‡å®šæ•°æ®åº“ä¸­</div><div class="line"> </div><div class="line">#åˆ é™¤æ‰€æœ‰key</div><div class="line">flushdb     #åˆ é™¤å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰Key</div><div class="line">flushall    #åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰key</div><div class="line"> </div><div class="line">æŸ¥çœ‹å»ºæ˜¯å¦å­˜åœ¨</div><div class="line">exists key   æœ‰è¿”å›(integer) 1ï¼Œæ²¡æœ‰è¿”å›(integer) 0</div><div class="line"> </div><div class="line">rename key newkey   #æ›´æ”¹é”®çš„åç§°</div><div class="line">type key    #è¿”å›é”®çš„æ•°æ®ç±»å‹</div></pre></td></tr></table></figure>
<h3 id="rediså¤‡ä»½-amp-æ¢å¤"><a href="#rediså¤‡ä»½-amp-æ¢å¤" class="headerlink" title="rediså¤‡ä»½&amp;æ¢å¤"></a>rediså¤‡ä»½&amp;æ¢å¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">######## å¤‡ä»½ ########</div><div class="line">save    #å¤‡ä»½ï¼Œå†™å…¥rdbæ–‡ä»¶</div><div class="line">bgsave  #forkå‡ºä¸€ä¸ªæ–°å­è¿›ç¨‹ï¼Œè´Ÿè´£å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­</div><div class="line"> </div><div class="line">######## æ¢å¤ ########</div><div class="line">Redis æ¢å¤çš„æœºåˆ¶</div><div class="line">    - å¦‚æœåªé…ç½® AOF ï¼Œé‡å¯æ—¶åŠ è½½ AOF æ–‡ä»¶æ¢å¤æ•°æ®ï¼›</div><div class="line">    - å¦‚æœåŒæ—¶é…ç½®äº† RDB å’Œ AOF ï¼Œå¯åŠ¨æ˜¯åªåŠ è½½ AOF æ–‡ä»¶æ¢å¤æ•°æ®ï¼›</div><div class="line">    - å¦‚æœåªé…ç½® RDBï¼Œå¯åŠ¨æ˜¯å°†åŠ è½½ dump æ–‡ä»¶æ¢å¤æ•°æ®</div><div class="line"> </div><div class="line">1.aof ä¸­æ¢å¤æ•°æ®(é…ç½®å¦‚ä¸‹)</div><div class="line">    appendonly yes</div><div class="line">    dir /data/redis/</div><div class="line">2.rdb ä¸­æ¢å¤æ•°æ®(é…ç½®å¦‚ä¸‹)</div><div class="line">    appendonly no</div><div class="line">    dir /data/redis/</div><div class="line">3.å¯åŠ¨æœåŠ¡</div><div class="line"> </div><div class="line">#####é‡å¯æœåŠ¡æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ è½½å¤‡ä»½æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œä½†å¦‚æœå¯†ç æ²¡æœ‰å†™å…¥é…ç½®é—®é¢˜ï¼Œä¼šä¸¢å¤±éœ€è¦é‡æ–°è®¾ç½®</div><div class="line">#å®šæ—¶å¤‡ä»½æ–‡ä»¶</div><div class="line">å¯¹äºRDBå’ŒAOFï¼Œéƒ½æ˜¯ç›´æ¥æ‹·è´æ–‡ä»¶å³å¯ï¼Œå¯ä»¥è®¾å®šcrontabè¿›è¡Œå®šæ—¶å¤‡ä»½ï¼š cp /var/lib/redis/dump.rdb /somewhere/safe/dump.$(date +%Y%m%d%H%M).rdb</div><div class="line"> </div><div class="line">æ£€æŸ¥ä¿®å¤AOFæ–‡ä»¶ï¼š</div><div class="line">redis-check-aof data/appendonly.aof</div><div class="line"> </div><div class="line"># æ•°æ®å¿«ç…§ï¼Œå¤‡ä»½ï¼Œä¸»ä»</div><div class="line">http://blog.csdn.net/zhu_xun/article/details/16806697</div></pre></td></tr></table></figure>
<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div></pre></td><td class="code"><pre><div class="line">#redis.conf</div><div class="line">################################## INCLUDES ###################################</div><div class="line"># å…¶ä»–ä¸ªæ€§åŒ–è®¾ç½®</div><div class="line"># include /path/to/local.conf</div><div class="line"># include /path/to/other.conf</div><div class="line"> </div><div class="line">################################ GENERAL  #####################################å¸¸ç”¨</div><div class="line">daemonize no    #é»˜è®¤ä¸ä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œè®¾ç½®ä¸ºyesä¿®æ”¹ä¸ºå®ˆæŠ¤è¿›ç¨‹</div><div class="line">pidfile /var/run/redis.pid  #å¦‚æœä¸ºå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼Œpidæ–‡ä»¶</div><div class="line">port 6379   #ç›‘å¬ç«¯å£</div><div class="line">tcp-backlog 511     # TCP ç›‘å¬çš„æœ€å¤§å®¹çº³æ•°é‡,åœ¨é«˜å¹¶å‘çš„ç¯å¢ƒä¸‹ï¼Œä½ éœ€è¦æŠŠè¿™ä¸ªå€¼è°ƒé«˜ä»¥é¿å…å®¢æˆ·ç«¯è¿æ¥ç¼“æ…¢çš„é—®é¢˜,/proc/sys/net/core/somaxconn å’Œè®¾ç½®å€¼ ç›¸åŒ</div><div class="line"># bind 192.168.1.100 10.0.0.1   #ä½ å¦‚æœåªæƒ³è®©å®ƒåœ¨ä¸€ä¸ªç½‘ç»œæ¥å£ä¸Šç›‘å¬ï¼Œé‚£ä½ å°±ç»‘å®šä¸€ä¸ªIPæˆ–è€…å¤šä¸ªIPï¼Œå¤šä¸ªIPç”¨ç©ºæ ¼éš”å¼€</div><div class="line">timeout 0   # æŒ‡å®šåœ¨ä¸€ä¸ª client ç©ºé—²å¤šå°‘ç§’ä¹‹åå…³é—­è¿æ¥ï¼ˆ0 å°±æ˜¯ä¸ç®¡å®ƒï¼‰</div><div class="line">tcp-keepalive 0 # tcp å¿ƒè·³åŒ…ï¼Œæ¨èä¸€ä¸ªåˆç†çš„å€¼å°±æ˜¯60ç§’</div><div class="line">loglevel notice     # å®šä¹‰æ—¥å¿—çº§åˆ«ï¼Œnotice (é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒ)</div><div class="line">logfile &quot;&quot;      # æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„ä½ç½®</div><div class="line"> </div><div class="line"># è¦æƒ³æŠŠæ—¥å¿—è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿—ï¼Œå°±æŠŠå®ƒæ”¹æˆ yesï¼Œ</div><div class="line"># ä¹Ÿå¯ä»¥å¯é€‰æ‹©æ€§çš„æ›´æ–°å…¶ä»–çš„syslog å‚æ•°ä»¥è¾¾åˆ°ä½ çš„è¦æ±‚</div><div class="line"># syslog-enabled no</div><div class="line"> </div><div class="line"># è®¾ç½® syslog çš„ identityã€‚</div><div class="line"># syslog-ident redis</div><div class="line"> </div><div class="line"># è®¾ç½® syslog çš„ facilityï¼Œå¿…é¡»æ˜¯ USER æˆ–è€…æ˜¯ LOCAL0-LOCAL7 ä¹‹é—´çš„å€¼ã€‚</div><div class="line"># syslog-facility local0</div><div class="line"> </div><div class="line">databases 32    #è®¾ç½®æ•°æ®åº“çš„æ•°ç›®ï¼Œå¯åŠ¨32ä¸ªæ•°æ®åº“ï¼Œé»˜è®¤ä¸º16ä¸ª(0-15)</div><div class="line"> </div><div class="line">################################ SNAPSHOTTING  ################################å¿«ç…§</div><div class="line"># å­˜ DB åˆ°ç£ç›˜ï¼š</div><div class="line">#   æ ¼å¼ï¼šsave &lt;é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰&gt; &lt;å†™å…¥æ¬¡æ•°&gt;</div><div class="line">#   æ ¹æ®ç»™å®šçš„æ—¶é—´é—´éš”å’Œå†™å…¥æ¬¡æ•°å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜</div><div class="line">#</div><div class="line">#   ä¸‹é¢çš„ä¾‹å­çš„æ„æ€æ˜¯ï¼š</div><div class="line">#   900 ç§’å†…å¦‚æœè‡³å°‘æœ‰ 1 ä¸ª key çš„å€¼å˜åŒ–ï¼Œåˆ™ä¿å­˜</div><div class="line">#   300 ç§’å†…å¦‚æœè‡³å°‘æœ‰ 10 ä¸ª key çš„å€¼å˜åŒ–ï¼Œåˆ™ä¿å­˜</div><div class="line">#   60 ç§’å†…å¦‚æœè‡³å°‘æœ‰ 10000 ä¸ª key çš„å€¼å˜åŒ–ï¼Œåˆ™ä¿å­˜</div><div class="line">#ã€€ã€€</div><div class="line">#   æ³¨æ„ï¼šä½ å¯ä»¥æ³¨é‡Šæ‰æ‰€æœ‰çš„ save è¡Œæ¥åœç”¨ä¿å­˜åŠŸèƒ½ã€‚</div><div class="line">#   ä¹Ÿå¯ä»¥ç›´æ¥ä¸€ä¸ªç©ºå­—ç¬¦ä¸²æ¥å®ç°åœç”¨ï¼š</div><div class="line">#   save &quot;&quot;</div><div class="line"> </div><div class="line">save 900 1</div><div class="line">save 300 10</div><div class="line">save 60 10000</div><div class="line"> </div><div class="line"># é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ redis æœ€åä¸€æ¬¡çš„åå°ä¿å­˜å¤±è´¥ï¼Œredis å°†åœæ­¢æ¥å—å†™æ“ä½œï¼Œ</div><div class="line"># è¿™æ ·ä»¥ä¸€ç§å¼ºç¡¬çš„æ–¹å¼è®©ç”¨æˆ·çŸ¥é“æ•°æ®ä¸èƒ½æ­£ç¡®çš„æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œ</div><div class="line"># å¦åˆ™å°±ä¼šæ²¡äººæ³¨æ„åˆ°ç¾éš¾çš„å‘ç”Ÿã€‚</div><div class="line">#</div><div class="line"># å¦‚æœåå°ä¿å­˜è¿›ç¨‹é‡æ–°å¯åŠ¨å·¥ä½œäº†ï¼Œredis ä¹Ÿå°†è‡ªåŠ¨çš„å…è®¸å†™æ“ä½œã€‚</div><div class="line">#</div><div class="line"># ä½ å¯èƒ½ä¸å¸Œæœ› redis è¿™æ ·åšï¼Œé‚£ä½ å°±æ”¹æˆ no </div><div class="line">stop-writes-on-bgsave-error yes</div><div class="line"> </div><div class="line"># æ˜¯å¦åœ¨ dump .rdb æ•°æ®åº“çš„æ—¶å€™ä½¿ç”¨ LZF å‹ç¼©å­—ç¬¦ä¸²</div><div class="line"># é»˜è®¤éƒ½è®¾ä¸º yes</div><div class="line"># å¦‚æœä½ å¸Œæœ›ä¿å­˜å­è¿›ç¨‹èŠ‚çœç‚¹ cpu ï¼Œä½ å°±è®¾ç½®å®ƒä¸º no ï¼Œ</div><div class="line"># ä¸è¿‡è¿™ä¸ªæ•°æ®é›†å¯èƒ½å°±ä¼šæ¯”è¾ƒå¤§</div><div class="line">rdbcompression yes</div><div class="line"> </div><div class="line"># æ˜¯å¦æ ¡éªŒrdbæ–‡ä»¶</div><div class="line">rdbchecksum yes</div><div class="line"> </div><div class="line"># è®¾ç½® dump çš„æ–‡ä»¶ä½ç½®</div><div class="line">dbfilename dump.rdb </div><div class="line"> </div><div class="line"># å·¥ä½œç›®å½•</div><div class="line"># ä¾‹å¦‚ä¸Šé¢çš„ dbfilename åªæŒ‡å®šäº†æ–‡ä»¶åï¼Œ</div><div class="line"># ä½†æ˜¯å®ƒä¼šå†™å…¥åˆ°è¿™ä¸ªç›®å½•ä¸‹ã€‚è¿™ä¸ªé…ç½®é¡¹ä¸€å®šæ˜¯ä¸ªç›®å½•ï¼Œè€Œä¸èƒ½æ˜¯æ–‡ä»¶åã€‚</div><div class="line">dir ./      #è®¾ç½®åˆ° /etc/redisä¸‹ dir &apos;/etc/redis/&apos;</div><div class="line"> </div><div class="line">################################# REPLICATION #################################ä¸»ä»å¤åˆ¶</div><div class="line">#######</div><div class="line"> </div><div class="line">################################## SECURITY ###################################å®‰å…¨</div><div class="line"># è®¾ç½®è®¤è¯å¯†ç </div><div class="line">requirepass foobared</div><div class="line"> </div><div class="line">################################### LIMITS ####################################é™åˆ¶</div><div class="line"># ä¸€æ—¦è¾¾åˆ°æœ€å¤§é™åˆ¶ï¼Œredis å°†å…³é—­æ‰€æœ‰çš„æ–°è¿æ¥</div><div class="line"># å¹¶å‘é€ä¸€ä¸ªâ€˜max number of clients reachedâ€™çš„é”™è¯¯</div><div class="line"># maxclients 10000</div><div class="line"> </div><div class="line"># æœ€å¤§ä½¿ç”¨å†…å­˜</div><div class="line"># maxmemory &lt;bytes&gt;</div><div class="line"> </div><div class="line"># æœ€å¤§å†…å­˜ç­–ç•¥ï¼Œä½ æœ‰ 5 ä¸ªé€‰æ‹©ã€‚</div><div class="line"># </div><div class="line"># volatile-lru -&gt; remove the key with an expire set using an LRU algorithm</div><div class="line"># volatile-lru -&gt; ä½¿ç”¨ LRU ç®—æ³•ç§»é™¤åŒ…å«è¿‡æœŸè®¾ç½®çš„ key ã€‚</div><div class="line"># allkeys-lru -&gt; remove any key accordingly to the LRU algorithm</div><div class="line"># allkeys-lru -&gt; æ ¹æ® LRU ç®—æ³•ç§»é™¤æ‰€æœ‰çš„ key ã€‚</div><div class="line"># volatile-random -&gt; remove a random key with an expire set</div><div class="line"># allkeys-random -&gt; remove a random key, any key</div><div class="line"># volatile-ttl -&gt; remove the key with the nearest expire time (minor TTL)</div><div class="line"># noeviction -&gt; don&apos;t expire at all, just return an error on write operations</div><div class="line"># noeviction -&gt; ä¸è®©ä»»ä½• key è¿‡æœŸï¼Œåªæ˜¯ç»™å†™å…¥æ“ä½œè¿”å›ä¸€ä¸ªé”™è¯¯</div><div class="line"> </div><div class="line">############################## APPEND ONLY MODE ###############################</div><div class="line"> </div><div class="line">appendonly no   #åœ¨å¯åŠ¨æ—¶Redisä¼šé€ä¸ªæ‰§è¡ŒAOFæ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥å°†ç¡¬ç›˜ä¸­çš„æ•°æ®è½½å…¥åˆ°å†…å­˜ä¸­ï¼Œè½½å…¥çš„é€Ÿåº¦ç›¸è¾ƒRDBä¼šæ…¢ä¸€äº›</div><div class="line">appendfilename &quot;appendonly.aof&quot;</div><div class="line"> </div><div class="line"># appendfsync always</div><div class="line">appendfsync everysec</div><div class="line">no-appendfsync-on-rewrite no</div><div class="line"> </div><div class="line">auto-aof-rewrite-percentage 100</div><div class="line">auto-aof-rewrite-min-size 64mb</div><div class="line"> </div><div class="line">################################ LUA SCRIPTING  ###############################</div><div class="line">lua-time-limit 5000</div><div class="line"> </div><div class="line">################################ REDIS CLUSTER  ###############################é›†ç¾¤</div><div class="line"># cluster-enabled yes   # å¯ç”¨æˆ–åœç”¨é›†ç¾¤</div><div class="line"> </div><div class="line"># cluster-config-file nodes-6379.conf</div><div class="line"># cluster-node-timeout 15000</div><div class="line"># cluster-slave-validity-factor 10</div><div class="line"># cluster-migration-barrier 1</div><div class="line"> </div><div class="line">################################## SLOW LOG ###################################æ…¢æ—¥å¿—</div><div class="line"> </div><div class="line">slowlog-log-slower-than 10000   # æ…¢æŸ¥è¯¢è®°å½•æ—¶é—´10000ms</div><div class="line">slowlog-max-len 128             # è®°å½•æ•°æ®æ¡æ•° </div><div class="line"> </div><div class="line">############################# Event notification ##############################</div><div class="line">notify-keyspace-events &quot;&quot;</div><div class="line"> </div><div class="line">############################### ADVANCED CONFIG ###############################</div><div class="line">hash-max-ziplist-entries 512</div><div class="line">hash-max-ziplist-value 64</div><div class="line"> </div><div class="line">list-max-ziplist-entries 512</div><div class="line">list-max-ziplist-value 64</div><div class="line"> </div><div class="line">set-max-intset-entries 512</div><div class="line"> </div><div class="line">zset-max-ziplist-entries 128</div><div class="line">zset-max-ziplist-value 64</div><div class="line"> </div><div class="line">hll-sparse-max-bytes 3000</div><div class="line"> </div><div class="line">activerehashing yes</div><div class="line"> </div><div class="line">client-output-buffer-limit normal 0 0 0</div><div class="line">client-output-buffer-limit slave 256mb 64mb 60</div><div class="line">client-output-buffer-limit pubsub 32mb 8mb 60</div><div class="line"> </div><div class="line">hz 10</div><div class="line"> </div><div class="line">aof-rewrite-incremental-fsync yes</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;redisè®¾ç½®å¯†ç &quot;&gt;&lt;a href=&quot;#redisè®¾ç½®å¯†ç &quot; class=&quot;headerlink&quot; title=&quot;redisè®¾ç½®å¯†ç &quot;&gt;&lt;/a&gt;redisè®¾ç½®å¯†ç &lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;t
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://ttxsgoto.github.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="redis" scheme="https://ttxsgoto.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>mongoæ—¥å¸¸ç¬”è®°</title>
    <link href="https://ttxsgoto.github.io/2017/02/16/mongo/"/>
    <id>https://ttxsgoto.github.io/2017/02/16/mongo/</id>
    <published>2017-02-16T13:57:18.000Z</published>
    <updated>2017-02-16T14:36:52.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è®¤è¯æˆæƒç›¸å…³"><a href="#è®¤è¯æˆæƒç›¸å…³" class="headerlink" title="è®¤è¯æˆæƒç›¸å…³"></a>è®¤è¯æˆæƒç›¸å…³</h3><p>å¸å·æ˜¯è·Ÿç€åº“èµ°çš„ï¼Œæ‰€ä»¥åœ¨æŒ‡å®šåº“é‡Œæˆæƒï¼Œå¿…é¡»ä¹Ÿåœ¨æŒ‡å®šåº“é‡ŒéªŒè¯(auth)ï¼Œç„¶ååœ¨åˆ‡æ¢åˆ°å¯¹åº”çš„åº“ä¸­</p>
<p><strong>è®¤è¯ç™»å½•è¯´æ˜</strong><br>è¶…çº§ç”¨æˆ·ï¼šæ‹¥æœ‰æœ€å¤§æƒé™ï¼Œå­˜å‚¨åœ¨adminæ•°æ®åº“ä¸­ï¼Œ<br>æ•°æ®åº“ç”¨æˆ·ï¼šå­˜å‚¨åœ¨å•ä¸ªæ•°æ®åº“ä¸­ï¼Œæœ€èƒ½è®¿é—®å¯¹åº”çš„æ•°æ®åº“<br>ç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨db.system.usersä¸­</p>
<p><strong>å¼€å¯è®¤è¯æ–¹æ³•</strong></p>
<ul>
<li>å¯åŠ¨æ·»åŠ ï¼š â€“auth</li>
<li>é…ç½®æ–‡ä»¶ï¼šsecurity.authorization: enabled</li>
</ul>
<p><strong>ç”¨æˆ·å’Œæƒé™çš„ç‰¹æ€§</strong></p>
<ol>
<li>æ•°æ®åº“æ˜¯ç”±è¶…çº§ç”¨æˆ·æ¥åˆ›å»ºçš„ï¼Œä¸€ä¸ªæ•°æ®åº“å¯ä»¥åŒ…å«å¤šä¸ªç”¨æˆ·ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸‹ï¼Œä¸åŒæ•°æ®åº“ä¸­çš„ç”¨æˆ·å¯ä»¥åŒå</li>
<li>å¦‚æœåœ¨ admin æ•°æ®åº“ä¸­ä¸å­˜åœ¨ç”¨æˆ·ï¼Œå³ä½¿ mongod å¯åŠ¨æ—¶æ·»åŠ äº† â€“auth å‚æ•°ï¼Œæ­¤æ—¶ä¸è¿›è¡Œä»»ä½•è®¤è¯è¿˜æ˜¯å¯ä»¥åšä»»ä½•æ“ä½œ</li>
<li>åœ¨ admin æ•°æ®åº“åˆ›å»ºçš„ç”¨æˆ·å…·æœ‰è¶…çº§æƒé™ï¼Œå¯ä»¥å¯¹ MongoDB ç³»ç»Ÿå†…çš„ä»»ä½•æ•°æ®åº“çš„æ•°æ®å¯¹è±¡è¿›è¡Œæ“ä½œ</li>
<li>ç‰¹å®šæ•°æ®åº“æ¯”å¦‚ test1 ä¸‹çš„ç”¨æˆ· test_user1ï¼Œä¸èƒ½å¤Ÿè®¿é—®å…¶ä»–æ•°æ®åº“ test2ï¼Œä½†æ˜¯å¯ä»¥è®¿é—®æœ¬æ•°æ®åº“ä¸‹å…¶ä»–ç”¨æˆ·åˆ›å»ºçš„æ•°æ®</li>
<li>ä¸åŒæ•°æ®åº“ä¸­åŒåçš„ç”¨æˆ·ä¸èƒ½å¤Ÿç™»å½•å…¶ä»–æ•°æ®åº“ã€‚æ¯”å¦‚æ•°æ®åº“ test1 å’Œ test2 éƒ½æœ‰ç”¨æˆ· test_userï¼Œä»¥ test_user ç™»å½• test1 å,ä¸èƒ½å¤Ÿç™»å½•åˆ° test2 è¿›è¡Œæ•°æ®åº“æ“ä½œ</li>
</ol>
<h4 id="æˆæƒå‘½ä»¤"><a href="#æˆæƒå‘½ä»¤" class="headerlink" title="æˆæƒå‘½ä»¤"></a>æˆæƒå‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">use xxx;						#è¿›å…¥æŸåº“ï¼Œåˆ›å»ºæŸåº“</div><div class="line">db.createUser(&#123;user: &quot;ttxsgoto&quot;,pwd:&quot;ttxsgoto&quot;,roles:[&#123;role:&quot;userAdminAnyDatabase&quot;,db:&quot;admin&quot;&#125;]&#125;)</div><div class="line">db.createUser(&#123;user: &quot;ttxsgoto&quot;,pwd:&quot;ttxsgoto&quot;,roles:[&#123;role:&quot;read&quot;,db:&quot;test&quot;&#125;]&#125;)	        #è¯»</div><div class="line">db.createUser(&#123;user: &quot;ttxsgoto01&quot;,pwd:&quot;ttxsgoto01&quot;,roles:[&#123;role:&quot;readWrite&quot;,db:&quot;test&quot;&#125;]&#125;)	#è¯»å†™</div><div class="line">db.createUser(&#123;user: &quot;ttxsgoto02&quot;,pwd:&quot;ttxsgoto02&quot;,roles:[&#123;role:&quot;root&quot;,db:&quot;test&quot;&#125;]&#125;)	        #è¶…çº§rootæƒé™</div><div class="line">db.system.users.remove(&#123;user:&quot;ttxsgoto&quot;&#125;)	#åˆ é™¤ç”¨æˆ·</div><div class="line">db.changeUserPassword(&apos;ttxsgoto&apos;,&apos;test&apos;); 	#ä¿®æ”¹å¯†ç çš„æ–¹æ³•</div></pre></td></tr></table></figure>
<p><strong>å…·ä½“æƒé™è¯´æ˜</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">Built-In Rolesï¼ˆå†…ç½®è§’è‰²ï¼‰ï¼š</div><div class="line">    1. æ•°æ®åº“ç”¨æˆ·è§’è‰²ï¼šreadã€readWrite;</div><div class="line">    2. æ•°æ®åº“ç®¡ç†è§’è‰²ï¼šdbAdminã€dbOwnerã€userAdminï¼›</div><div class="line">    3. é›†ç¾¤ç®¡ç†è§’è‰²ï¼šclusterAdminã€clusterManagerã€clusterMonitorã€hostManagerï¼›</div><div class="line">    4. å¤‡ä»½æ¢å¤è§’è‰²ï¼šbackupã€restoreï¼›</div><div class="line">    5. æ‰€æœ‰æ•°æ®åº“è§’è‰²ï¼šreadAnyDatabaseã€readWriteAnyDatabaseã€userAdminAnyDatabaseã€dbAdminAnyDatabase</div><div class="line">    6. è¶…çº§ç”¨æˆ·è§’è‰²ï¼šroot</div><div class="line">    7. å†…éƒ¨è§’è‰²ï¼š__system</div><div class="line"></div><div class="line">å…·ä½“è§’è‰²ï¼š</div><div class="line">Readï¼šå…è®¸ç”¨æˆ·è¯»å–æŒ‡å®šæ•°æ®åº“</div><div class="line">readWriteï¼šå…è®¸ç”¨æˆ·è¯»å†™æŒ‡å®šæ•°æ®åº“</div><div class="line">dbAdminï¼šå…è®¸ç”¨æˆ·åœ¨æŒ‡å®šæ•°æ®åº“ä¸­æ‰§è¡Œç®¡ç†å‡½æ•°ï¼Œå¦‚ç´¢å¼•åˆ›å»ºã€åˆ é™¤ï¼ŒæŸ¥çœ‹ç»Ÿè®¡æˆ–è®¿é—®system.profile</div><div class="line">userAdminï¼šå…è®¸ç”¨æˆ·å‘system.usersé›†åˆå†™å…¥ï¼Œå¯ä»¥æ‰¾æŒ‡å®šæ•°æ®åº“é‡Œåˆ›å»ºã€åˆ é™¤å’Œç®¡ç†ç”¨æˆ·</div><div class="line">clusterAdminï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰åˆ†ç‰‡å’Œå¤åˆ¶é›†ç›¸å…³å‡½æ•°çš„ç®¡ç†æƒé™ã€‚</div><div class="line">readAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»æƒé™</div><div class="line">readWriteAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„è¯»å†™æƒé™</div><div class="line">userAdminAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„userAdminæƒé™</div><div class="line">dbAdminAnyDatabaseï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ï¼Œèµ‹äºˆç”¨æˆ·æ‰€æœ‰æ•°æ®åº“çš„dbAdminæƒé™ã€‚</div><div class="line">rootï¼šåªåœ¨adminæ•°æ®åº“ä¸­å¯ç”¨ã€‚è¶…çº§è´¦å·ï¼Œè¶…çº§æƒé™</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># åœ¨adminåº“ä¸­</div><div class="line">db.createUser(&#123;user: &quot;ttxsgoto02&quot;,pwd:&quot;ttxsgoto02&quot;,roles:[&#123;role:&quot;readWrite&quot;,db:&quot;test01&quot;&#125;,&#123;role:&quot;readWrite&quot;,db:&quot;test02&quot;&#125;]&#125;)	#åœ¨adminåº“ä¸‹åˆ›å»ºtest01ï¼Œtest02åº“çš„è´¦å·</div><div class="line"></div><div class="line">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸èƒ½ç›´æ¥åœ¨å¯¹åº”çš„åº“ä¸­ç™»å½•éªŒè¯ï¼Œè€Œåº”è¯¥åœ¨å¯¹åº”çš„è¿™ä¸ªåº“ä¸­è¿›è¡Œè®¤è¯åï¼Œåœ¨åˆ‡æ¢åˆ°å…¶ä»–åº“ä¸­</div><div class="line">use admin</div><div class="line">db.auth(&apos;ttxsgoto02&apos;,&apos;ttxsgoto02&apos;)</div><div class="line">use test02ï¼›</div></pre></td></tr></table></figure>
<h4 id="ç™»å½•éªŒè¯"><a href="#ç™»å½•éªŒè¯" class="headerlink" title="ç™»å½•éªŒè¯"></a>ç™»å½•éªŒè¯</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">æ–¹æ³•ä¸€ï¼š</div><div class="line">mongo</div><div class="line">use admin</div><div class="line">db.auth(&quot;admin&quot;,&quot;abc&quot;)</div><div class="line">æ–¹æ³•äºŒï¼š</div><div class="line">mongo -u admin -p admin --authenticationDatabase admin</div></pre></td></tr></table></figure>
<h3 id="æ—¥å¸¸ä½¿ç”¨"><a href="#æ—¥å¸¸ä½¿ç”¨" class="headerlink" title="æ—¥å¸¸ä½¿ç”¨"></a>æ—¥å¸¸ä½¿ç”¨</h3><h4 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">mongo 127.0.0.1/admin -uadmin -p&apos;admin&apos;		#è¿æ¥mongoæ•°æ®åº“</div><div class="line">use admin;			#è¿›å…¥æ•°æ®åº“</div><div class="line">show users;			#æŸ¥çœ‹å½“å‰åº“ä¸‹çš„ç”¨æˆ·</div><div class="line">show collections/tables;        #æŸ¥çœ‹å½“å‰åº“ä¸­çš„collections</div><div class="line">db.getCollectionNames();		#å¾—åˆ°å½“å‰dbçš„æ‰€æœ‰é›†åˆ</div><div class="line">db.auth(&apos;ttxsgoto&apos;,&apos;ttxsgoto&apos;)	#ç™»å½•éªŒè¯</div><div class="line">db.getName()			#æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„æ•°æ®åº“</div><div class="line">db.stats()			#æŸ¥çœ‹å½“å‰dbçŠ¶æ€</div><div class="line">db.getMongo();			#æŸ¥çœ‹å½“å‰dbè¿æ¥æœºå™¨çš„åœ°å€</div><div class="line">db.abc.find();	                #æŸ¥çœ‹é›†åˆä¸­çš„æ‰€æœ‰æ•°æ®</div><div class="line">db 		                #æŸ¥çœ‹å½“å‰æ‰€åœ¨çš„æ•°æ®åº“</div><div class="line">db.system.users.find().pretty()	#åœ¨adminåº“ä¸­æŸ¥çœ‹æ‰€æœ‰è´¦å·</div><div class="line">db.getMongo();			#æŸ¥çœ‹å½“å‰dbè¿æ¥æœºå™¨çš„åœ°å€</div><div class="line">db.repairDatabase()		#ä¿®å¤å½“å‰æ•°æ®åº“</div><div class="line">db.getCollectionNames()		#å¾—åˆ°å½“å‰dbçš„æ‰€æœ‰é›†åˆ</div><div class="line">db.printCollectionStats()	#æ˜¾ç¤ºå½“å‰dbæ‰€æœ‰èšé›†ç´¢å¼•çš„çŠ¶æ€</div></pre></td></tr></table></figure>
<h4 id="å¢åˆ æ”¹æŸ¥"><a href="#å¢åˆ æ”¹æŸ¥" class="headerlink" title="å¢åˆ æ”¹æŸ¥"></a>å¢åˆ æ”¹æŸ¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># æ’å…¥é›†åˆ</div><div class="line">content=&#123;name:&quot;xxxx&quot;,sex:&quot;m&quot;&#125;</div><div class="line">db.collections.insert(content)</div><div class="line">db.createCollection(&quot;collName&quot;, &#123;size: 20, capped: 5, max: 100&#125;)	#åˆ›å»ºä¸€ä¸ªé›†åˆ</div><div class="line">db.getCollection(&quot;account&quot;)		#å¾—åˆ°é›†åˆåç§°</div><div class="line"># æŸ¥è¯¢ï¼š</div><div class="line">db.inventory.find();</div><div class="line">db.foo.find()		#å¯¹å½“å‰æ•°æ®åº“ä¸­çš„fooé›†åˆè¿›è¡Œæ•°æ®æŸ¥æ‰¾ï¼Œæ‰€æœ‰æ•°æ®</div><div class="line">db.foo.find(&#123;a:1&#125;)	#å¯¹å½“å‰æ•°æ®åº“ä¸­çš„fooé›†åˆä¸­æ¡ä»¶åŒ…å«a=1çš„é¡¹è¿›è¡ŒæŸ¥è¯¢</div><div class="line"># åˆ é™¤ï¼š</div><div class="line">db.dropDatabase()	#åˆ é™¤å½“å‰ä½¿ç”¨çš„æ•°æ®åº“</div></pre></td></tr></table></figure>
<h4 id="å¤‡ä»½ç›¸å…³"><a href="#å¤‡ä»½ç›¸å…³" class="headerlink" title="å¤‡ä»½ç›¸å…³"></a>å¤‡ä»½ç›¸å…³</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">mongoimport(å¯¼å…¥)/mongoexport(å¯¼å‡º)ï¼š(å°†collectionå¯¼å‡ºä¸ºjsonæ ¼å¼æˆ–csvæ ¼å¼)</div><div class="line">mongoexport -d test -c t1 -o t1.dat	#å¯¼å‡ºjsonæ ¼å¼</div><div class="line">-c	#æŒ‡æ˜å¯¼å‡ºçš„é›†åˆ</div><div class="line">-d	#ä½¿ç”¨åº“</div><div class="line">mongoexport -d test -c t1 -csv -f num -o t1.dat	#å¯¼å‡ºcsvæ ¼å¼</div><div class="line">-csv	#æŒ‡æ˜å¯¼å‡ºcsvæ ¼å¼</div><div class="line">-f	#æŒ‡æ˜éœ€è¦å¯¼å‡ºå“ªäº›åˆ—</div><div class="line">mongoimport -d test -c t1 -file t1.dat				#è¿˜åŸ</div><div class="line">mongoimport -d test -c t1 -type csv --headerline -file t1.dat	#è¿˜åŸcsvæ ¼å¼çš„æ•°æ®</div><div class="line">--headerline	#æŒ‡æ˜ä¸å¯¼å…¥ç¬¬ä¸€è¡Œï¼Œå› ä¸ºç¬¬ä¸€è¡Œä¸ºåˆ—å</div><div class="line">mongodump/mongorestore:ï¼ˆæ•´åº“å¤‡ä»½è¿˜åŸ,åº“çº§åˆ«æ“ä½œ,å…ˆæ‰§è¡ŒæŸ¥è¯¢åŠ¨ä½œç„¶åæŠŠæ‰€æœ‰æŸ¥è¯¢ç»“æœå†™å…¥åˆ°ç¡¬ç›˜ä¸­ï¼Œä½†åœ¨å†…å­˜ä¸­çš„æ•°æ®æœªå†™å…¥ç£ç›˜ä¸­ï¼‰</div><div class="line">mongodump -h x.x.x.x  --port  27017 -uroot -p xxx  -d test -o /bak/mongodump	#å¯¼å‡º</div><div class="line">mongodump -h x.x.x.x  --port  27017 -uroot -p xxx	-o /bak/allmongobak	#å¯¼å‡ºæ‰€æœ‰</div><div class="line">-h ip</div><div class="line">--port port</div><div class="line">-u user</div><div class="line">-p password</div><div class="line">-d database</div><div class="line">-c collection</div><div class="line">-o outfile</div><div class="line">mongorestore -h IP  --port -u user -p password 	-d test  --drop	/bak/mongodump/*	#æ¢å¤</div><div class="line">--drop	#æ¢å¤å‰å…ˆåˆ é™¤æ‰€æœ‰è®°å½•</div><div class="line">--noIndexRestore	#ä¸è¿˜åŸç´¢å¼•</div><div class="line">ä¾‹å­è¯´æ˜</div><div class="line"># å¤‡ä»½</div><div class="line">mongoexport -u root -p root --host=127.0.0.1:27017 --authenticationDatabase admin -d database -c collection -o collection.json</div><div class="line"></div><div class="line">mongodump -u root -p root --host=127.0.0.1:27017 --authenticationDatabase admin -d database -c collection -o 1202.dat</div><div class="line"># è¿˜åŸ</div><div class="line">mongorestore -u root -p root --authenticationDatabase admin -d database_20161202 --noIndexRestore --drop 1202.dat/collection</div><div class="line">mongoimport -u root -p root --host=127.0.0.1:27017 --authenticationDatabase admin -d database_20161202 -c collection  --file  collection.json</div></pre></td></tr></table></figure>
<p><strong>åº“è¡¨çº§å¤‡ä»½è¿˜åŸçš„åŒºåˆ«:</strong><br>mongorestoreå’Œmongodumpæä¾›çš„æ˜¯å¯¹mongoæ•°æ®åº“çš„æ•´ä¸ªæ•°æ®åº“çš„æ¢å¤å’Œå¤‡ä»½ï¼Œè€Œmongoimportå’Œmongoexportåˆ™æ˜¯æä¾›æ›´ç»†ç²’åº¦çš„collectionçº§åˆ«çš„æ•°æ®å¯¼å…¥å’Œå¯¼å‡ºã€‚ä¸¤è€…çš„ç²’åº¦ä¸åŒï¼Œmongoimportå’Œmongoexportç²’åº¦æ›´ç»†ï¼Œç›¸å¯¹æ¥è¯´ï¼Œæ›´åŠ çµæ´»ã€‚å…¶æ¬¡ï¼Œmongoimportå’Œmongoexportåªæ˜¯å°†é›†åˆä¸­çš„æ•°æ®å¯¼å‡ºå’Œå¯¼å…¥ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹æ•°æ®åº“ä¸­çš„å…¶å®ƒæˆåˆ†è¿›è¡Œå¤‡ä»½ï¼ˆæ¯”å¦‚ç´¢å¼•ï¼‰ï¼Œè€Œmongorestoreå’Œmongodumpåˆ™æ˜¯å¯¹æ•°æ®åº“ä¸­çš„æ‰€æœ‰æˆåˆ†ï¼ˆåŒ…æ‹¬ç´¢å¼•ç­‰å…¶å®ƒï¼‰è¿›è¡Œæ¢å¤å’Œå¤‡ä»½ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿå¯¼è‡´äº†mongorestoreå’Œmongodumpå¯¼å‡ºçš„æ–‡ä»¶æ¯”è¾ƒå¤§è€—æ—¶è¾ƒé•¿ï¼Œè€Œmongoimportå’Œmongoexportå¯¼å‡ºçš„æ–‡ä»¶æ¯”è¾ƒå°ï¼Œé€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œè€Œä¸”æ ¼å¼è¾ƒä¸ºçµæ´»ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;è®¤è¯æˆæƒç›¸å…³&quot;&gt;&lt;a href=&quot;#è®¤è¯æˆæƒç›¸å…³&quot; class=&quot;headerlink&quot; title=&quot;è®¤è¯æˆæƒç›¸å…³&quot;&gt;&lt;/a&gt;è®¤è¯æˆæƒç›¸å…³&lt;/h3&gt;&lt;p&gt;å¸å·æ˜¯è·Ÿç€åº“èµ°çš„ï¼Œæ‰€ä»¥åœ¨æŒ‡å®šåº“é‡Œæˆæƒï¼Œå¿…é¡»ä¹Ÿåœ¨æŒ‡å®šåº“é‡ŒéªŒè¯(auth)ï¼Œç„¶ååœ¨åˆ‡æ¢åˆ°å¯¹åº”çš„åº“ä¸­&lt;/p&gt;
&lt;p
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://ttxsgoto.github.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="mongo" scheme="https://ttxsgoto.github.io/tags/mongo/"/>
    
  </entry>
  
  <entry>
    <title>python-ç±»</title>
    <link href="https://ttxsgoto.github.io/2017/02/15/class/"/>
    <id>https://ttxsgoto.github.io/2017/02/15/class/</id>
    <published>2017-02-15T12:40:38.000Z</published>
    <updated>2017-02-15T13:54:33.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h3><hr>
<p>ç±»ï¼šæ˜¯å¯¹äº‹ç‰©çš„æŠ½è±¡ï¼Œäºº/åŠ¨ç‰©/æœºå™¨,å¦‚æ±½è½¦æ¨¡å‹ï¼›åˆ›å»ºå®ä¾‹çš„æ¨¡æ¿<br>å¯¹è±¡ï¼šæ˜¯ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¦‚å¤§å®¢è½¦ï¼›åˆ™æ˜¯ä¸€ä¸ªä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œå„ä¸ªå®ä¾‹æ‹¥æœ‰çš„æ•°æ®ç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å½±å“<br>èŒƒä¾‹è¯´æ˜ï¼šæ±½è½¦æ¨¡å‹å¯ä»¥å¯¹æ±½è½¦çš„ç‰¹å¾å’Œè¡Œä¸ºè¿›è¡ŒæŠ½è±¡ï¼Œç„¶åå¯ä»¥å®ä¾‹åŒ–ä¸ºä¸€å°çœŸå®çš„æ±½è½¦å®ä½“å‡ºæ¥</p>
<p>æ–¹æ³•ï¼šäººä¼šèµ°ï¼Œä¼šæ€è€ƒï¼Œå®šä¹‰ä¸€ä¸ªç±»çš„å„ä¸ªåŠŸèƒ½,ç±»ä¸­å®šä¹‰çš„å‡½æ•°<br>æ•°æ®æˆå‘˜ï¼šç±»å˜é‡æˆ–è€…å®ä¾‹å˜é‡ç”¨äºå¤„ç†ç±»åŠå…¶å®ä¾‹å¯¹è±¡çš„ç›¸å…³çš„æ•°æ®<br>æ¶ˆæ¯ä¼ é€’ï¼šç‹—å«äº†ï¼Œäººå¬è§äº†ï¼Œå°±å«é€šä¿¡</p>
<p>ç»§æ‰¿ï¼šå³ä¸€ä¸ªæ´¾ç”Ÿç±»ï¼ˆderived classï¼‰ç»§æ‰¿åŸºç±»ï¼ˆbase classï¼‰çš„å­—æ®µå’Œæ–¹æ³•ã€‚ç»§æ‰¿ä¹Ÿå…è®¸æŠŠä¸€ä¸ªæ´¾ç”Ÿç±»çš„å¯¹è±¡ä½œä¸ºä¸€ä¸ªåŸºç±»å¯¹è±¡å¯¹å¾…ã€‚ä¾‹å¦‚ï¼Œæœ‰è¿™æ ·ä¸€ä¸ªè®¾è®¡ï¼šä¸€ä¸ªDogç±»å‹çš„å¯¹è±¡æ´¾ç”Ÿè‡ªAnimalç±»ï¼Œè¿™æ˜¯æ¨¡æ‹Ÿâ€æ˜¯ä¸€ä¸ªï¼ˆis-aï¼‰â€å…³ç³»ï¼ˆä¾‹å›¾ï¼ŒDogæ˜¯ä¸€ä¸ªAnimalï¼‰,ç‹—éƒ½å››æ¡è…¿èµ°è·¯<br>å°è£…ï¼šäººä¸èƒ½å¼•ç”¨ç‹—çš„ç‰¹æ€§ï¼Œæ¯”å¦‚å››æ¡è…¿èµ°è·¯<br>å¤šæ€æ€§ï¼šä¸€ä¸ªå«çš„åŠŸèƒ½ï¼Œå¯èƒ½æ˜¯ä½å¼ï¼Œä¹Ÿä¹Ÿå¯èƒ½æ˜¯å¤§å£°å«<br>æŠ½è±¡æ€§ï¼šç®€å•å¤æ‚çš„ç°å®é—®é¢˜çš„é€”å¾„ï¼Œå®ƒå¯ä»¥ä¸ºå…·ä½“é—®é¢˜æ‰¾åˆ°æœ€æ°å½“çš„ç±»å®šä¹‰<br>ç±»æ–¹æ³•é‡å†™ï¼šå¦‚æœä»çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•ä¸èƒ½æ»¡è¶³å­ç±»çš„éœ€æ±‚ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œæ”¹å†™ï¼Œè¿™ä¸ªè¿‡ç¨‹å«æ–¹æ³•çš„è¦†ç›–ï¼ˆoverrideï¼‰ï¼Œä¹Ÿç§°ä¸ºæ–¹æ³•çš„é‡å†™</p>
<p>é™æ€å­—æ®µï¼šåœ¨classä¸­ç›´æ¥å®šä¹‰çš„å­—æ®µï¼Œç›´æ¥é€šè¿‡classå»è·å–ï¼Œä¹Ÿå¯é€šè¿‡å®ä¾‹æ¥è®¿é—®ï¼Œå¦‚ value = â€œabcâ€<br>åŠ¨æ€å­—æ®µï¼šåœ¨classä¸­å¯¹è±¡ä¸­å®šä¹‰çš„å­—æ®µï¼Œé€šè¿‡classçš„å®ä¾‹æ¥è®¿é—®ï¼Œä¸èƒ½é€šè¿‡classç›´æ¥è®¿é—®ï¼Œå¦‚åœ¨initå‡½æ•°åå®šä¹‰çš„å­—æ®µ<br>é™æ€æ–¹æ³•ï¼šåœ¨ç±»ä¸­ç›´æ¥å®šä¹‰ï¼Œæ²¡æœ‰selfå‚æ•°ï¼ŒåŒæ—¶ä½¿ç”¨staticmethodè£…é¥°å™¨è£…é¥°ï¼Œè®¿é—®æ—¶ç›´æ¥é€šè¿‡classè®¿é—®</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding:utf-8</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></div><div class="line">    name = <span class="string">"é™æ€å­—æ®µ"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age)</span>:</span></div><div class="line">        self.Name = name</div><div class="line">        self.Age = age</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> self.Name + <span class="string">"æ­£åœ¨è·‘æ­¥"</span></div><div class="line"><span class="meta">    @staticmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run1</span><span class="params">()</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"é™æ€æ–¹æ³•"</span></div><div class="line"><span class="meta">    @classmethod</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run2</span><span class="params">(cls)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"ç±»æ–¹æ³•"</span></div><div class="line"><span class="meta">    @property    #è½¬æ¢ä¸ºç‰¹æ€§ï¼Œç›´æ¥ä»¥å±æ€§çš„å½¢å¼è®¿é—®</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Bar</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> self.Name</div><div class="line"></div><div class="line">person1 = Person(<span class="string">'äºº1'</span>,<span class="number">20</span>)</div><div class="line"><span class="comment"># è®¿é—®åŠ¨æ€å­—æ®µ</span></div><div class="line"><span class="keyword">print</span> person1.Name</div><div class="line"><span class="comment"># è®¿é—®åŠ¨æ€æ–¹æ³•</span></div><div class="line">person1.run()</div><div class="line"><span class="comment"># è®¿é—®é™æ€å­—æ®µ</span></div><div class="line"><span class="keyword">print</span> Person.name</div><div class="line"><span class="comment"># è®¿é—®é™æ€æ–¹æ³•</span></div><div class="line">Person.run1()</div><div class="line"><span class="comment"># è°ƒç”¨ç±»æ–¹æ³•</span></div><div class="line">Person.run2()</div><div class="line"><span class="comment"># propertyçš„è®¿é—®å½¢å¼,ç›´æ¥ä»¥å±æ€§çš„å½¢å¼è®¿é—®</span></div><div class="line">person1.Bar</div></pre></td></tr></table></figure>
<hr>
<h3 id="è£…é¥°å™¨"><a href="#è£…é¥°å™¨" class="headerlink" title="è£…é¥°å™¨"></a>è£…é¥°å™¨</h3><p>@staticmethod ï¼šç±»ä¸­çš„é™æ€æ–¹æ³•è®¾ç½®<br>@classmethodï¼šç±»æ–¹æ³•è®¾ç½®<br>@property ï¼šå°†ç±»ä¸­çš„æ–¹æ³•è½¬æ¢ä¸ºç‰¹æ€§ï¼Œç›´æ¥ä»¥å±æ€§çš„å½¢å¼è®¿é—®</p>
<p>@staticmethodå’Œ@classmethodçš„ä½œç”¨ä¸åŒºåˆ«ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@staticmethodå’Œ@classmethodéƒ½å¯ä»¥ç›´æ¥ç±»å.æ–¹æ³•å(),å®ä¾‹å.æ–¹æ³•å()è°ƒç”¨</div><div class="line">@staticmethodä¸éœ€è¦è¡¨ç¤ºè‡ªèº«å¯¹è±¡çš„selfå’Œè‡ªèº«ç±»çš„clså‚æ•°ï¼Œå’Œä½¿ç”¨å‡½æ•°ä¸€æ ·</div><div class="line">@classmethodä¹Ÿä¸éœ€è¦selfå‚æ•°ï¼Œä½†ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ˜¯è¡¨ç¤ºè‡ªèº«ç±»çš„clså‚æ•°</div></pre></td></tr></table></figure></p>
<p>pythonç±»çš„å®šä¹‰ï¼š</p>
<pre><code>ä½¿ç”¨classå…³é”®å­—å®šä¹‰ä¸€ä¸ªç±»ï¼Œå¹¶ä¸”ç±»åçš„é¦–å­—æ¯è¦å¤§å†™
å½“ç¨‹åºå‘˜éœ€è¦åˆ›å»ºçš„ç±»å‹ä¸èƒ½ç”¨ç®€å•ç±»å‹è¡¨ç¤ºæ—¶å°±éœ€è¦åˆ›å»ºç±»
ç±»æŠŠéœ€è¦çš„å˜é‡å’Œå‡½æ•°ç»„åˆåœ¨ä¸€èµ·ï¼Œè¿™ç§åŒ…å«ä¹Ÿç§°ä¹‹ä¸ºâ€œå°è£…â€
</code></pre><p>å¯¹è±¡çš„åˆ›å»ºï¼š<br>åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¹‹ä¸ºå®ä¾‹åŒ–ï¼›å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºåï¼ŒåŒ…æ‹¬ä¸‰ä¸ªæ–¹é¢çš„ç‰¹æ€§ï¼š å¯¹è±¡çš„å¥æŸ„ï¼Œå±æ€§å’Œæ–¹æ³•<br>å¥æŸ„ï¼šç”¨æ¥åŒºåˆ†ä¸åŒçš„å¯¹è±¡ï¼Œå¦‚aï¼Œb<br>å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ä¸ç±»ä¸­çš„æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°å¯¹åº”</p>
<hr>
<h3 id="ç±»çš„å±æ€§"><a href="#ç±»çš„å±æ€§" class="headerlink" title="ç±»çš„å±æ€§"></a>ç±»çš„å±æ€§</h3><p>ç±»ç”±å±æ€§å’Œæ–¹æ³•ç»„æˆï¼Œç±»çš„å±æ€§æ˜¯å¯¹æ•°æ®çš„å°è£…ï¼Œç±»çš„æ–¹æ³•åˆ™æ˜¯å¯¹ç±»çš„è¡Œä¸ºçš„å°è£…ã€‚ç±»çš„å±æ€§æŒ‰ä½¿ç”¨èŒƒå›´åˆ†ä¸ºå…¬æœ‰å±æ€§å’Œç§æœ‰å±æ€§ï¼Œç±»çš„å±æ€§èŒƒå›´å–å†³äºå±æ€§çš„åç§°<br>å…¬æœ‰å±æ€§ï¼šæ‰€è°“å…¬æœ‰å±æ€§å°±æ˜¯åœ¨ç±»ä¸­å’Œç±»å¤–è°ƒç”¨çš„å±æ€§<br>ç§æœ‰å±æ€§ï¼šä¸èƒ½è¢«ç±»ä»¥å¤–çš„å‡½æ•°è°ƒç”¨ï¼ˆå¯ä»¥é€šè¿‡instance._classname_attributeæ–¹å¼è®¿é—®ï¼Œä½†åªç”¨äºè°ƒè¯•ç¨‹åºï¼‰<br>å®šä¹‰æ–¹å¼ï¼šä»¥â€œ__â€åŒä¸‹åˆ’çº¿å¼€å§‹çš„æˆå‘˜å˜é‡å°±æ˜¯ç§æœ‰å±æ€§ï¼Œå¦åˆ™æ˜¯å…¬æœ‰å±æ€§<br>ç§æœ‰å±æ€§é€šè¿‡å†…éƒ¨æ–¹æ³•è°ƒç”¨ï¼Œå®ç°å¯¹æ•°æ®çš„å°è£…éšè—ã€‚<br>å†…ç½®å±æ€§ï¼šç”±ç³»ç»Ÿåœ¨å®šä¹‰ç±»çš„æ—¶å€™é»˜è®¤æ·»åŠ çš„ï¼Œç”±å‰åä¸¤ä¸ªä¸‹åˆ’çº¿æ„æˆ<strong>dict</strong>ï¼Œ<strong>module</strong></p>
<hr>
<h3 id="ç±»çš„æ–¹æ³•"><a href="#ç±»çš„æ–¹æ³•" class="headerlink" title="ç±»çš„æ–¹æ³•"></a>ç±»çš„æ–¹æ³•</h3><p>å’Œå‡½æ•°å®šä¹‰ä¸€æ ·ï¼Œä½†æ˜¯éœ€è¦selfä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°<br>ç±»çš„æ–¹æ³•ä¹Ÿåˆ†ä¸ºï¼šå…¬æœ‰æ–¹æ³•å’Œç§æœ‰æ–¹æ³•<br>    ç§æœ‰æ–¹æ³•ï¼šä¸èƒ½è¢«å¤–éƒ¨çš„ç±»å’Œæ–¹æ³•è°ƒç”¨ï¼Œç§æœ‰æ–¹æ³•çš„å®šä¹‰å’Œç§æœ‰å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåœ¨æ–¹æ³•çš„å‰é¢åŠ ä¸Šâ€œ__â€åŒä¸‹åˆ’çº¿<br>    ç±»æ–¹æ³•ï¼šè¢«classmethod()å‡½æ•°å¤„ç†è¿‡çš„å‡½æ•°ï¼Œèƒ½è¢«ç±»æ‰€è°ƒç”¨ï¼Œä¹Ÿèƒ½è¢«å¯¹è±¡æ‰€è°ƒç”¨ï¼ˆæ˜¯ç»§æ‰¿çš„å…³ç³»ï¼‰<br>    é™æ€æ–¹æ³•ï¼šç›¸å½“ä¸â€œå…¨å±€å‡½æ•°â€ï¼Œå¯ä»¥è¢«ç±»ç›´æ¥è°ƒç”¨ï¼Œå¯ä»¥è¢«æ‰€æœ‰å®ä¾‹åŒ–å¯¹è±¡å…±äº«ï¼Œé€šè¿‡staticmethod()å®šä¹‰é™æ€æ–¹æ³•æ²¡æœ‰â€œselfâ€è¯­å¥ï¼›<br>    ç”¨äºåŒºåˆ†å‡½æ•°å’Œç±»çš„æ–¹æ³•ï¼ˆå¿…é¡»æœ‰ä¸€ä¸ªselfï¼‰ï¼Œselfå‚æ•°è¡¨ç¤ºæŒ‡å‘å¯¹è±¡æœ¬èº«</p>
<p>å†…éƒ¨ç±»ï¼š<br>    æ‰€è°“å†…éƒ¨ç±»ï¼Œå°±æ˜¯åœ¨ç±»çš„å†…éƒ¨å®šä¹‰çš„ç±»ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½çš„æŠ½è±¡ç°å®ä¸–ç•Œ;<br>    ä¸€èˆ¬ä¸èµåŒä½¿ç”¨å†…éƒ¨ç±»ï¼Œä¼šä½¿ç¨‹åºç»“æ„å¤æ‚ï¼Œä½†æ˜¯ç†è§£å†…éƒ¨ç±»æœ‰åŠ©äºç†è§£æ¨¡å—çš„è°ƒç”¨</p>
<hr>
<h3 id="æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°"><a href="#æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°"></a>æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°</h3><p>æ„é€ å‡½æ•°ï¼šç”¨äºåˆå§‹åŒ–ç±»çš„å†…éƒ¨çŠ¶æ€ï¼Œpythonæä¾›çš„æ„é€ å‡½æ•°æ˜¯<strong>init</strong>();<br><strong>init</strong>()æ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸æä¾›ï¼Œpythonä¼šç»™å‡ºä¸€ä¸ªé»˜è®¤çš„<strong>init</strong>æ–¹æ³•<br><strong>init</strong>(self,name,score):  ç”¨äºå®šä¹‰åˆå§‹åŒ–ç±»çš„å±æ€§ï¼Œåœ¨å®ä¾‹æ—¶ï¼Œå¯ä»¥å°†ç›¸å…³å±æ€§çš„å€¼å®šä¹‰å¥½<br>ä¸€èˆ¬å¯¹æ•°æ®çš„è·å–éœ€è¦è‡ªå®šä¹‰çš„getå’Œsetæ–¹æ³•</p>
<p>ææ„å‡½æ•°ï¼šç”¨äºé‡Šæ”¾å¯¹è±¡å ç”¨çš„èµ„æºï¼Œpythonæä¾›çš„ææ„å‡½æ•°æ˜¯<strong>del</strong>();<br><strong>del</strong>()ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸æä¾›ï¼Œåˆ™pythonä¼šåœ¨åå°æä¾›é»˜è®¤ææ„å‡½æ•°<br>å¦‚æœè¦æ˜¾å¼çš„è°ƒç”¨æå¤Ÿå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨delå…³é”®å­—ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š  del  å¯¹è±¡å</p>
<p><strong>call</strong>()æ–¹æ³•ï¼šé€šè¿‡å®ä¾‹åŒ–åï¼Œç›´æ¥ä½¿ç”¨person1()æ¥æ‰§è¡Œcallæ–¹æ³•</p>
<p><strong>str</strong>()æ–¹æ³•ï¼šé€šè¿‡å®ä¾‹åŒ–åï¼Œç›´æ¥print person1 å°±å¯ä»¥æ˜¾ç¤ºsträ¸­è¿”å›çš„å†…å®¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding:utf-8</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age)</span>:</span></div><div class="line">        self.Name = name</div><div class="line">        self.Age = age</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> self.Name + <span class="string">"æ­£åœ¨è·‘æ­¥"</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"è§£é‡Šå™¨è¦é”€æ¯äº†"</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"è¿™æ˜¯callæ–¹æ³•"</span></div><div class="line">person1 = Person(<span class="string">'äºº1'</span>,<span class="number">20</span>)</div><div class="line">person1()    <span class="comment">#å¯ä»¥é€šè¿‡å®ä¾‹åŒ–åï¼Œæ·»åŠ æ‹¬å·ç›´æ¥æ‰§è¡Œcallæ–¹æ³•</span></div><div class="line">person1.run()</div></pre></td></tr></table></figure>
<hr>
<h3 id="åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="åƒåœ¾å›æ”¶æœºåˆ¶"></a>åƒåœ¾å›æ”¶æœºåˆ¶</h3><pre><code>pythoné‡‡ç”¨åƒåœ¾å›æ”¶æœºåˆ¶æ¥æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼›pythonæä¾›gcæ¨¡å—é‡Šæ”¾ä¸å†ä½¿ç”¨çš„å¯¹è±¡pythoné‡‡ç”¨â€œå¼•ç”¨è®¡æ•°â€çš„ç®—æ³•æ–¹å¼æ¥å¤„ç†å›æ”¶ï¼Œå³ï¼šå½“æŸä¸ªå¯¹è±¡åœ¨å…¶ä½œç”¨åŸŸå†…ä¸å†è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨çš„æ—¶å€™ï¼Œpythonä¼šè‡ªåŠ¨æ¸…é™¤å¯¹è±¡ï¼› 
pythonçš„å‡½æ•°collect()å¯ä»¥ä¸€æ¬¡æ€§æ”¶é›†æ‰€æœ‰å¾…å¤„ç†çš„å¯¹è±¡ï¼ˆgc.collect()ï¼‰
</code></pre><hr>
<h3 id="ç±»çš„ç»§æ‰¿ï¼Œå¤šç»§æ‰¿"><a href="#ç±»çš„ç»§æ‰¿ï¼Œå¤šç»§æ‰¿" class="headerlink" title="ç±»çš„ç»§æ‰¿ï¼Œå¤šç»§æ‰¿"></a>ç±»çš„ç»§æ‰¿ï¼Œå¤šç»§æ‰¿</h3><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªclassæ—¶ï¼Œå¯ä»¥ä»æŸä¸ªç°æœ‰çš„classç»§æ‰¿ï¼Œæ–°çš„classç§°ä¹‹ä¸ºå­ç±»ï¼ˆSubclassï¼‰ï¼Œè€Œè¢«ç»§æ‰¿çš„classçš„classç§°ä¹‹ä¸ºçˆ¶ç±»ï¼ˆBase classï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding:utf-8</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.Fname =<span class="string">"father"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Func</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"Father func "</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"Father func_public"</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span><span class="params">(Father)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.Sname = <span class="string">"son"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Bar</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"Son bar_function"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span> <span class="comment">#é‡å†™çˆ¶ç±»çš„æ–¹æ³•</span></div><div class="line">        Father.run(self)</div><div class="line">        <span class="keyword">print</span> <span class="string">"xxxxxxxxxx"</span></div><div class="line"></div><div class="line">s1 = Son()</div><div class="line">s1.Func()</div><div class="line">s1.run()</div></pre></td></tr></table></figure>
<h3 id="å¤šç»§æ‰¿"><a href="#å¤šç»§æ‰¿" class="headerlink" title="å¤šç»§æ‰¿"></a>å¤šç»§æ‰¿</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"A class"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"THis is A run Function"</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"B class"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"This is B run Function"</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"C class"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"This is C run Function"</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(B,C)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"D class"</span></div><div class="line"></div><div class="line">c = D()</div><div class="line">c.run()</div></pre></td></tr></table></figure>
<p>åœ¨ç»§æ‰¿å…³ç³»ä¸­ï¼Œå¦‚æœä¸€ä¸ªå®ä¾‹çš„æ•°æ®ç±»å‹æ˜¯æŸä¸ªå­ç±»ï¼Œé‚£ä¹ˆå®ƒçš„æ•°æ®ç±»å‹ä¹Ÿå¯ä»¥çœ‹ç€æ˜¯çˆ¶ç±»çš„ç±»å‹ï¼›ä½†æ˜¯åè¿‡æ¥ä¸è¡Œ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding:utf8</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SchoolMember</span><span class="params">(object)</span>:</span><span class="comment">#åŸºç±»</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age,sex)</span>:</span></div><div class="line">    	self.name=name</div><div class="line">		self.age=age</div><div class="line">		self.sex=sex</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">tell</span><span class="params">(self)</span>:</span></div><div class="line">    	<span class="keyword">print</span> <span class="string">"""--info of %s----</span></div><div class="line">        	name:%s</div><div class="line">			age:%s</div><div class="line">            sex:%s</div><div class="line">            """ %(self.name,self.name,self.age,self.sex)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">School</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,addr,tel)</span>:</span></div><div class="line">    	self.school_name=name</div><div class="line">        self.addr=addr</div><div class="line">        self.tel=tel</div><div class="line">        self.stu_list=[]</div><div class="line">        self.tech_list=[]</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(SchoolMember,School)</span>:</span><span class="comment">#å­ç±»ï¼Œç»§æ‰¿ï¼Œå¤šç»§æ‰¿</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age,sex,grade,school)</span>:</span></div><div class="line">    	SchoolMember.__init__(self,name,age,sex)<span class="comment">#åˆå§‹åŒ–åŸºç±»å˜é‡</span></div><div class="line">		self.grade=grade</div><div class="line">		self.school=school</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay_money</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="keyword">print</span> <span class="string">"-----%s is paying the tuition fee----"</span> %(self.name)</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">tell</span><span class="params">(self)</span>:</span></div><div class="line">		SchoolMember.tell(self)</div><div class="line">		<span class="keyword">print</span> <span class="string">"---------from school name : ---------%s"</span> %(self.school.school_name)</div><div class="line"></div><div class="line">school1 = School(<span class="string">'AAAA'</span>,<span class="string">'AAAA'</span>,<span class="number">999</span>)</div><div class="line">school2 = School(<span class="string">'BBBB'</span>,<span class="string">'BBBB'</span>,<span class="number">999</span>)</div><div class="line">s1 = Student(<span class="string">'a'</span>,<span class="number">23</span>,<span class="string">'M'</span>,<span class="string">'python'</span>,school1)</div><div class="line">s2 = Student(<span class="string">'b'</span>,<span class="number">24</span>,<span class="string">'M'</span>,<span class="string">'Linux'</span>,school2)</div><div class="line">s1.tell()</div><div class="line">s2.tell()</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h3><p>å½“å­ç±»å’Œçˆ¶ç±»éƒ½å­˜åœ¨ç›¸åŒçš„æ–¹æ³•æ—¶ï¼Œå­ç±»çš„æ–¹æ³•ä¼šè¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ï¼Œåœ¨ä»£ç è¿è¡Œæ—¶ï¼Œæ€»æ˜¯ä¼šè°ƒç”¨å­ç±»çš„ç›¸åº”æ–¹æ³•<br>å½“çˆ¶ç±»ä¸­æœ‰æŸç§æ–¹æ³•ï¼Œä¼ å…¥çš„ä»»ä½•ç±»å‹åªè¦æ˜¯çˆ¶ç±»æˆ–è€…å­ç±»å°±ä¼šè‡ªåŠ¨çš„è°ƒç”¨ç›¸å…³çˆ¶ç±»æˆ–å­ç±»çš„æ–¹æ³•ï¼Œå³å¤šæ€</p>
<p>â€œå¼€é—­â€åŸåˆ™ï¼š<br>å¯¹æ‰©å±•å¼€æ”¾ï¼šå…è®¸æ–°å¢å­ç±»<br>å¯¹ä¿®æ”¹å°é—­ï¼šä¸éœ€è¦ä¿®æ”¹ä¾èµ–çˆ¶ç±»çš„ç›¸å…³å‡½æ•°</p>
<hr>
<h3 id="æ–°å¼ç±»å’Œç»å…¸ç±»"><a href="#æ–°å¼ç±»å’Œç»å…¸ç±»" class="headerlink" title="æ–°å¼ç±»å’Œç»å…¸ç±»"></a>æ–°å¼ç±»å’Œç»å…¸ç±»</h3><p>åœ¨å®šä¹‰æ—¶ï¼Œæœ‰æ— object</p>
<p>åŒºåˆ«ï¼š<br>1.åœ¨ç»§æ‰¿__init__å‡½æ•°å†™æ³•<br>æ–°å¼ç±»ï¼šFather.__init__(self.name,self.sex)<br>æ–°å¼ç±»ï¼šsuper(Son,self).__init____(name,age,sex)</p>
<p>2.ç»§æ‰¿ç‰¹æ€§<br>ç»å…¸ç±»ï¼šæ·±åº¦ä¼˜å…ˆ<br>æ–°å¼ç±»ï¼šå¹¿åº¦ä¼˜å…ˆ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#coding:utf-8</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"A class"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"THis is A run Function"</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"B class"</span></div><div class="line">        A.__init__(self)    <span class="comment">#æ–°å¼ç±»ç»§æ‰¿initå‡½æ•°ï¼Œæ–¹æ³•ä¸€</span></div><div class="line"><span class="comment">#         super(B, self).__init__() #æ–°å¼ç±»ç»§æ‰¿initå‡½æ•°ï¼Œæ–¹æ³•äºŒ</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"C class"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"This is C run Function"</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span><span class="params">(B,C)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"D class"</span></div><div class="line">d = D()</div><div class="line">d.run()</div><div class="line"><span class="string">"""</span></div><div class="line">ç»å…¸ç±»(æ·±åº¦ä¼˜å…ˆ)ï¼šD-B-A-C</div><div class="line">ç»“æœï¼š</div><div class="line">D class</div><div class="line">THis is A run Function</div><div class="line">æ–°å¼ç±»(å¹¿åº¦ä¼˜å…ˆ)ï¼š</div><div class="line">ç»“æœï¼š D-B-C-A</div><div class="line">D class</div><div class="line">This is C run Function</div><div class="line">"""</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç›¸å…³æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#ç›¸å…³æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;ç›¸å…³æ¦‚å¿µ&quot;&gt;&lt;/a&gt;ç›¸å…³æ¦‚å¿µ&lt;/h3&gt;&lt;hr&gt;
&lt;p&gt;ç±»ï¼šæ˜¯å¯¹äº‹ç‰©çš„æŠ½è±¡ï¼Œäºº/åŠ¨ç‰©/æœºå™¨,å¦‚æ±½è½¦æ¨¡å‹ï¼›åˆ›å»ºå®ä¾‹çš„æ¨¡æ¿&lt;br&gt;å¯¹è±¡ï¼šæ˜¯ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¦‚å¤§å®¢è½¦ï¼›åˆ™æ˜¯ä¸€ä¸ªä¸€ä¸ª
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="class" scheme="https://ttxsgoto.github.io/tags/class/"/>
    
  </entry>
  
  <entry>
    <title>ç”Ÿæˆå™¨ã€è¿­ä»£å™¨ã€åå°„å™¨</title>
    <link href="https://ttxsgoto.github.io/2017/02/09/yield/"/>
    <id>https://ttxsgoto.github.io/2017/02/09/yield/</id>
    <published>2017-02-09T14:37:32.000Z</published>
    <updated>2017-02-15T13:55:41.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç”Ÿæˆå™¨ï¼ˆgenerator"><a href="#ç”Ÿæˆå™¨ï¼ˆgenerator" class="headerlink" title="ç”Ÿæˆå™¨ï¼ˆgenerator)"></a>ç”Ÿæˆå™¨ï¼ˆgenerator)</h3><p>ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ—¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±å«ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ï¼Œå¦‚æœå‡½æ•°ä¸­åŒ…å«yieldè¯­æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±å˜æˆäº†ç”Ÿæˆå™¨<br>returnä½œç”¨ï¼šåœ¨ä¸€ä¸ªç”Ÿæˆå™¨ä¸­ï¼Œå¦‚æœæ²¡æœ‰returnï¼Œåˆ™é»˜è®¤æ‰§è¡Œåˆ°å‡½æ•°å®Œæ¯•ï¼›å¦‚æœé‡åˆ°returnï¼Œå¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­returnåˆ™ä¼šæŠ›å‡ºStopIterationç»ˆæ­¢è¿­ä»£</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">fab</span><span class="params">(max)</span>:</span></div><div class="line">    n, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></div><div class="line">    <span class="keyword">while</span> n &lt; max:</div><div class="line">        <span class="keyword">yield</span> b</div><div class="line">        a, b = b, a + b</div><div class="line">        n = n + <span class="number">1</span></div><div class="line"><span class="keyword">for</span> n <span class="keyword">in</span> fab(<span class="number">5</span>):</div><div class="line">    <span class="keyword">print</span> n</div></pre></td></tr></table></figure>
<p><strong>yieldï¼š</strong> æ¯éœ€è¦ä¸€ä¸ªæ—¶ï¼Œæ·»åŠ ä¸€ä¸ª<br>ç®€å•åœ°è®²ï¼Œyield çš„ä½œç”¨å°±æ˜¯æŠŠä¸€ä¸ªå‡½æ•°å˜æˆä¸€ä¸ª generatorï¼Œå¸¦æœ‰ yield çš„å‡½æ•°ä¸å†æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼ŒPython è§£é‡Šå™¨ä¼šå°†å…¶è§†ä¸ºä¸€ä¸ª generatorï¼Œè°ƒç”¨ fab(5) ä¸ä¼šæ‰§è¡Œ fab å‡½æ•°ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª iterable å¯¹è±¡ï¼åœ¨ for å¾ªç¯æ‰§è¡Œæ—¶ï¼Œæ¯æ¬¡å¾ªç¯éƒ½ä¼šæ‰§è¡Œ fab å‡½æ•°å†…éƒ¨çš„ä»£ç ï¼Œæ‰§è¡Œåˆ° yield b æ—¶ï¼Œfab å‡½æ•°å°±è¿”å›ä¸€ä¸ªè¿­ä»£å€¼ï¼Œä¸‹æ¬¡è¿­ä»£æ—¶ï¼Œä»£ç ä» yield b çš„ä¸‹ä¸€æ¡è¯­å¥ç»§ç»­æ‰§è¡Œï¼Œè€Œå‡½æ•°çš„æœ¬åœ°å˜é‡çœ‹èµ·æ¥å’Œä¸Šæ¬¡ä¸­æ–­æ‰§è¡Œå‰æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œäºæ˜¯å‡½æ•°ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°å†æ¬¡é‡åˆ° yieldã€‚çœ‹èµ·æ¥å°±å¥½åƒä¸€ä¸ªå‡½æ•°åœ¨æ­£å¸¸æ‰§è¡Œçš„è¿‡ç¨‹ä¸­è¢« yield ä¸­æ–­äº†æ•°æ¬¡ï¼Œæ¯æ¬¡ä¸­æ–­éƒ½ä¼šé€šè¿‡ yield è¿”å›å½“å‰çš„è¿­ä»£å€¼ã€‚</p>
<h3 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h3><p><strong>è¿­ä»£å™¨iter</strong> :å­˜åœ¨å†…å­˜ä¸­æˆ–è€…æ–‡ä»¶ä¸­ï¼Œä¸€æ¬¡åªèƒ½è¯»å–1ä¸ªå…ƒç´ <br>æ˜¯è®¿é—®å…ƒç´ çš„ä¸€ç§æ–¹å¼ï¼Œè¿­ä»£å™¨å¯¹è±¡ä»é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹è®¿é—®ï¼Œç›´åˆ°æ‰€æœ‰çš„å…ƒç´ è¢«è®¿é—®å®Œåç»“æŸ</p>
<p>è¿­ä»£å™¨çš„ä¼˜ç‚¹ï¼šä¸éœ€è¦äº‹é¡¹å‡†å¤‡å¥½æ•´ä¸ªè¿­ä»£è¿‡ç¨‹ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œè¿­ä»£å™¨ä»…åœ¨è¿­ä»£åˆ°æŸä¸ªå…ƒç´ æ—¶æ‰è®¡ç®—è¯¥å…ƒç´ ï¼Œåœ¨è¿™ä¹‹å‰æˆ–ä¹‹åï¼Œå…ƒç´ å¯ä»¥ä¸å­˜åœ¨æˆ–è€…è¢«é”€æ¯ï¼Œè¯¥ç‰¹ç‚¹ä½¿å®ƒç‰¹åˆ«é€‚åˆç”¨äºéå†ä¸€ä¸ªå¤§çš„æ–‡ä»¶æˆ–é›†åˆï¼Œå¦‚å‡ ä¸ªGçš„æ–‡ä»¶</p>
<p><strong>ç‰¹ç‚¹</strong></p>
<pre><code>1.è®¿é—®å€¼ä¸éœ€è¦å…³å¿ƒè¿­ä»£å™¨å†…éƒ¨ç»“æ„ï¼Œä»…éœ€é€šè¿‡next()æ–¹æ³•æ¥ä¸æ–­å–ä¸‹ä¸€ä¸ªå†…å®¹
2.ä¸èƒ½éšæœºè®¿é—®é›†åˆä¸­çš„æŸä¸ªå€¼ï¼Œåªèƒ½ä»å¤´åˆ°å°¾ä¾æ¬¡è®¿é—®
3.è®¿é—®åˆ°ä¸€åŠæ—¶ä¸èƒ½å›é€€
4.ç”¨äºå¾ªç¯å¤§çš„æ•°æ®é›†åˆï¼ŒèŠ‚çº¦å†…å­˜
</code></pre><p><strong>æ–¹æ³•</strong></p>
<pre><code>next():è¿”å›è¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ 
__iter__:è¿”å›è¿­ä»£å™¨å¯¹è±¡æœ¬èº«
</code></pre><p> <strong>å®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨</strong></p>
<pre><code>names = iter([&quot;a&quot;,&quot;b&quot;,&quot;d&quot;])
</code></pre><p><strong>ä½¿ç”¨</strong></p>
<pre><code>print (names.next())
</code></pre><h3 id="åå°„å™¨"><a href="#åå°„å™¨" class="headerlink" title="åå°„å™¨"></a>åå°„å™¨</h3><ul>
<li>hasattr(obj,attr)    è¿™ä¸ªæ–¹æ³•ç”¨æ¥æ£€æŸ¥objä¸­æ˜¯å¦æœ‰ä¸€ä¸ªåä¸ºattrçš„å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼</li>
<li>getattr(obj,attr)     è¿™ä¸ªæ–¹æ³•å°†è¿”å›åä¸ºattrå€¼å¾—å±æ€§çš„å€¼ï¼Œå¦‚atträ¸ºâ€™barâ€™ï¼Œåˆ™è¿”å›obj.baræ–¹æ³•</li>
<li>setattr(obj,attr,val)    è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°†ç»™objçš„åä¸ºattrçš„å€¼å¾—å±æ€§èµ‹å€¼ä¸ºvalï¼Œå¦‚æœatträ¸ºâ€™barâ€™ï¼Œåˆ™ç›¸å½“äºobj.bar=val</li>
</ul>
<p><strong>ä¸‰ç§æ‰§è¡Œæ–¹å¼</strong></p>
<ol>
<li><p>ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å¯¼å…¥æ¨¡å—</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">temp = <span class="string">'sys'</span></div><div class="line">model = __import__(temp)</div><div class="line"><span class="keyword">print</span> model.path</div><div class="line"> </div><div class="line"><span class="comment"># ç»“æœï¼š</span></div><div class="line">[<span class="string">'/Users/study/py01'</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æ‰§è¡Œå‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">temp = <span class="string">"mymodel"</span>  <span class="comment">#æ¨¡å—åç§°</span></div><div class="line">func = <span class="string">"myfunc"</span>   <span class="comment">#å‡½æ•°åç§°</span></div><div class="line">model = __import__(temp)</div><div class="line">func1 = getattr(model, func) <span class="comment">#åˆ°mymodelæ¨¡å—ä¸­æ‰¾myfuncå‡½æ•°ï¼Œå¦‚æœæœ‰è¿”å›function</span></div><div class="line">func1(*args, **kwargs)    <span class="comment">#æ‰§è¡Œfunc1å‡½æ•°ï¼Œå³æ‰§è¡Œæ¨¡å—ä¸­çš„å‡½æ•°</span></div></pre></td></tr></table></figure>
</li>
<li><p>ä»¥å­—ç¬¦ä¸²çš„å½¢å¼åˆ¤æ–­ç±»é‡Œé¢æœ‰æ²¡æœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œæ ¹æ®è¾“å…¥çš„å†…å®¹ï¼Œæ‰§è¡Œç±»ä¸­å¯¹åº”çš„æ–¹æ³•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"sayhi"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"info"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"do"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"run"</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">outside</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"outside other funciton"</span></div><div class="line"> </div><div class="line">m = MyClass()</div><div class="line">user_input  = raw_input(<span class="string">'Pls input function:'</span>)</div><div class="line"><span class="keyword">if</span> hasattr(m, user_input): <span class="comment">#åˆ¤æ–­æœ‰æ²¡æœ‰è¯¥æ–¹æ³•</span></div><div class="line">    func = getattr(m, user_input) <span class="comment">#è·å¾—è¯¥æ–¹æ³•</span></div><div class="line">    func()  <span class="comment">#æ‰§è¡Œæ–¹æ³•</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="keyword">print</span> <span class="string">"Error!"</span></div><div class="line">    setattr(m, user_input, outside) <span class="comment">#è®¾ç½®æ–¹æ³•</span></div><div class="line">    func = getattr(m,user_input)</div><div class="line">    func()</div></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç”Ÿæˆå™¨ï¼ˆgenerator&quot;&gt;&lt;a href=&quot;#ç”Ÿæˆå™¨ï¼ˆgenerator&quot; class=&quot;headerlink&quot; title=&quot;ç”Ÿæˆå™¨ï¼ˆgenerator)&quot;&gt;&lt;/a&gt;ç”Ÿæˆå™¨ï¼ˆgenerator)&lt;/h3&gt;&lt;p&gt;ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ—¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±å«ç”Ÿæˆå™¨
    
    </summary>
    
      <category term="python" scheme="https://ttxsgoto.github.io/categories/python/"/>
    
    
      <category term="yeild" scheme="https://ttxsgoto.github.io/tags/yeild/"/>
    
      <category term="generator" scheme="https://ttxsgoto.github.io/tags/generator/"/>
    
  </entry>
  
  <entry>
    <title>dockerå¸¸ç”¨å‘½ä»¤</title>
    <link href="https://ttxsgoto.github.io/2017/02/09/docker-command/"/>
    <id>https://ttxsgoto.github.io/2017/02/09/docker-command/</id>
    <published>2017-02-09T13:08:57.000Z</published>
    <updated>2017-02-09T15:26:14.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>ä¸»è¦è®°å½•Dockerå·¥ä½œä¸­ï¼Œå¸¸ä½¿ç”¨å‘½ä»¤.</strong></p>
<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">docker build -t name ./path(dockerfile)  #é€šè¿‡dockerfileæ¥åˆ›å»ºé•œåƒ</div><div class="line">    --rm=true  è¡¨ç¤ºæ„å»ºæˆåŠŸåï¼Œç§»é™¤æ‰€æœ‰ä¸­é—´å®¹å™¨</div><div class="line">    --no-cache=false è¡¨ç¤ºåœ¨æ„å»ºè¿‡ç¨‹ä¸­ä¸ä½¿ç”¨ç¼“å­˜</div><div class="line"></div><div class="line">docker run  -it -p 2222:22 --name å®¹å™¨åç§° é•œåƒåç§°  #å¯åŠ¨dockeré•œåƒ</div><div class="line">    -it äº¤äº’å¼æ¨¡å¼å¯åŠ¨ï¼Œå‰å°å¯ä»¥çœ‹åˆ°</div><div class="line">    -d åå°æ¨¡å¼å¯åŠ¨</div><div class="line">    -p 2222:22æŒ‡å®šç«¯å£æ˜ å°„</div><div class="line">    --name å®¹å™¨åç§°</div><div class="line">    -v  host_dir:container_dir   å®¿ä¸»æœºå’Œå®¹å™¨æ•°æ®æ˜ å°„ï¼Œæ•°æ®åŒæ­¥</div><div class="line">    -e ä¼ é€’ç¯å¢ƒå˜é‡  -e WORDPRESS_DB_HOST=x.x.x.x</div><div class="line">    --entrypoint=/bin/bash   å°†cmdå‘½ä»¤çš„ç¯å¢ƒè¦†ç›–æ‰</div><div class="line">å¦‚ï¼šdocker run -itd -p 80:80 --name nginx_php -v /root/html:/data/www/html nginx1.8</div><div class="line">docker ps  # å°†å¤„äºrunçŠ¶æ€ä¸‹çš„å®¹å™¨æ˜¾ç¤ºå‡ºæ¥</div><div class="line">docker ps -a   #å°†æ‰€æœ‰dockerçŠ¶æ€çš„å®¹å™¨æ˜¾ç¤ºå‡ºæ¥</div><div class="line">docker info     #æŸ¥çœ‹dockerä¿¡æ¯</div><div class="line">docker images # æŸ¥çœ‹é•œåƒ</div><div class="line">docker pull   xxx  #ä¸‹è½½é•œåƒ</div><div class="line">docker push  xxx  #å°†é•œåƒæ¨é€åˆ°registry</div><div class="line">docker search xxxx #æŸ¥è¯¢é•œåƒ</div><div class="line">docker diff     #åˆ—å‡ºå®¹å™¨å†…å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶å’Œç›®å½•ï¼ˆA-Addï¼ŒD-Deleteï¼ŒC-Changeï¼‰</div><div class="line">docker commit  xxxx    abc/yyy  #æŠŠæœ‰ä¿®æ”¹çš„containeræäº¤åˆ°æ–°çš„imagesä¸­</div><div class="line">docker tag  åŸé•œåƒåç§°     æ–°åç§°    #ç»™é•œåƒé‡å‘½å</div><div class="line">docker top container    #æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­çš„è¿›ç¨‹çš„è¿è¡Œæƒ…å†µ</div><div class="line">docker port container   #ç”¨äºæŸ¥çœ‹å®¹å™¨ä¸ä¸»æœºä¹‹é—´çš„ç«¯å£æ˜ å°„å…³ç³»ä¿¡æ¯</div><div class="line">docker exec -it  container_id(base(åç§°)) /bin/bash    #è¿›å…¥dockerå®¹å™¨é‡Œé¢</div><div class="line">docker stop b1430f1a3daa    #åœæ­¢å®¹å™¨è¿è¡Œ</div><div class="line">Ctrl +p +q                         #è¿›å…¥å®¹å™¨åï¼Œä»ç»ˆç«¯é€€å‡ºå®¹å™¨</div><div class="line">docker rm  -f å®¹å™¨åç§°   #åˆ é™¤å®¹å™¨ï¼Œ-få¼ºåˆ¶åˆ é™¤</div><div class="line">docker rmi  image  #ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ</div><div class="line">docker inspect  #æŸ¥çœ‹é•œåƒæˆ–å®¹å™¨çš„åº•å±‚è¯¦ç»†ä¿¡æ¯</div><div class="line">docker inspect -f &#123;&#123;.NetworkSettings.IPAddress&#125;&#125;  xxxxx   -f #æŸ¥çœ‹ç‰¹å®šä¿¡æ¯</div><div class="line">docker ps -qa  # åˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨(å«æ²‰ç¡é•œåƒ)çš„å®¹å™¨IDå·</div><div class="line">docker rm `docker ps -qa` å°†æ²‰ç¡çš„å®¹å™¨åˆ é™¤</div></pre></td></tr></table></figure>
<h3 id="å­˜å‚¨ç›¸å…³å‘½ä»¤"><a href="#å­˜å‚¨ç›¸å…³å‘½ä»¤" class="headerlink" title="å­˜å‚¨ç›¸å…³å‘½ä»¤"></a>å­˜å‚¨ç›¸å…³å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">docker save -o ubuntu_14.04.tar ubuntu:14.04   #å­˜å‡ºé•œåƒ</div><div class="line">docker load &lt; ubuntu_14.04.tar   #è½½å…¥é•œåƒï¼Œå¯¼å…¥ç›¸å…³çš„å…ƒæ•°æ®ï¼ˆåŒ…æ‹¬æ ‡ç­¾ç­‰ï¼‰</div><div class="line">docker export ID(7691a814370e) &gt;ubuntu.tar   #å¯¼å‡ºå®¹å™¨ï¼Œå¯¼å‡ºå®¹å™¨å¿«ç…§åˆ°æœ¬åœ°</div><div class="line">docker import             #å¯¼å…¥å®¹å™¨å¿«ç…§ï¼Œå¯ä»¥å¯¼å…¥è¿œç¨‹æ–‡ä»¶ã€æœ¬åœ°æ–‡ä»¶å’Œç›®å½•ï¼Œä½¿ç”¨httpçš„urlä»è¿œç¨‹ä½ç½®å¯¼å…¥ï¼Œæœ¬åœ°æˆ–ç›®å½•çš„å¯¼å…¥éœ€è¦ä½¿ç”¨-å‚æ•°</div><div class="line">å¦‚ï¼šdocker import http://xxx.yyy.com/ext.tar.gz  xxx/yyy  || docker import - ubuntu:14.04</div></pre></td></tr></table></figure>
<h3 id="æ—¥å¿—ç›¸å…³å‘½ä»¤"><a href="#æ—¥å¿—ç›¸å…³å‘½ä»¤" class="headerlink" title="æ—¥å¿—ç›¸å…³å‘½ä»¤"></a>æ—¥å¿—ç›¸å…³å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker events     #æ‰“å°å®¹å™¨å®æ—¶çš„ç³»ç»Ÿäº‹ä»¶</div><div class="line">docker history  images    #æ‰“å°æŒ‡å®šimageçš„æ¯å±‚imageå‘½ä»¤è¡Œçš„å†å²è®°å½•</div><div class="line">docker logs container  #æ‰¹é‡æ‰“å°å‡ºå®¹å™¨ä¸­è¿›ç¨‹çš„è¿è¡Œæ—¥å¿—</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;ä¸»è¦è®°å½•Dockerå·¥ä½œä¸­ï¼Œå¸¸ä½¿ç”¨å‘½ä»¤.&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;å¸¸ç”¨å‘½ä»¤&quot;&gt;&lt;a href=&quot;#å¸¸ç”¨å‘½ä»¤&quot; class=&quot;headerlink&quot; title=&quot;å¸¸ç”¨å‘½ä»¤&quot;&gt;&lt;/a&gt;å¸¸ç”¨å‘½ä»¤&lt;/h3&gt;&lt;figure class=&quot;highl
    
    </summary>
    
      <category term="Docker" scheme="https://ttxsgoto.github.io/categories/Docker/"/>
    
    
  </entry>
  
  <entry>
    <title>dockerâ€”ç½‘ç»œæ¨¡å¼</title>
    <link href="https://ttxsgoto.github.io/2017/02/08/docker_network/"/>
    <id>https://ttxsgoto.github.io/2017/02/08/docker_network/</id>
    <published>2017-02-08T14:05:33.000Z</published>
    <updated>2017-02-08T14:58:27.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Dockerç½‘ç»œå®ç°åŸç†"><a href="#Dockerç½‘ç»œå®ç°åŸç†" class="headerlink" title="Dockerç½‘ç»œå®ç°åŸç†"></a>Dockerç½‘ç»œå®ç°åŸç†</h3><p>Docker ä¸­çš„ç½‘ç»œæ¥å£é»˜è®¤éƒ½æ˜¯è™šæ‹Ÿçš„æ¥å£ã€‚è™šæ‹Ÿæ¥å£çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯è½¬å‘æ•ˆç‡è¾ƒé«˜ã€‚ Linux é€šè¿‡åœ¨å†…æ ¸ä¸­è¿› è¡Œæ•°æ®å¤åˆ¶æ¥å®ç°è™šæ‹Ÿæ¥å£ä¹‹é—´çš„æ•°æ®è½¬å‘ï¼Œå‘é€æ¥å£çš„å‘é€ç¼“å­˜ä¸­çš„æ•°æ®åŒ…è¢«ç›´æ¥å¤åˆ¶åˆ°æ¥æ”¶æ¥å£çš„æ¥æ”¶ç¼“å­˜ä¸­ã€‚å¯¹äºæœ¬åœ°ç³»ç»Ÿå’Œå®¹å™¨å†…ç³»ç»Ÿçœ‹æ¥å°±åƒæ˜¯ä¸€ä¸ªæ­£å¸¸çš„ä»¥å¤ªç½‘å¡ï¼Œåªæ˜¯å®ƒä¸éœ€è¦çœŸæ­£åŒå¤–éƒ¨ç½‘ç»œè®¾å¤‡é€šä¿¡ï¼Œé€Ÿåº¦è¦å¿«å¾ˆå¤šï¼›Docker å®¹å™¨ç½‘ç»œåˆ©ç”¨æ­¤æŠ€æœ¯ï¼Œå®ƒåœ¨æœ¬åœ°ä¸»æœºå’Œå®¹å™¨å†…åˆ†åˆ«åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ¥å£ï¼Œå¹¶è®©å®ƒä»¬å½¼æ­¤è¿é€š ï¼ˆè¿™æ ·çš„ä¸€å¯¹æ¥å£å«åš veth pair ï¼‰</p>
<p>Docker åˆ›å»ºä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>
<ul>
<li>åˆ›å»ºä¸€å¯¹è™šæ‹Ÿæ¥å£ï¼Œåˆ†åˆ«æ”¾åˆ°æœ¬åœ°ä¸»æœºå’Œæ–°å®¹å™¨ä¸­ï¼› </li>
<li>æœ¬åœ°ä¸»æœºä¸€ç«¯æ¡¥æ¥åˆ°é»˜è®¤çš„ docker0 æˆ–æŒ‡å®šç½‘æ¡¥ä¸Šï¼Œå¹¶å…·æœ‰ä¸€ä¸ªå”¯ä¸€çš„åå­—ï¼Œå¦‚ vethf9ï¼› </li>
<li>å®¹å™¨ä¸€ç«¯æ”¾åˆ°æ–°å®¹å™¨ä¸­ï¼Œå¹¶ä¿®æ”¹åå­—ä½œä¸º eth0ï¼Œè¿™ä¸ªæ¥å£åªåœ¨å®¹å™¨çš„åå­—ç©ºé—´å¯è§ï¼› </li>
<li>ä»ç½‘æ¡¥å¯ç”¨åœ°å€æ®µä¸­è·å–ä¸€ä¸ªç©ºé—²åœ°å€åˆ†é…ç»™å®¹å™¨çš„ eth0ï¼Œå¹¶é…ç½®é»˜è®¤è·¯ç”±åˆ°æ¡¥æ¥ç½‘å¡ vethf9ã€‚ </li>
</ul>
<p>å®Œæˆè¿™äº›ä¹‹åï¼Œå®¹å™¨å°±å¯ä»¥ä½¿ç”¨ eth0 è™šæ‹Ÿç½‘å¡æ¥è¿æ¥å…¶ä»–å®¹å™¨å’Œå…¶ä»–ç½‘ç»œ</p>
<p>ç½‘ç»œæ¨¡å¼éœ€è¦å¼€å¯linuxç³»ç»Ÿè½¬å‘åŠŸèƒ½ï¼ŒæŸ¥çœ‹linuxç³»ç»Ÿä¸­æ˜¯å¦å¼€å¯è½¬å‘åŠŸèƒ½ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#sysctl net.ipv4.ip_forward</div><div class="line">net.ipv4.ip_forward = 1</div><div class="line"># è®¾ç½®ï¼šsysctl -w  net.ipv4.ip_forward=1</div></pre></td></tr></table></figure></p>
<h3 id="å‡ ç§ç½‘ç»œæ¨¡å¼"><a href="#å‡ ç§ç½‘ç»œæ¨¡å¼" class="headerlink" title="å‡ ç§ç½‘ç»œæ¨¡å¼"></a>å‡ ç§ç½‘ç»œæ¨¡å¼</h3><h4 id="nat"><a href="#nat" class="headerlink" title="nat"></a>nat</h4><p>â€“net=bridge (é»˜è®¤çš„ç½‘æ¡¥)ï¼ŒDockeré€šè¿‡å®¿ä¸»æœºçš„ç½‘æ¡¥(docker0)æ¥è¿é€šå†…éƒ¨å’Œå®¿ä¸»æœºçš„ç½‘ç»œï¼Œå®ç°äº†å®¹å™¨ä¸å®¿ä¸»æœºå’Œå¤–ç•Œä¹‹é—´çš„ç½‘ç»œé€šä¿¡<br><img src="https://ttxsgoto.github.io/img/docker_network/1.png" alt="nat"></p>
<p>Bridgeæ¡¥æ¥æ¨¡å¼çš„å®ç°æ­¥éª¤ä¸»è¦å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰Docker Daemonåˆ©ç”¨veth pairæŠ€æœ¯ï¼Œåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸¤ä¸ªè™šæ‹Ÿç½‘ç»œæ¥å£è®¾å¤‡ï¼Œå‡è®¾ä¸ºveth0å’Œveth1ã€‚è€Œveth pairæŠ€æœ¯çš„ç‰¹æ€§å¯ä»¥ä¿è¯æ— è®ºå“ªä¸€ä¸ªvethæ¥æ”¶åˆ°ç½‘ç»œæŠ¥æ–‡ï¼Œéƒ½ä¼šå°†æŠ¥æ–‡ä¼ è¾“ç»™å¦ä¸€æ–¹ã€‚</p>
<p>ï¼ˆ2ï¼‰Docker Daemonå°†veth0é™„åŠ åˆ°Docker Daemonåˆ›å»ºçš„docker0ç½‘æ¡¥ä¸Šã€‚ä¿è¯å®¿ä¸»æœºçš„ç½‘ç»œæŠ¥æ–‡å¯ä»¥å‘å¾€veth0ã€‚</p>
<p>ï¼ˆ3ï¼‰Docker Daemonå°†veth1æ·»åŠ åˆ°Docker Containeræ‰€å±çš„namespaceä¸‹ï¼Œå¹¶è¢«æ”¹åä¸ºeth0ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¿è¯å®¿ä¸»æœºçš„ç½‘ç»œæŠ¥æ–‡è‹¥å‘å¾€veth0ï¼Œåˆ™ç«‹å³ä¼šè¢«eth0æ¥æ”¶ï¼Œå®ç°å®¿ä¸»æœºåˆ°Docker Containerç½‘ç»œçš„è”é€šæ€§ï¼›åŒæ—¶ï¼Œä¹Ÿä¿è¯Docker Containerå•ç‹¬ä½¿ç”¨eth0ï¼Œå®ç°å®¹å™¨ç½‘ç»œç¯å¢ƒçš„éš”ç¦»æ€§ã€‚</p>
<p>åŒæ—¶Dockeré‡‡ç”¨NATï¼ˆNetwork Address Translationï¼Œç½‘ç»œåœ°å€è½¬æ¢ï¼‰çš„æ–¹å¼(å¯è‡ªè¡ŒæŸ¥è¯¢å®ç°åŸç†)ï¼Œè®©å®¿ä¸»æœºä»¥å¤–çš„ä¸–ç•Œå¯ä»¥ä¸»åŠ¨å°†ç½‘ç»œæŠ¥æ–‡å‘é€è‡³å®¹å™¨å†…éƒ¨ã€‚</p>
<p>é€šè¿‡Bridgerç½‘æ¡¥æ¨¡å¼å®ç°ï¼š</p>
<p>ï¼ˆ1ï¼‰å®¹å™¨æ‹¥æœ‰ç‹¬ç«‹ã€éš”ç¦»çš„ç½‘ç»œæ ˆ</p>
<p>ï¼ˆ2ï¼‰å®¹å™¨å’Œå®¿ä¸»æœºä»¥å¤–çš„ä¸–ç•Œé€šè¿‡NATå»ºç«‹é€šä¿¡</p>
<h4 id="host"><a href="#host" class="headerlink" title="host"></a>host</h4><p>â€“net=host (å‘Šè¯‰dockerä¸è¦å°†å®¹å™¨ç½‘ç»œæ”¾åœ¨éš”ç¦»çš„åå­—å®¹å™¨ä¸­ï¼Œå³ä¸è¦å®¹å™¨åŒ–å®¹å™¨å†…çš„ç½‘ç»œï¼Œè¯¥æ¨¡å¼ä¸‹çš„Docker Containerå’Œhostå®¿ä¸»æœºå…±äº«åŒä¸€ä¸ªç½‘ç»œnamespaceï¼Œå³containerå’Œå®¿ä¸»æœºä¸€æ ·ï¼Œä½¿ç”¨å®¿ä¸»æœºçš„eth0)<br><img src="https://ttxsgoto.github.io/img/docker_network/2.png" alt="host"></p>
<p>Docker Containerçš„hostç½‘ç»œæ¨¡å¼åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œç”±äºä¸éœ€è¦é¢å¤–çš„ç½‘æ¡¥ä»¥åŠè™šæ‹Ÿç½‘å¡ï¼Œæ•…ä¸ä¼šæ¶‰åŠdocker0ä»¥åŠveth pairã€‚çˆ¶è¿›ç¨‹åœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œå¦‚æœä¸ä½¿ç”¨CLONE_NEWNETè¿™ä¸ªå‚æ•°æ ‡å¿—ï¼Œé‚£ä¹ˆåˆ›å»ºå‡ºçš„å­è¿›ç¨‹ä¼šä¸çˆ¶ è¿›ç¨‹å…±äº«åŒä¸€ä¸ªç½‘ç»œnamespaceã€‚Dockerå°±æ˜¯é‡‡ç”¨äº†è¿™ä¸ªç®€å•çš„åŸç†ï¼Œåœ¨åˆ›å»ºè¿›ç¨‹å¯åŠ¨å®¹å™¨çš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰ä¼ å…¥CLONE_NEWNETå‚æ•°æ ‡ å¿—ï¼Œå®ç°Docker Containerä¸å®¿ä¸»æœºå…±äº«åŒä¸€ä¸ªç½‘ç»œç¯å¢ƒï¼Œå³å®ç°hostç½‘ç»œæ¨¡å¼ã€‚</p>
<p>Docker Containerçš„ç½‘ç»œæ¨¡å¼ä¸­ï¼Œhostæ¨¡å¼æ˜¯bridgeæ¡¥æ¥æ¨¡å¼å¾ˆå¥½çš„è¡¥å……ã€‚é‡‡ç”¨hostæ¨¡å¼çš„Docker Containerï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„IPåœ°å€ä¸å¤–ç•Œè¿›è¡Œé€šä¿¡ï¼Œè‹¥å®¿ä¸»æœºçš„eth0æ˜¯ä¸€ä¸ªå…¬æœ‰IPï¼Œé‚£ä¹ˆå®¹å™¨ä¹Ÿæ‹¥æœ‰è¿™ä¸ªå…¬æœ‰IPã€‚åŒæ—¶å®¹å™¨å†…æœåŠ¡çš„ç«¯å£ä¹Ÿå¯ä»¥ä½¿ç”¨å®¿ä¸»æœºçš„ç«¯å£ï¼Œæ— éœ€é¢å¤–è¿›è¡ŒNATè½¬æ¢ã€‚å½“ç„¶ï¼Œæœ‰è¿™æ ·çš„æ–¹ä¾¿ï¼Œè‚¯å®šä¼šæŸå¤±éƒ¨åˆ†å…¶ä»–çš„ç‰¹æ€§ï¼Œæœ€æ˜æ˜¾çš„æ˜¯Docker Containerç½‘ç»œç¯å¢ƒéš”ç¦»æ€§çš„å¼±åŒ–ï¼Œå³å®¹å™¨ä¸å†æ‹¥æœ‰éš”ç¦»ã€ç‹¬ç«‹çš„ç½‘ç»œæ ˆã€‚å¦å¤–ï¼Œä½¿ç”¨hostæ¨¡å¼çš„Docker Containerè™½ç„¶å¯ä»¥è®©å®¹å™¨å†…éƒ¨çš„æœåŠ¡å’Œä¼ ç»Ÿæƒ…å†µæ— å·®åˆ«ã€æ— æ”¹é€ çš„ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºç½‘ç»œéš”ç¦»æ€§çš„å¼±åŒ–ï¼Œè¯¥å®¹å™¨ä¼šä¸å®¿ä¸»æœºå…±äº«ç«äº‰ç½‘ç»œæ ˆçš„ä½¿ç”¨ï¼›å¦å¤–ï¼Œå®¹å™¨å†…éƒ¨å°†ä¸å†æ‹¥æœ‰æ‰€æœ‰çš„ç«¯å£èµ„æºï¼ŒåŸå› æ˜¯éƒ¨åˆ†ç«¯å£èµ„æºå·²ç»è¢«å®¿ä¸»æœºæœ¬èº«çš„æœåŠ¡å ç”¨ï¼Œè¿˜æœ‰éƒ¨åˆ†ç«¯å£å·²ç»ç”¨ä»¥bridgeç½‘ç»œæ¨¡å¼å®¹å™¨çš„ç«¯å£æ˜ å°„ã€‚</p>
<h4 id="Other-container"><a href="#Other-container" class="headerlink" title="Other container"></a>Other container</h4><p>â€“net=container:NAME_or_ID  (è®©dockerå°†æ–°å»ºå®¹å™¨çš„è¿›ç¨‹æ”¾åˆ°ä¸€ä¸ªå·²å­˜åœ¨å®¹å™¨çš„ç½‘ç»œæ ˆä¸­ï¼Œæ–°å®¹å™¨è¿›ç¨‹æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨å’Œèµ„æºé™åˆ¶ï¼Œä½†ä¼šå’Œå·²å­˜åœ¨çš„å®¹å™¨å…±äº«IPåœ°å€å’Œç«¯å£ç­‰ç½‘ç»œèµ„æºï¼Œä¸¤è€…è¿›ç¨‹å¯ä»¥ç›´æ¥é€šè¿‡lo ç¯å›æ¥å£é€šä¿¡)<br><img src="https://ttxsgoto.github.io/img/docker_network/3.png" alt="other"></p>
<p>ä¸Šå›¾å³ä¾§çš„Docker Containerå³é‡‡ç”¨äº†other containerç½‘ç»œæ¨¡å¼ï¼Œå®ƒèƒ½ä½¿ç”¨çš„ç½‘ç»œç¯å¢ƒå³ä¸ºå·¦ä¾§Docker Container brdigeæ¡¥æ¥æ¨¡å¼ä¸‹çš„ç½‘ç»œ</p>
<p>Docker Containerçš„other containerç½‘ç»œæ¨¡å¼åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œä¸æ¶‰åŠç½‘æ¡¥ï¼ŒåŒæ ·ä¹Ÿä¸éœ€è¦åˆ›å»ºè™šæ‹Ÿç½‘å¡veth pairã€‚</p>
<p>å®Œæˆother containerç½‘ç»œæ¨¡å¼çš„åˆ›å»ºåªéœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<p>(1) æŸ¥æ‰¾other containerï¼ˆå³éœ€è¦è¢«å…±äº«ç½‘ç»œç¯å¢ƒçš„å®¹å™¨ï¼‰çš„ç½‘ç»œnamespaceï¼›</p>
<p>(2) å°†æ–°åˆ›å»ºçš„Docker Containerï¼ˆä¹Ÿæ˜¯éœ€è¦å…±äº«å…¶ä»–ç½‘ç»œçš„å®¹å™¨ï¼‰çš„namespaceï¼Œä½¿ç”¨other containerçš„namespace<br>åœ¨è¿™ç§æ¨¡å¼ä¸‹çš„Docker Containerå¯ä»¥é€šè¿‡localhostæ¥è®¿é—®namespaceä¸‹çš„å…¶ä»–å®¹å™¨ï¼Œä¼ è¾“æ•ˆç‡è¾ƒé«˜ã€‚è™½ç„¶å¤šä¸ªå®¹å™¨å…±äº«ç½‘ç»œç¯å¢ƒï¼Œä½†æ˜¯å¤šä¸ªå®¹å™¨å½¢æˆçš„æ•´ä½“ä¾ç„¶ä¸å®¿ä¸»æœºä»¥åŠå…¶ä»–å®¹å™¨å½¢æˆç½‘ç»œéš”ç¦»ã€‚å¦å¤–ï¼Œè¿™ç§æ¨¡å¼è¿˜èŠ‚çº¦äº†ä¸€å®šæ•°é‡çš„ç½‘ç»œèµ„æºã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒå¹¶æ²¡æœ‰æ”¹å–„å®¹å™¨ä¸å®¿ä¸»æœºä»¥å¤–ä¸–ç•Œé€šä¿¡çš„æƒ…å†µã€‚</p>
<h4 id="none"><a href="#none" class="headerlink" title="none"></a>none</h4><p>â€“net=none   (è®©Dockerå°†æ–°å®¹å™¨æ”¾åˆ°éš”ç¦»çš„ç½‘ç»œæ ˆä¸­ï¼Œä½†ä¸è¿›è¡Œç½‘ç»œé…ç½®ï¼Œä¹‹åç”¨æˆ·å¯ä»¥è‡ªå·±è¿›è¡Œé…ç½®ï¼Œå®¹å™¨å†…éƒ¨åªèƒ½ä½¿ç”¨loopbackç½‘ç»œè®¾å¤‡ï¼Œä¸ä¼šå†æœ‰å…¶ä»–çš„ç½‘ç»œèµ„æº)</p>
<h3 id="ç½‘ç»œç›¸å…³çš„å‘½ä»¤"><a href="#ç½‘ç»œç›¸å…³çš„å‘½ä»¤" class="headerlink" title="ç½‘ç»œç›¸å…³çš„å‘½ä»¤"></a>ç½‘ç»œç›¸å…³çš„å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-b BRIDGE or --bridge=BRIDGE --æŒ‡å®šå®¹å™¨æŒ‚è½½çš„ç½‘æ¡¥</div><div class="line">--bip=CIDR --å®šåˆ¶ docker0 çš„æ©ç </div><div class="line">-H SOCKET... or --host=SOCKET... --Docker æœåŠ¡ç«¯æ¥æ”¶å‘½ä»¤çš„é€šé“</div><div class="line">--icc=true|false --æ˜¯å¦æ”¯æŒå®¹å™¨ä¹‹é—´è¿›è¡Œé€šä¿¡</div><div class="line">--ip-forward=true|false --å®¹å™¨ä¹‹é—´çš„é€šä¿¡</div><div class="line">--iptables=true|false --ç¦æ­¢ Docker æ·»åŠ  iptables è§„åˆ™</div><div class="line">--mtu=BYTES --å®¹å™¨ç½‘ç»œä¸­çš„ MTU</div></pre></td></tr></table></figure>
<p>ä¸Šè¿°ç½‘ç»œæ¨¡å¼ç†è®ºä¸»è¦æ¥è‡ªé“¾æ¥ï¼š</p>
<p><a href="http://www.infoq.com/cn/articles/docker-source-code-analysis-part7" target="_blank" rel="external">http://www.infoq.com/cn/articles/docker-source-code-analysis-part7</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Dockerç½‘ç»œå®ç°åŸç†&quot;&gt;&lt;a href=&quot;#Dockerç½‘ç»œå®ç°åŸç†&quot; class=&quot;headerlink&quot; title=&quot;Dockerç½‘ç»œå®ç°åŸç†&quot;&gt;&lt;/a&gt;Dockerç½‘ç»œå®ç°åŸç†&lt;/h3&gt;&lt;p&gt;Docker ä¸­çš„ç½‘ç»œæ¥å£é»˜è®¤éƒ½æ˜¯è™šæ‹Ÿçš„æ¥å£ã€‚è™šæ‹Ÿæ¥å£çš„ä¼˜åŠ¿
    
    </summary>
    
      <category term="Docker" scheme="https://ttxsgoto.github.io/categories/Docker/"/>
    
    
      <category term="Network" scheme="https://ttxsgoto.github.io/tags/Network/"/>
    
  </entry>
  
  <entry>
    <title>awkã€uniqã€sortä¸‰ä¸ªå‘½ä»¤çš„åŸºæœ¬ç”¨æ³•</title>
    <link href="https://ttxsgoto.github.io/2017/02/07/awk_uniq_sort/"/>
    <id>https://ttxsgoto.github.io/2017/02/07/awk_uniq_sort/</id>
    <published>2017-02-07T14:38:32.000Z</published>
    <updated>2017-02-15T13:56:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©å¯¹awkã€uniqã€sortä¸‰ä¸ªå‘½ä»¤åšäº†åŸºç¡€åŠŸèƒ½çš„å­¦ä¹ ï¼Œè¿™é‡Œè‡ªå·±è®°å½•ä¸€ä¸‹ï¼š</p>
<h4 id="1-awk"><a href="#1-awk" class="headerlink" title="1.awk"></a>1.awk</h4><p>æ•°æ®å¤„ç†å·¥å…·ï¼Œå°†ä¸€è¡Œåˆ†å‰²æˆå¤šä¸ªâ€œå­—æ®µâ€æ¥å¤„ç†</p>
<pre><code>awk -F &apos;æ–‡æœ¬åˆ‡å‰²ç¬¦&apos;â€˜{å¤„ç†è¿‡ç¨‹}â€™ æ–‡ä»¶åç§°
</code></pre><p>å¦‚ï¼šcat /ect/passwd | awk -F â€˜:â€™ â€˜{print $1}â€™   #ä»¥ï¼šåˆ†å‰²ï¼Œæ‰“å°ç¬¬ä¸€åˆ—çš„æ•°æ®ï¼›å¦‚æœä¸º$0è¡¨ç¤ºæ•´ä¸ªæ–‡ä»¶å†…å®¹</p>
<pre><code>cat /etc/passwd | awk -F &apos;&apos;BEGIN {print &quot;begin,goto&quot;} {print $1&quot;,&quot;$7} END {print â€œend,endâ€}  #ä»¥ç©ºç™½ç¬¦ä½œä¸ºåˆ†å‰²ï¼Œæ‰“å°beginï¼Œgotoå¼€å§‹æ‰§è¡Œä¿¡æ¯ï¼Œæ‰“å°1ï¼Œ7è¡Œï¼Œä»¥end,endç»“æŸ
</code></pre><h4 id="2-uniq"><a href="#2-uniq" class="headerlink" title="2.uniq"></a>2.uniq</h4><p>å‘½ä»¤ç”¨æ¥è¿‡æ»¤é‡å¤éƒ¨åˆ†æ˜¾ç¤ºæ–‡ä»¶å†…å®¹,è¿™ä¸ªå‘½ä»¤è¯»å–è¾“å…¥æ–‡ä»¶ï¼Œå¹¶æ¯”è¾ƒç›¸é‚»çš„è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">å‚æ•°ï¼š</div><div class="line"></div><div class="line">-c  æ˜¾ç¤ºè¾“å‡ºä¸­ï¼Œåœ¨æ¯è¡Œè¡Œé¦–åŠ ä¸Šæœ¬è¡Œåœ¨æ–‡ä»¶ä¸­å‡ºç°çš„æ¬¡æ•°</div><div class="line">-d  åªæ˜¾ç¤ºé‡å¤è¡Œ</div><div class="line">-u  åªæ˜¾ç¤ºæ–‡ä»¶ä¸­ä¸é‡å¤çš„å„è¡Œ</div><div class="line">-n  å‰nä¸ªå­—æ®µä¸æ¯ä¸ªå­—æ®µå‰çš„ç©ºç™½ä¸€èµ·è¢«å¿½ç•¥</div><div class="line">+n  å‰nä¸ªå­—ç¬¦è¢«å¿½ç•¥ï¼Œä¹‹å‰çš„å­—ç¬¦è¢«è·³è¿‡ï¼ˆå­—ç¬¦ä»0å¼€å§‹ç¼–å·ï¼‰</div><div class="line">-f   nä¸-nç›¸åŒï¼Œè¿™é‡Œnæ˜¯å­—æ®µæ•°</div><div class="line">-s   nä¸+nç›¸åŒï¼Œè¿™é‡Œnæ˜¯å­—ç¬¦æ•°</div><div class="line">å¸¸ç”¨ï¼š uniq -c  é¦–è¡Œæ˜¾ç¤ºæ–‡ä»¶ä¸­å‡ºç°çš„æ¬¡æ•°</div></pre></td></tr></table></figure></p>
<h4 id="3-sort-æ’åº"><a href="#3-sort-æ’åº" class="headerlink" title="3.sort æ’åº"></a>3.sort æ’åº</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">å‚æ•°ï¼š</div><div class="line">-u  åœ¨è¾“å‡ºè¡Œä¸­å»é™¤é‡å¤è¡Œ</div><div class="line">-r   é»˜è®¤çš„æ’åºæ–¹å¼ä¸ºå‡åºï¼Œ-rè½¬æ¢ä¸ºé™åºæ’åˆ—</div><div class="line">-n  é»˜è®¤æŒ‰ç…§å­—ç¬¦æ¥æ’åºå‡ºç°10åœ¨2å‰é¢ï¼Œ-nä»¥æ•°å€¼æ¥æ’åº</div><div class="line">-t   åé¢è®¾å®šé—´éš”ç¬¦</div><div class="line">-k  æŒ‡å®šåˆ—æ•°</div><div class="line">å¦‚ï¼šsort -n -k 2 -t ï¼š test.txt  ä»¥æ•°å€¼æ’åºï¼ŒæŒ‰ç…§ç¬¬äºŒåˆ—ä»¥â€œï¼šâ€é—´éš”æ¥æ’åˆ—é¡ºåº</div></pre></td></tr></table></figure>
<p>ä»¥ä¸Šç®€å•æ€»ç»“è€Œå·²ï¼Œåç»­å¦‚æœ‰å…¶ä»–ä½¿ç”¨ï¼Œå†æ›´æ–°ï¼ï¼ï¼</p>
<h4 id="4-æ—¥å¸¸ä½¿ç”¨ç›¸å…³"><a href="#4-æ—¥å¸¸ä½¿ç”¨ç›¸å…³" class="headerlink" title="4.æ—¥å¸¸ä½¿ç”¨ç›¸å…³"></a>4.æ—¥å¸¸ä½¿ç”¨ç›¸å…³</h4><ul>
<li><p>æˆªå–æ—¥å¿—ä¸­ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—å†…å®¹</p>
<pre><code>sed -n &apos;/2016-08-25 09:44:10/,/2016-08-25 09:44:30/p&apos;  1.txt &gt; test.txt
</code></pre></li>
</ul>
<ul>
<li><p>nginx è®¿é—®æ—¥å¿—ç»Ÿè®¡è®¿é—®çš„url</p>
<p>  æˆªå–ç‰¹å®šæ—¶é—´æ®µçš„æ—¥å¿—</p>
<pre><code>cat nginx.acc.log | egrep &quot;12/Aug/2016&quot; | sed -n &apos;/14:59:44/,/15:47:23/p&apos; &gt; a.txt
</code></pre></li>
<li><p>æ’åº</p>
<pre><code>cat a.txt |awk -F &apos;+0800&apos; &apos;{print $2}&apos;| awk -F &apos; &apos; &apos;{print $5}&apos; | sort #å¯¹æ•°æ®è¿›è¡Œ(ASCII)æ’åº  
</code></pre></li>
<li><p>å»é‡ï¼Œuniq -c åªä¼šåˆå¹¶ç›¸é‚»çš„è®°å½•ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å®ƒä¹‹å‰ï¼Œåº”è¯¥å…ˆè¿›è¡Œæ’åº</p>
<pre><code>cat a.txt |awk -F &apos;+0800&apos; &apos;{print $2}&apos;| awk -F &apos; &apos; &apos;{print $5}&apos; | sort | uniq -c
</code></pre></li>
<li><p>å†æ’åºï¼Œå¾—åˆ° (æ¬¡æ•°  å†…å®¹)çš„æ–‡ä»¶ï¼Œ sort -k 1 -n -r æŒ‡å®šå¯¹ç¬¬ä¸€è¡Œè¿›è¡Œæ’åºï¼Œ-n æ•°å­—æ’åºï¼Œä»¥é™åºæ’åˆ—</p>
<pre><code>cat a.txt |awk -F &apos;+0800&apos; &apos;{print $2}&apos;| awk -F &apos; &apos; &apos;{print $5}&apos; | sort | uniq -c | sort -k 1 -n -r
</code></pre></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©å¯¹awkã€uniqã€sortä¸‰ä¸ªå‘½ä»¤åšäº†åŸºç¡€åŠŸèƒ½çš„å­¦ä¹ ï¼Œè¿™é‡Œè‡ªå·±è®°å½•ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;h4 id=&quot;1-awk&quot;&gt;&lt;a href=&quot;#1-awk&quot; class=&quot;headerlink&quot; title=&quot;1.awk&quot;&gt;&lt;/a&gt;1.awk&lt;/h4&gt;&lt;p&gt;æ•°æ®å¤„ç†å·¥å…·ï¼Œå°†ä¸€è¡Œåˆ†
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://ttxsgoto.github.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="awk" scheme="https://ttxsgoto.github.io/tags/awk/"/>
    
      <category term="sort" scheme="https://ttxsgoto.github.io/tags/sort/"/>
    
      <category term="uniq" scheme="https://ttxsgoto.github.io/tags/uniq/"/>
    
  </entry>
  
  <entry>
    <title>pycharm,vim,items2å¸¸ç”¨å¿«æ·é”®</title>
    <link href="https://ttxsgoto.github.io/2017/02/06/vim/"/>
    <id>https://ttxsgoto.github.io/2017/02/06/vim/</id>
    <published>2017-02-06T14:05:33.000Z</published>
    <updated>2017-02-07T13:37:49.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ç†Ÿç»ƒæŒæ¡ä¸‹é¢å¿«æ·é”®çš„ä½¿ç”¨-æ–¹ä¾¿æŸ¥è¯¢"><a href="#ç†Ÿç»ƒæŒæ¡ä¸‹é¢å¿«æ·é”®çš„ä½¿ç”¨-æ–¹ä¾¿æŸ¥è¯¢" class="headerlink" title="ç†Ÿç»ƒæŒæ¡ä¸‹é¢å¿«æ·é”®çš„ä½¿ç”¨(æ–¹ä¾¿æŸ¥è¯¢)"></a>ç†Ÿç»ƒæŒæ¡ä¸‹é¢å¿«æ·é”®çš„ä½¿ç”¨(æ–¹ä¾¿æŸ¥è¯¢)</h4><hr>
<h5 id="Pycharmæ—¥å¸¸å¿«æ·é”®"><a href="#Pycharmæ—¥å¸¸å¿«æ·é”®" class="headerlink" title="Pycharmæ—¥å¸¸å¿«æ·é”®"></a>Pycharmæ—¥å¸¸å¿«æ·é”®</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">- cmd + b           è·³è½¬åˆ°å£°æ˜å¤„(cmd + é¼ æ ‡)</div><div class="line">- cmd + y           æ˜¾ç¤ºæ–¹æ³•å¯¹åº”çš„ä»£ç </div><div class="line">- cmd + []          å…‰æ ‡ä¹‹å‰/åçš„ä½ç½®</div><div class="line">- cmd + del         åˆ é™¤å½“å‰è¡Œ</div><div class="line">- cmd + o           æœç´¢class</div><div class="line">- cmd + l           æŒ‡å®šè¡Œæ•°è·³è½¬</div><div class="line">- cmd + shift + o   æœç´¢æ–‡ä»¶</div><div class="line">- cmd + opt + o     æœç´¢å‡½æ•°</div><div class="line">- cmd + +           å±•å¼€å½“å‰</div><div class="line">- cmd + -           æ”¶ç¼©å½“å‰</div><div class="line">- cmd + shift + +   å±•å¼€æ‰€æœ‰</div><div class="line">- cmd + shift + -   æ”¶ç¼©æ‰€æœ‰</div><div class="line">- cmd + fn + F2     åœæ­¢è¿è¡Œç¨‹åº</div><div class="line">- cmd + /           æ³¨é‡Š/å–æ¶ˆæ³¨é‡Š</div><div class="line">- cmd + fn + F12    æ˜¾ç¤ºæ–‡ä»¶ç»“æ„</div><div class="line">- cmd + d           åœ¨ä¸‹ä¸€è¡Œå¤åˆ¶æœ¬è¡Œçš„å†…å®¹</div><div class="line">- cmd + up/down     è½¬åˆ°å…¶ä»–ç›®å½•ä¸­</div><div class="line">- alt + enter       è‡ªåŠ¨æ·»åŠ åŒ…</div><div class="line">- alt + del         å‘å‰åˆ é™¤ä¸€ä¸ªå­—ç¬¦ä¸²</div><div class="line">- alt + up          é€‰ä¸­ä¸€ä¸ªå•è¯</div><div class="line">- alt + control + i è‡ªåŠ¨ç¼©è¿›è¡Œ</div><div class="line">- double shift      é€‰æ‹©éœ€è¦æŸ¥çœ‹çš„æ–‡ä»¶</div><div class="line">- alt + r           å¯åŠ¨ç¨‹åº</div><div class="line">- alt + d           debugå¯åŠ¨ç¨‹åº</div></pre></td></tr></table></figure>
<hr>
<h5 id="Vimæ—¥å¸¸å¿«æ·é”®"><a href="#Vimæ—¥å¸¸å¿«æ·é”®" class="headerlink" title="Vimæ—¥å¸¸å¿«æ·é”®"></a>Vimæ—¥å¸¸å¿«æ·é”®</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">- hjkl              å·¦ä¸‹ä¸Šå³</div><div class="line">- gg                è·³åˆ°æ–‡é¦–</div><div class="line">- G                 è·³åˆ°æ–‡æœ«</div><div class="line">- M                 è·³åˆ°å½“å‰é¡µå±å¹•ä¸­é—´</div><div class="line">- &apos;0                å…‰æ ‡è·³åˆ°ä¸Šæ¬¡å…³é—­æ–‡ä»¶å‰çš„ä½ç½®</div><div class="line">- control + b       å‘ä¸Šç¿»é¡µ</div><div class="line">- control + f       å‘ä¸‹ç¿»é¡µ</div><div class="line">- dw                åˆ é™¤ä¸€ä¸ªå•è¯</div><div class="line">- D                 åˆ é™¤æ‰€åœ¨è¡Œå…‰æ ‡åé¢çš„å†…å®¹</div><div class="line">- d0                åˆ é™¤æ‰€åœ¨è¡Œå…‰æ ‡å‰é¢çš„å†…å®¹</div><div class="line">- x/X               å‘ååˆ é™¤ä¸€ä¸ªå­—ç¬¦ï¼ŒXä¸ºå‘å‰åˆ é™¤ä¸€ä¸ªå­—ç¬¦</div><div class="line">- 0                 ç§»åŠ¨åˆ°å½“å‰è¡Œçš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¤„</div><div class="line">- $                 ç§»åŠ¨åˆ°å½“å‰è¡Œçš„æœ€åä¸€ä¸ªå­—ç¬¦å¤„</div><div class="line">- u                 æ’¤é”€ä¹‹å‰çš„æ“ä½œ</div><div class="line">- control + r       å‘åæ‰§è¡Œåˆšæ‰æ’¤é”€çš„å†…å®¹</div><div class="line">- n                 æŸ¥è¯¢æ—¶å‘ä¸‹é‡å¤å‰ä¸€ä¸ªæŸ¥è¯¢æ“ä½œ</div><div class="line">- N                 æŸ¥è¯¢æ—¶å‘ä¸Šé‡å¤å‰ä¸€ä¸ªæŸ¥è¯¢æ“ä½œ</div><div class="line">- :s/old/new/g      ç”¨newæ›¿æ¢è¡Œä¸­æ‰€æœ‰çš„old</div><div class="line">- %s/old/new/g      ç”¨newæ›¿æ¢å½“å‰æ–‡ä»¶é‡Œæ‰€æœ‰çš„old</div><div class="line">- v                 å­—ç¬¦é€‰æ‹©</div><div class="line">- V                 è¡Œé€‰æ‹©</div><div class="line">- ctrl+v            å—é€‰æ‹©</div><div class="line"></div><div class="line">å¯ç”¨äºåœ¨é€‰ä¸­çš„è¡Œä¸Šæ’å…¥ç›¸åŒçš„å†…å®¹</div><div class="line">- å®šä½å…‰æ ‡</div><div class="line">- crtl+v           è¿›å…¥å—ç¼–è¾‘æ¨¡å¼</div><div class="line">- I                å¤§å†™å­—æ¯Iï¼Œç„¶åæ’å…¥å­—ç¬¦</div><div class="line">- ESC              æŒ‰ä¸¤ä¸‹esc å³å¯æ·»åŠ ç›¸åŒå†…å®¹åˆ°å¯¹åº”çš„è¡Œ</div></pre></td></tr></table></figure>
<hr>
<h5 id="Items2å¸¸ç”¨å¿«æ·é”®"><a href="#Items2å¸¸ç”¨å¿«æ·é”®" class="headerlink" title="Items2å¸¸ç”¨å¿«æ·é”®"></a>Items2å¸¸ç”¨å¿«æ·é”®</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- cmd + t           æ–°å»ºæ ‡ç­¾</div><div class="line">- cmd + w           å…³é—­æ ‡ç­¾</div><div class="line">- cmd + L/R         å·¦å³åˆ‡æ¢æ ‡ç­¾</div><div class="line">- cmd + ;           æŸ¥çœ‹å†å²å‘½ä»¤</div><div class="line">- cmd + r           æ¸…å±</div><div class="line">- cmd + d           å‚ç›´åˆ†å±</div><div class="line">- cmd + shift + d   æ°´å¹³åˆ†å±</div><div class="line">- control + a       åˆ°è¡Œé¦–</div><div class="line">- control + e       åˆ°è¡Œæœ«</div><div class="line">- control + d       åˆ é™¤å½“å‰å…‰æ ‡çš„å­—ç¬¦</div><div class="line">- é€‰ä¸­å³å¤åˆ¶ + é¼ æ ‡ä¸­é”®ç²˜è´´</div></pre></td></tr></table></figure>
<hr>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;ç†Ÿç»ƒæŒæ¡ä¸‹é¢å¿«æ·é”®çš„ä½¿ç”¨-æ–¹ä¾¿æŸ¥è¯¢&quot;&gt;&lt;a href=&quot;#ç†Ÿç»ƒæŒæ¡ä¸‹é¢å¿«æ·é”®çš„ä½¿ç”¨-æ–¹ä¾¿æŸ¥è¯¢&quot; class=&quot;headerlink&quot; title=&quot;ç†Ÿç»ƒæŒæ¡ä¸‹é¢å¿«æ·é”®çš„ä½¿ç”¨(æ–¹ä¾¿æŸ¥è¯¢)&quot;&gt;&lt;/a&gt;ç†Ÿç»ƒæŒæ¡ä¸‹é¢å¿«æ·é”®çš„ä½¿ç”¨(æ–¹ä¾¿æŸ¥è¯¢)&lt;/h4&gt;&lt;hr&gt;
&lt;h5 id
    
    </summary>
    
      <category term="è¿ç»´" scheme="https://ttxsgoto.github.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="vim" scheme="https://ttxsgoto.github.io/tags/vim/"/>
    
      <category term="pycharm" scheme="https://ttxsgoto.github.io/tags/pycharm/"/>
    
      <category term="items2" scheme="https://ttxsgoto.github.io/tags/items2/"/>
    
  </entry>
  
</feed>
